# STP Solar - Complete Solar System Platform

A comprehensive solar system configuration, quote generation, and customer management platform with integrated QuickBooks automation, Slack notifications, and dynamic admin portals.

## ğŸš€ System Overview

This project consists of multiple integrated components:

1. **Main Website** (`index.html`) - Customer-facing solar system builder with contact forms
2. **Admin Portal V2** (`admin-pricing-v2.html`) - System configuration and pricing management
3. **Gallery Admin Portal** (`gallery-admin.html`) - Project gallery management
4. **n8n Workflows** - Automated quote processing and Slack notifications
5. **Data Bridge System** - Dynamic configuration loading and management

## ğŸ“ Complete Project Structure

```
stp-solar/
â”œâ”€â”€ ğŸŒ MAIN WEBSITE
â”‚   â”œâ”€â”€ index.html                    # Main website with system builder
â”‚   â”œâ”€â”€ styles.css                    # Complete styling with animations
â”‚   â”œâ”€â”€ script.js                     # Legacy script (for reference)
â”‚   â””â”€â”€ cache-buster.js               # Cache management utility
â”‚
â”œâ”€â”€ ğŸ”§ ADMIN PORTALS
â”‚   â”œâ”€â”€ admin-pricing-v2.html         # Main admin portal (pricing & systems)
â”‚   â”œâ”€â”€ gallery-admin.html            # Gallery management portal
â”‚   â””â”€â”€ admin-auth.php                # Authentication handler
â”‚
â”œâ”€â”€ ğŸ“Š DATA & CONFIGURATION
â”‚   â”œâ”€â”€ solar-config-v2.js            # Data bridge between admin and website
â”‚   â”œâ”€â”€ solar-config-live.json        # Live configuration (generated by admin)
â”‚   â”œâ”€â”€ gallery-data.json             # Gallery projects data
â”‚   â””â”€â”€ pricing-config.js             # Legacy pricing (for reference)
â”‚
â”œâ”€â”€ ğŸ¨ GALLERY SYSTEM
â”‚   â””â”€â”€ images/gallery/               # Project images organized by category
â”‚       â”œâ”€â”€ residential/
â”‚       â”‚   â”œâ”€â”€ sunsynk/
â”‚       â”‚   â”œâ”€â”€ tesla/
â”‚       â”‚   â””â”€â”€ sigenergy/
â”‚       â””â”€â”€ commercial/
â”‚
â”œâ”€â”€ ğŸ“š DOCUMENTATION
â”‚   â”œâ”€â”€ README.md                     # This comprehensive guide
â”‚   â”œâ”€â”€ SOLAR-ADMIN-V2-GUIDE.md      # Detailed admin portal guide
â”‚   â”œâ”€â”€ GALLERY-SETUP-GUIDE.md       # Gallery management guide
â”‚   â”œâ”€â”€ DEPLOYMENT-GUIDE.md          # Deployment instructions
â”‚   â”œâ”€â”€ REVIEWS-GUIDE.md             # Reviews management
â”‚   â””â”€â”€ DEVELOPMENT-CACHE-GUIDE.md   # Cache management
â”‚
â”œâ”€â”€ ğŸ§¹ CLEANUP & BACKUPS
â”‚   â””â”€â”€ Cleanup/                      # Old versions and backups
â”‚
â””â”€â”€ ğŸ”’ SECURITY & LEGAL
    â”œâ”€â”€ privacy-policy.html           # Privacy policy page
    â””â”€â”€ terms-conditions.html         # Terms and conditions
```

## ğŸ¯ Key Features

### ğŸŒ Main Website (`index.html`)
- **Dynamic System Builder** with real-time pricing calculations
- **Phase Selection** (Single/Three Phase) with system filtering
- **Component Selection** (Batteries, Panels, Roof Types) with quantity controls
- **Funky Loading Animations** with cycling messages during quote requests
- **Responsive Design** optimized for mobile, tablet, and desktop
- **Contact Form Integration** with Slack notifications
- **Gallery Integration** with filtering and modal views
- **Reviews Carousel** with navigation controls
- **QuickBooks Integration** via n8n webhook for automated quotes

### ğŸ”§ Admin Portal V2 (`admin-pricing-v2.html`)
- **Authentication System** (Username: `stpadmin`, Password: `Solar@2025!`)
- **7 Component Categories**:
  - Inverters (name and price)
  - Batteries (name and price)
  - Solar Panels (name and price)
  - Roof Types (type and mounting kit price per panel)
  - Installation Phases (Single/Three Phase with prices)
  - Accessories (installation hardware packages)
  - Installation (professional setup options)
- **System Builder** - Create complete systems by combining components
- **Quantity Management** - Set min/max limits for batteries and panels
- **Default Selections** - Pre-select roof types and other options
- **Live Export** - Generate `solar-config-live.json` for website
- **Import/Export** - Backup and restore configurations
- **Data Persistence** - Saves to localStorage with JSON backup

### ğŸ–¼ï¸ Gallery Admin Portal (`gallery-admin.html`)
- **Authentication System** (Same credentials as main admin)
- **Project Management** - Add, edit, and delete gallery projects
- **Image Organization** - Categorized by residential/commercial and system type
- **Metadata Management** - Titles, descriptions, locations, components
- **Export Functionality** - Generate updated `gallery-data.json`
- **Responsive Interface** - Works on all devices

## ğŸ”„ System Architecture & Data Flow

```
Admin Portal V2 â†’ solar-config-live.json â†’ Main Website â†’ n8n Webhooks â†’ QuickBooks/Slack
     â†“                    â†“                      â†“              â†“
localStorage â†â†’ JSON Export â†â†’ Data Bridge â†â†’ Customer Actions â†â†’ Automated Processing
```

### ğŸ“Š Data Bridge System (`solar-config-v2.js`)
The data bridge handles:
- **Dynamic Loading** - Fetches configuration from localStorage or JSON fallback
- **System Management** - Provides API for system types, configurations, and pricing
- **Price Calculations** - Real-time pricing with VAT handling
- **Validation** - Ensures data integrity and proper component selection
- **Fallback Mechanisms** - Graceful handling of missing or corrupted data

## ğŸ”— Webhook Integration

### 1. **Solar Quote Webhook** (System Builder)
**Endpoint:** `https://n8n01.stpsolar.co.za/webhook/solar-quote`

**Purpose:** Processes system builder quote requests and creates QuickBooks estimates

**Payload Structure:**
```json
{
  "customer_name": "Customer Name",
  "customer_email": "customer@example.com", 
  "customer_phone": "0123456789",
  "customer_location": "South Africa",
  "customer_message": "Optional message",
  "system_name": "Sunsynk 5kw System",
  "phase": "1760087693534",
  "line1_item_name": "Solar Product",
  "line1_description": "Sunsynk 5kw Inverter - 1x Inverter",
  "line1_amount": 16087,
  "line1_quantity": 1,
  "line2_item_name": "Solar Product", 
  "line2_description": "Sunsynk 5kwh Battery - 2x Batterys",
  "line2_amount": 32174,
  "line2_quantity": 1,
  "line3_item_name": "Solar Product",
  "line3_description": "JA-Solar-565W - 7x Solar Panels", 
  "line3_amount": 4066,
  "line3_quantity": 1,
  "line4_item_name": "Solar Product",
  "line4_description": "IBR Mounting Kit - 7x Panel Mounting Kit",
  "line4_amount": 7304,
  "line4_quantity": 1,
  "line5_item_name": "Solar Product",
  "line5_description": "Accessories - Installation Accessories & Hardware",
  "line5_amount": 10870,
  "line5_quantity": 1,
  "line6_item_name": "Solar Product",
  "line6_description": "Installation - Professional Installation & Commissioning", 
  "line6_amount": 10870,
  "line6_quantity": 1,
  "total_price": 81371
}
```

**n8n Workflow:** "STP Solar â€¢ QuickBooks Estimate Creation"
- Converts flat line items to QuickBooks Line array format
- Handles VAT calculations (TaxExcluded mode)
- Creates customer records in QuickBooks
- Sends estimate via email to customer

### 2. **Contact Form Webhook** (General Inquiries)
**Endpoint:** `https://n8n01.stpsolar.co.za/webhook/contact-us`

**Purpose:** Processes general contact form submissions and sends Slack notifications

**Payload Structure:**
```json
{
  "customer_name": "Customer Name",
  "customer_email": "customer@example.com",
  "customer_phone": "0123456789", 
  "customer_location": "City Name",
  "monthly_bill": "2500",
  "message": "Customer inquiry message",
  "form_type": "contact_inquiry"
}
```

**n8n Workflow:** "STP Solar Contact Form - Slack Notifications"
- Sends formatted notifications to Slack channel
- Handles empty monthly bill fields gracefully
- Provides instant team notifications for new inquiries

## ğŸ’° VAT & Pricing System

### **VAT Handling:**
- **Website Display:** Shows VAT-inclusive prices (e.g., R93,577)
- **Webhook Data:** Converts to VAT-exclusive amounts for QuickBooks
- **QuickBooks Processing:** Uses `TaxExcluded` mode, adds 15% VAT automatically
- **Final Quote:** Matches website display exactly (R93,577)

### **Pricing Calculation Logic:**
```javascript
// Component pricing (VAT-exclusive for webhook)
inverterPrice = inverter.price / 1.15
batteryPrice = (battery.price * quantity) / 1.15  
panelPrice = (panel.price * quantity) / 1.15
mountingKitPrice = (roofType.price * panelQuantity) / 1.15
accessoriesPrice = accessories.price / 1.15
installationPrice = installation.price / 1.15

// Total calculation
totalPrice = inverterPrice + batteryPrice + panelPrice + mountingKitPrice + accessoriesPrice + installationPrice
```

## ğŸ¨ Funky Features & Animations

### **Loading Animations:**
The quote request button features:
- **Cycling Messages** every 3 seconds with solar-themed text
- **Funky Pulse Animation** with color shifting effects
- **Glowing Effects** with pulsing shadows
- **Shimmer Effects** that sweep across the button
- **Rotating Spinner** with scaling effects

### **Sample Loading Messages:**
- âš¡ Charging up the solar magic...
- ğŸŒ Calculating your energy savings...
- ğŸ”‹ Crunching numbers like a solar calculator...
- ğŸ’¡ Please wait while we work out magic...
- ğŸŒŸ Almost there, solar superstar!
- ğŸš€ Standby for your system quote...
- âš¡ Powering up your personalized quote...

### **Mobile Optimizations:**
- **Responsive Animations** that work on all screen sizes
- **Touch-Friendly Controls** with proper spacing
- **Optimized Loading States** with centered text
- **Smooth Transitions** between states

## ğŸ”§ Admin Portal Workflow

### **1. System Configuration**
1. **Access Admin Portal** - Navigate to `admin-pricing-v2.html`
2. **Login** - Use credentials: `stpadmin` / `Solar@2025!`
3. **Define Components**:
   - **Inverters** - Name and price
   - **Batteries** - Name and price  
   - **Panels** - Name and price
   - **Roof Types** - Type and mounting kit price per panel
   - **Installation Phases** - Single/Three Phase with prices
   - **Accessories** - Installation hardware packages
   - **Installation** - Professional setup options

### **2. System Builder**
1. **Create Systems** - Combine components into complete systems
2. **Set Quantity Limits** - Define min/max for batteries and panels
3. **Configure Defaults** - Set default roof types and selections
4. **Validate Systems** - Ensure all required components are selected

### **3. Export & Deploy**
1. **Save Changes** - Click "Save All Changes" to localStorage
2. **Export Configuration** - Click "Export for Live Server"
3. **Upload to Website** - Replace `solar-config-live.json` on server
4. **Test Integration** - Verify systems appear on main website

## ğŸ–¼ï¸ Gallery Management

### **Gallery Admin Portal Features:**
- **Project Management** - Add, edit, delete gallery projects
- **Image Organization** - Categorized by type and location
- **Metadata Management** - Titles, descriptions, components, testimonials
- **Export Functionality** - Generate updated `gallery-data.json`
- **Authentication** - Same security as main admin portal

### **Image Organization:**
```
images/gallery/
â”œâ”€â”€ residential/
â”‚   â”œâ”€â”€ sunsynk/          # Sunsynk residential projects
â”‚   â”œâ”€â”€ tesla/            # Tesla Powerwall projects  
â”‚   â”œâ”€â”€ sigenergy/        # Sigenergy projects
â”‚   â””â”€â”€ general/          # Other residential projects
â””â”€â”€ commercial/
    â”œâ”€â”€ sunsynk/          # Commercial Sunsynk projects
    â”œâ”€â”€ sigenergy/        # Commercial Sigenergy projects
    â””â”€â”€ general/          # Other commercial projects
```

### **Adding New Projects:**
1. **Take Photos** - High-quality images of installations
2. **Optimize Images** - Compress to under 200KB each
3. **Upload Images** - Place in appropriate category folder
4. **Update JSON** - Add project details to `gallery-data.json`
5. **Export & Deploy** - Use gallery admin to export updated data

## ğŸš€ Deployment Guide

### **Required Files for Live Website:**
```
Essential Files:
â”œâ”€â”€ index.html                    # Main website
â”œâ”€â”€ styles.css                    # Complete styling
â”œâ”€â”€ solar-config-v2.js            # Data bridge
â”œâ”€â”€ solar-config-live.json        # Configuration data
â”œâ”€â”€ gallery-data.json             # Gallery projects
â””â”€â”€ images/gallery/               # Project images

Optional Files:
â”œâ”€â”€ admin-pricing-v2.html         # Admin portal (keep for management)
â”œâ”€â”€ gallery-admin.html            # Gallery admin (keep for management)
â”œâ”€â”€ privacy-policy.html           # Legal pages
â””â”€â”€ terms-conditions.html         # Legal pages
```

### **Deployment Steps:**
1. **Upload Core Files** - Main website files to server root
2. **Create Image Folders** - Set up gallery directory structure
3. **Upload Images** - Place optimized project images
4. **Configure Webhooks** - Ensure n8n workflows are active
5. **Test Functionality** - Verify all features work correctly
6. **Set Up Backups** - Regular backups of configuration data

### **Hosting Recommendations:**
- **Afrihost** - Current hosting provider (South Africa)
- **Netlify** - Free static hosting with global CDN
- **Vercel** - Free hosting with automatic deployments
- **Traditional Web Hosting** - Full control with PHP support

## ğŸ”’ Security & Authentication

### **Admin Portal Security:**
- **Username:** `stpadmin`
- **Password:** `Solar@2025!`
- **Session Management** - Uses sessionStorage for login persistence
- **Access Control** - All admin functions protected by authentication

### **Data Security:**
- **localStorage** - Primary data storage (client-side)
- **JSON Backups** - Regular exports for data safety
- **Input Validation** - All forms validate required fields
- **XSS Protection** - Sanitized inputs and outputs

## ğŸ“Š Current System Configurations

### **Sunsynk 5kw System:**
- **Inverter:** Sunsynk 5kw Inverter (R18,501)
- **Batteries:** Sunsynk 5kwh Battery (R18,500 each, 1-10 range)
- **Panels:** JA-Solar-565W (R668 each) or Canadian-Solar-565W (R898 each, 6-50 range)
- **Roof Types:** IBR/Tile (R1,200) or Concrete (R2,200) with mounting kits
- **Accessories:** R12,500 installation hardware
- **Installation:** R12,500 professional setup
- **Phase:** Single Phase (R8,500)

### **Sunsynk 8kw System:**
- **Inverter:** Sunsynk 8kw Inverter (R29,850)
- **Same battery and panel options as 5kw system**
- **Higher capacity for larger installations**
- **Phase:** Three Phase (R12,000)

## ğŸ¯ Key Improvements & Features

### **1. Dynamic System Builder**
- **Before:** Hardcoded systems and pricing
- **After:** Fully configurable via admin portal with unlimited systems

### **2. Pricing Accuracy**
- **Before:** Double-counting of components
- **After:** Accurate pricing for selected components only with VAT handling

### **3. User Experience**
- **Before:** Static "Sending..." message
- **After:** Funky animated loading with cycling messages and smooth transitions

### **4. Admin Efficiency**
- **Before:** Manual code changes for new systems
- **After:** Point-and-click system creation with instant export

### **5. Gallery Management**
- **Before:** Static gallery with hardcoded projects
- **After:** Dynamic gallery with admin portal for easy project management

### **6. Contact Integration**
- **Before:** Basic contact form with email alerts
- **After:** Integrated Slack notifications with formatted messages

### **7. Mobile Optimization**
- **Before:** Basic responsive design
- **After:** Fully optimized mobile experience with touch-friendly controls

## ğŸ”® Advanced Features

### **Cache Management:**
- **Version Control** - Automatic cache busting with version parameters
- **Mobile Optimization** - Special cache handling for mobile browsers
- **Development Mode** - Force refresh capabilities for testing

### **Reviews System:**
- **Dynamic Carousel** - Responsive reviews display with navigation
- **Mobile Optimization** - Touch-friendly controls and proper spacing
- **Automatic Management** - Easy addition of new reviews

### **Error Handling:**
- **Graceful Degradation** - System works even with missing data
- **Fallback Mechanisms** - Multiple data sources for reliability
- **User Feedback** - Clear error messages and loading states

## ğŸ› ï¸ Technical Implementation

### **Data Bridge API (`solar-config-v2.js`):**
```javascript
// Key Functions:
- initializeDataBridge()           // Loads data from localStorage or JSON
- getSystemTypes()                // Returns available systems
- getSystemConfig(id)             // Gets specific system configuration  
- calculateDynamicSystemPrice()   // Calculates pricing with quantities
- getSystemDefaultRoofType()      // Gets default roof type for system
- getPhaseTypes()                 // Returns available phase types
- validateSystemSelection()       // Validates component selections
```

### **Pricing Calculation Engine:**
```javascript
// Real-time pricing with VAT handling
function calculateDynamicSystemPrice(systemId, selections, quantities) {
  // Component pricing (VAT-exclusive for webhook)
  const inverterPrice = getInverterPrice(systemId) / 1.15
  const batteryPrice = (getBatteryPrice(selections.batteryId) * quantities.batteries) / 1.15
  const panelPrice = (getPanelPrice(selections.panelId) * quantities.panels) / 1.15
  const mountingKitPrice = (getRoofTypePrice(selections.roofTypeId) * quantities.panels) / 1.15
  const accessoriesPrice = getAccessoriesPrice(systemId) / 1.15
  const installationPrice = getInstallationPrice(systemId) / 1.15
  
  return {
    total: inverterPrice + batteryPrice + panelPrice + mountingKitPrice + accessoriesPrice + installationPrice,
    breakdown: { inverterPrice, batteryPrice, panelPrice, mountingKitPrice, accessoriesPrice, installationPrice }
  }
}
```

### **n8n Workflow Integration:**
- **Customer Management** - Auto-creates or finds existing customers in QuickBooks
- **Line Item Processing** - Converts flat fields to QuickBooks Line array format
- **Tax Calculation** - Handles VAT-inclusive to VAT-exclusive conversion
- **Email Integration** - Sends estimates directly to customer email
- **Slack Notifications** - Instant team notifications for new inquiries

## ğŸ“ Support & Maintenance

### **Regular Maintenance Tasks:**
1. **Update Pricing** - Use admin portal to adjust component prices
2. **Add New Systems** - Create new system configurations as needed
3. **Gallery Updates** - Add new project photos and details
4. **Backup Data** - Export configurations regularly
5. **Test Functionality** - Verify all features work after updates

### **Troubleshooting Common Issues:**
- **Systems Not Showing** - Check `solar-config-live.json` is uploaded
- **Pricing Errors** - Verify all components have prices in admin portal
- **Gallery Issues** - Check image paths and JSON format
- **Webhook Problems** - Verify n8n workflows are active
- **Mobile Issues** - Clear browser cache and test in private mode

### **Performance Optimization:**
- **Image Compression** - Keep gallery images under 200KB
- **Cache Management** - Use version parameters for updates
- **CDN Usage** - Consider CDN for global performance
- **Regular Updates** - Keep configurations current

## ğŸ‰ Success Metrics

### **System Capabilities:**
- âœ… **Unlimited Systems** - Create as many system types as needed
- âœ… **Dynamic Pricing** - Real-time calculations with VAT handling
- âœ… **Mobile Optimized** - Perfect experience on all devices
- âœ… **Admin Friendly** - No coding required for system management
- âœ… **Automated Quotes** - Direct integration with QuickBooks
- âœ… **Team Notifications** - Instant Slack alerts for inquiries
- âœ… **Gallery Management** - Easy project showcase updates
- âœ… **Professional Design** - Modern, responsive interface

### **Business Benefits:**
- **Reduced Manual Work** - Automated quote generation and processing
- **Faster Response Times** - Instant notifications and quote delivery
- **Professional Image** - Modern, polished customer experience
- **Easy Management** - Non-technical staff can update systems and pricing
- **Scalable Growth** - Add unlimited systems and components
- **Data Insights** - Track customer preferences and popular configurations

---

**Version:** 2.0  
**Last Updated:** October 2025  
**Status:** Production Ready âœ…  
**Maintained By:** STP Solar Development Team

For technical support or feature requests, contact the development team.