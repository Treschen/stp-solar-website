<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STP Solar - Gallery Admin</title>
    
    <!-- Cache Control Meta Tags -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="version" content="2.2">
    <meta http-equiv="Expires" content="0">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .login-header p {
            color: #6c757d;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            font-size: 16px;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            font-size: 14px;
        }

        .admin-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .admin-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .admin-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .admin-nav {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 1px solid #dee2e6;
        }

        .nav-tabs {
            display: flex;
            gap: 20px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-tab.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .nav-tab:hover {
            border-color: #3498db;
            transform: translateY(-2px);
        }

        .admin-content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .gallery-items {
            display: grid;
            gap: 20px;
        }

        .gallery-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .gallery-item:hover {
            border-color: #3498db;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .item-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .item-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .item-preview {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .preview-image {
            width: 100%;
            height: 150px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 14px;
            border: 2px dashed #dee2e6;
        }

        .preview-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }

        .preview-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .preview-info span {
            font-size: 14px;
            color: #6c757d;
        }

        .preview-info strong {
            color: #2c3e50;
        }

        .json-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .item-preview {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <h1><i class="fas fa-lock"></i> Gallery Admin Portal</h1>
                <p>Please login to access the admin panel</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" required placeholder="Enter username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required placeholder="Enter password">
                </div>
                <button type="submit" class="btn btn-primary login-btn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <div id="login-error" class="alert alert-danger" style="display: none; margin-top: 15px;">
                    <i class="fas fa-exclamation-triangle"></i> Invalid username or password
                </div>
            </form>
        </div>
    </div>

    <!-- Main Admin Container (hidden until login) -->
    <div id="admin-container" class="admin-container" style="display: none;">
        <div class="admin-header">
            <h1><i class="fas fa-images"></i> Gallery Admin Portal</h1>
            <p>Manage your solar installation gallery</p>
            <button class="btn btn-secondary logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>

        <div class="admin-nav">
            <div class="nav-tabs">
                <div class="nav-tab active" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </div>
                <div class="nav-tab" data-tab="add-item">
                    <i class="fas fa-plus"></i> Add Project
                </div>
                <div class="nav-tab" data-tab="manage-items">
                    <i class="fas fa-edit"></i> Manage Projects
                </div>
                <div class="nav-tab" data-tab="export">
                    <i class="fas fa-download"></i> Export JSON
                </div>
            </div>
        </div>

        <div class="admin-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-projects">0</div>
                        <div class="stat-label">Total Projects</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="residential-count">0</div>
                        <div class="stat-label">Residential</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="commercial-count">0</div>
                        <div class="stat-label">Commercial</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="sunsynk-count">0</div>
                        <div class="stat-label">Sunsynk Systems</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="general-count">0</div>
                        <div class="stat-label">General Systems</div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <strong>Welcome to the Gallery Admin Portal!</strong><br>
                    Use this portal to manage your solar installation gallery. Add new projects, edit existing ones, and export the JSON file for your website.
                </div>
            </div>

            <!-- Add Item Tab -->
            <div id="add-item" class="tab-content">
                <div class="form-section">
                    <h3><i class="fas fa-plus-circle"></i> Add New Project</h3>
                    <form id="add-project-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="project-title">Project Title *</label>
                                <input type="text" id="project-title" required placeholder="e.g., Sunsynk Hybrid System">
                            </div>
                            <div class="form-group">
                                <label for="project-location">Location *</label>
                                <input type="text" id="project-location" required placeholder="e.g., Cape Town">
                            </div>
                            <div class="form-group">
                                <label for="project-description">Description *</label>
                                <textarea id="project-description" required placeholder="Brief description of the installation"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="project-image">Image Path *</label>
                                <input type="text" id="project-image" required placeholder="images/gallery/residential/sunsynk/project.jpg">
                            </div>
                            <div class="form-group">
                                <label for="project-date">Installation Date *</label>
                                <input type="date" id="project-date" required>
                            </div>
                            <div class="form-group">
                                <label for="project-size">System Size *</label>
                                <input type="text" id="project-size" required placeholder="e.g., 8kW + 10kWh">
                            </div>
                            <div class="form-group">
                                <label for="customer-quote">Customer Quote</label>
                                <textarea id="customer-quote" placeholder="Customer testimonial (optional)"></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label>Categories *</label>
                                <div class="checkbox-group">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cat-residential" value="residential">
                                        <label for="cat-residential">Residential</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cat-commercial" value="commercial">
                                        <label for="cat-commercial">Commercial</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cat-sunsynk" value="sunsynk">
                                        <label for="cat-sunsynk">Sunsynk</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cat-tesla" value="tesla">
                                        <label for="cat-tesla">Tesla</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cat-sigenergy" value="sigenergy">
                                        <label for="cat-sigenergy">Sigenergy</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cat-general" value="general">
                                        <label for="cat-general">General</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <label for="project-components">Components (one per line)</label>
                                <textarea id="project-components" placeholder="Sunsynk 8kW Inverter&#10;2x 5.12kWh Batteries&#10;20x JA Solar Panels"></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label for="project-tags">Tags (comma-separated)</label>
                                <input type="text" id="project-tags" placeholder="Residential, Sunsynk, Cape Town">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-plus"></i> Add Project
                            </button>
                            <button type="button" class="btn btn-secondary" id="cancel-edit-btn" onclick="cancelEdit()" style="display: none;">
                                <i class="fas fa-times"></i> Cancel Edit
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Manage Items Tab -->
            <div id="manage-items" class="tab-content">
                <div class="form-section">
                    <h3><i class="fas fa-edit"></i> Manage Projects</h3>
                    <div id="gallery-items-list" class="gallery-items">
                        <!-- Gallery items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Export Tab -->
            <div id="export" class="tab-content">
                <div class="form-section">
                    <h3><i class="fas fa-download"></i> Export Gallery Data</h3>
                    <p>Copy the JSON data below and save it as <code>gallery-data.json</code> to upload to your website.</p>
                    <button class="btn btn-primary" onclick="copyToClipboard()">
                        <i class="fas fa-copy"></i> Copy to Clipboard
                    </button>
                    <button class="btn btn-success" onclick="downloadJSON()">
                        <i class="fas fa-download"></i> Download JSON File
                    </button>
                    <div id="json-output" class="json-output"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Gallery data storage
        let galleryData = [];

        // Authentication credentials (in production, these should be hashed and stored securely)
        const ADMIN_CREDENTIALS = {
            username: 'stpadmin',
            password: 'Solar@2025!' // Same credentials as main admin portal
        };

        // Session management
        const SESSION_KEY = 'stp-gallery-session';
        const SESSION_TIMEOUT = 2 * 60 * 60 * 1000; // 2 hours

        // Initialize the admin portal
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
            setupEventListeners();
        });

        // Check if user is authenticated
        function checkAuthentication() {
            const session = getSession();
            if (session && session.authenticated && !isSessionExpired(session)) {
                showAdminPanel();
            } else {
                showLoginScreen();
            }
        }

        // Get session data
        function getSession() {
            try {
                const sessionData = localStorage.getItem(SESSION_KEY);
                return sessionData ? JSON.parse(sessionData) : null;
            } catch (e) {
                return null;
            }
        }

        // Check if session is expired
        function isSessionExpired(session) {
            return Date.now() - session.timestamp > SESSION_TIMEOUT;
        }

        // Create new session
        function createSession() {
            const session = {
                authenticated: true,
                timestamp: Date.now()
            };
            localStorage.setItem(SESSION_KEY, JSON.stringify(session));
        }

        // Clear session
        function clearSession() {
            localStorage.removeItem(SESSION_KEY);
        }

        // Show login screen
        function showLoginScreen() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('admin-container').style.display = 'none';
        }

        // Show admin panel
        function showAdminPanel() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-container').style.display = 'block';
            
            // Initialize admin functionality
            loadExistingData();
            updateStats();
            generateJSON();
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                clearSession();
                showLoginScreen();
                // Clear form
                document.getElementById('login-form').reset();
                document.getElementById('login-error').style.display = 'none';
            }
        }

        // Load existing data from localStorage or initialize with sample data
        function loadExistingData() {
            const saved = localStorage.getItem('stp-gallery-data');
            if (saved) {
                galleryData = JSON.parse(saved);
            } else {
                // Initialize with the current gallery data
                galleryData = [
                    {
                        "id": 1,
                        "title": "Sunsynk Hybrid System",
                        "description": "8kW Sunsynk inverter with dual BSL batteries providing reliable backup power",
                        "image": "images/gallery/residential/sunsynk/Sunsynk.jpg",
                        "categories": ["residential", "sunsynk"],
                        "tags": ["Residential", "Sunsynk", "Cape Town"],
                        "date": "2024-01-15",
                        "location": "Cape Town",
                        "systemSize": "8kW",
                        "components": ["Sunsynk 8kW Inverter", "2x 5.12kWh Batteries", "20x JA Solar Panels"],
                        "customerQuote": "Excellent installation and great backup power during load shedding"
                    }
                ];
                saveData();
            }
            renderGalleryItems();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });

            // Tab navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    switchTab(tabId);
                });
            });

            // Add project form
            document.getElementById('add-project-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewProject();
            });

            // Set today's date as default
            document.getElementById('project-date').value = new Date().toISOString().split('T')[0];
        }

        // Handle login
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('login-error');

            // Clear previous error
            errorDiv.style.display = 'none';

            // Validate credentials
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                createSession();
                showAdminPanel();
            } else {
                errorDiv.style.display = 'block';
                // Clear password field
                document.getElementById('password').value = '';
            }
        }

        // Switch between tabs
        function switchTab(tabId) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Add active class to selected tab and content
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');

            // Update data when switching to certain tabs
            if (tabId === 'dashboard') {
                updateStats();
            } else if (tabId === 'manage-items') {
                renderGalleryItems();
            } else if (tabId === 'export') {
                generateJSON();
            }
        }

        // Add new project
        function addNewProject() {
            const form = document.getElementById('add-project-form');
            const formData = new FormData(form);

            // Get categories
            const categories = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                categories.push(checkbox.value);
            });

            // Get components
            const components = document.getElementById('project-components').value
                .split('\n')
                .map(comp => comp.trim())
                .filter(comp => comp.length > 0);

            // Get tags
            const tags = document.getElementById('project-tags').value
                .split(',')
                .map(tag => tag.trim())
                .filter(tag => tag.length > 0);

            // Validate required fields
            if (categories.length === 0) {
                alert('Please select at least one category');
                return;
            }

            const projectData = {
                id: window.currentEditIndex !== undefined && window.currentEditIndex !== null ? 
                    galleryData[window.currentEditIndex].id : Date.now(), // Keep existing ID when editing
                title: document.getElementById('project-title').value,
                description: document.getElementById('project-description').value,
                image: document.getElementById('project-image').value,
                categories: categories,
                tags: tags,
                date: document.getElementById('project-date').value,
                location: document.getElementById('project-location').value,
                systemSize: document.getElementById('project-size').value,
                components: components,
                customerQuote: document.getElementById('customer-quote').value || null
            };

            // Check if we're editing an existing project
            if (window.currentEditIndex !== undefined && window.currentEditIndex !== null) {
                // Update existing project
                galleryData[window.currentEditIndex] = projectData;
                saveData();
                showAlert('Project updated successfully!', 'success');
                
                // Reset edit mode
                window.currentEditIndex = null;
                
                // Switch to manage items tab to see the updated project
                setTimeout(() => {
                    switchTab('manage-items');
                }, 1000);
            } else {
                // Add new project
                galleryData.push(projectData);
                saveData();
                showAlert('Project added successfully!', 'success');
                
                // Switch to manage items tab to see the new project
                setTimeout(() => {
                    switchTab('manage-items');
                }, 1000);
            }
            
            // Reset form and UI
            resetForm();
        }
        
        // Reset form to add new project mode
        function resetForm() {
            const form = document.getElementById('add-project-form');
            form.reset();
            document.getElementById('project-date').value = new Date().toISOString().split('T')[0];
            
            // Reset form title and button
            const formTitle = document.querySelector('#add-item h3');
            formTitle.innerHTML = '<i class="fas fa-plus-circle"></i> Add New Project';
            
            const submitBtn = document.querySelector('#add-project-form button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-plus"></i> Add Project';
            
            // Hide the cancel edit button
            const cancelBtn = document.getElementById('cancel-edit-btn');
            cancelBtn.style.display = 'none';
            
            // Clear edit mode
            window.currentEditIndex = null;
        }
        
        // Cancel edit and return to add mode
        function cancelEdit() {
            if (confirm('Are you sure you want to cancel editing? All changes will be lost.')) {
                resetForm();
                showAlert('Edit cancelled', 'info');
            }
        }

        // Render gallery items in manage tab
        function renderGalleryItems() {
            const container = document.getElementById('gallery-items-list');
            container.innerHTML = '';

            if (galleryData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d;">No projects found. Add your first project!</p>';
                return;
            }

            galleryData.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'gallery-item';
                itemElement.innerHTML = `
                    <div class="item-header">
                        <div class="item-title">${item.title}</div>
                        <div class="item-actions">
                            <button class="btn btn-secondary" onclick="editProject(${index})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-danger" onclick="deleteProject(${index})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                    <div class="item-preview">
                        <div class="preview-image">
                            <img src="${item.image}" alt="${item.title}" 
                                 onerror="this.style.display='none'; this.parentNode.innerHTML='<i class=&quot;fas fa-image&quot;></i><br>Image not found';">
                        </div>
                        <div class="preview-info">
                            <span><strong>Location:</strong> ${item.location}</span>
                            <span><strong>Size:</strong> ${item.systemSize}</span>
                            <span><strong>Date:</strong> ${new Date(item.date).toLocaleDateString()}</span>
                            <span><strong>Categories:</strong> ${item.categories.join(', ')}</span>
                            <span><strong>Tags:</strong> ${item.tags.join(', ')}</span>
                        </div>
                    </div>
                `;
                container.appendChild(itemElement);
            });
        }

        // Edit project
        function editProject(index) {
            const item = galleryData[index];
            
            // Store the current edit index
            window.currentEditIndex = index;
            
            // Switch to the add item tab
            switchTab('add-item');
            
            // Update the form title
            const formTitle = document.querySelector('#add-item h3');
            formTitle.innerHTML = '<i class="fas fa-edit"></i> Edit Project';
            
            // Update the submit button
            const submitBtn = document.querySelector('#add-project-form button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Project';
            
            // Show the cancel edit button
            const cancelBtn = document.getElementById('cancel-edit-btn');
            cancelBtn.style.display = 'inline-block';
            
            // Populate the form with existing data
            document.getElementById('project-title').value = item.title;
            document.getElementById('project-location').value = item.location;
            document.getElementById('project-description').value = item.description;
            document.getElementById('project-image').value = item.image;
            document.getElementById('project-date').value = item.date;
            document.getElementById('project-size').value = item.systemSize;
            document.getElementById('customer-quote').value = item.customerQuote;
            document.getElementById('project-components').value = item.components.join('\n');
            document.getElementById('project-tags').value = item.tags.join(', ');
            
            // Clear all checkboxes first
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Check the appropriate category checkboxes
            item.categories.forEach(category => {
                const checkbox = document.querySelector(`input[value="${category}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
            
            // Scroll to the form
            document.getElementById('add-item').scrollIntoView({ behavior: 'smooth' });
        }

        // Delete project
        function deleteProject(index) {
            const item = galleryData[index];
            if (confirm(`Are you sure you want to delete "${item.title}"?`)) {
                galleryData.splice(index, 1);
                saveData();
                renderGalleryItems();
                updateStats();
                showAlert('Project deleted successfully!', 'success');
            }
        }

        // Update statistics
        function updateStats() {
            document.getElementById('total-projects').textContent = galleryData.length;
            
            const residential = galleryData.filter(item => item.categories.includes('residential')).length;
            const commercial = galleryData.filter(item => item.categories.includes('commercial')).length;
            const sunsynk = galleryData.filter(item => item.categories.includes('sunsynk')).length;
            const general = galleryData.filter(item => item.categories.includes('general')).length;
            
            document.getElementById('residential-count').textContent = residential;
            document.getElementById('commercial-count').textContent = commercial;
            document.getElementById('sunsynk-count').textContent = sunsynk;
            document.getElementById('general-count').textContent = general;
        }

        // Generate JSON output
        function generateJSON() {
            const jsonOutput = document.getElementById('json-output');
            const jsonData = {
                galleryItems: galleryData
            };
            jsonOutput.textContent = JSON.stringify(jsonData, null, 2);
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('stp-gallery-data', JSON.stringify(galleryData));
            generateJSON();
        }

        // Copy to clipboard
        function copyToClipboard() {
            const jsonOutput = document.getElementById('json-output');
            navigator.clipboard.writeText(jsonOutput.textContent).then(() => {
                showAlert('JSON data copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showAlert('Failed to copy to clipboard', 'danger');
            });
        }

        // Download JSON file
        function downloadJSON() {
            const jsonData = {
                galleryItems: galleryData
            };
            
            const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gallery-data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('JSON file downloaded!', 'success');
        }

        // Show alert message
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
            
            const content = document.querySelector('.admin-content');
            content.insertBefore(alertDiv, content.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }
    </script>
</body>
</html>
