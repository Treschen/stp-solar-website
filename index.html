<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STP Solar - Premium Solar Solutions in South Africa</title>
    <meta name="description" content="STP Solar provides premium solar panel installation, maintenance, and energy solutions for homes and businesses across South Africa. Save money and go green with our expert solar services.">
    <meta name="keywords" content="solar panels, solar installation, renewable energy, South Africa, solar power, energy savings">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="STP Solar - Premium Solar Solutions">
    <meta property="og:description" content="Transform your energy costs with STP Solar's premium solar solutions. Expert installation and maintenance across South Africa.">
    <meta property="og:type" content="website">
    
    <!-- Cache Control Meta Tags -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="version" content="4.0">
    <meta http-equiv="Expires" content="0">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico?v=1.0">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Styles with cache busting -->
    <link rel="stylesheet" href="styles.css?v=2.2">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-solar-panel"></i>
                <span>STP Solar</span>
            </div>
            
            <div class="nav-menu" id="nav-menu">
                <a href="#home" class="nav-link">Home</a>
                <a href="#services" class="nav-link">Services</a>
                <a href="#gallery" class="nav-link">Gallery</a>
                <a href="#reviews" class="nav-link">Reviews</a>
                <a href="#about" class="nav-link">About</a>
                <a href="#calculator" class="nav-link">System Builder</a>
                <a href="#contact" class="nav-link">Contact</a>
            </div>
            
            <div class="nav-toggle" id="nav-toggle">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="hero-container">
            <div class="hero-content">
                <h1 class="hero-title">
                    Power Your Future with 
                    <span class="highlight">Premium Solar Solutions</span>
                </h1>
                <p class="hero-subtitle">
                    STP Solar specializes in residential and commercial solar installations using Tier 1 panels from JA Solar and Canadian Solar, with premium inverters from Sigenstor, Sunsynk, and Tesla Powerwall 3 systems.
                </p>
                <div class="hero-buttons">
                    <a href="#calculator" class="btn btn-primary">
                        <i class="fas fa-cogs"></i>
                        Build Your System
                    </a>
                    <a href="#contact" class="btn btn-secondary">
                        <i class="fas fa-phone"></i>
                        Get Free Quote
                    </a>
                    <a href="https://wa.me/27817480779" target="_blank" class="btn btn-whatsapp">
                        <i class="fab fa-whatsapp"></i>
                        WhatsApp Us
                    </a>
                </div>
                <div class="hero-stats">
                    <div class="stat">
                        <span class="stat-number">100+</span>
                        <span class="stat-label">Happy Customers</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">5MW+</span>
                        <span class="stat-label">Solar Installed</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">90%</span>
                        <span class="stat-label">Average Savings</span>
                    </div>
                </div>
            </div>
            <div class="hero-image">
                <div class="solar-panel-illustration">
                    <i class="fas fa-solar-panel solar-icon"></i>
                    <div class="energy-lines">
                        <div class="energy-line"></div>
                        <div class="energy-line"></div>
                        <div class="energy-line"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="services">
        <div class="container">
            <div class="section-header">
                <h2>Our Solar Services</h2>
                <p>Comprehensive solar solutions tailored to your energy needs</p>
            </div>
            
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <h3>Residential Solar</h3>
                    <p>Complete home solar systems featuring JA Solar and Canadian Solar panels with Sigenstor, Sunsynk inverters, and Tesla Powerwall 3 backup solutions.</p>
                    <ul class="service-features">
                        <li>JA Solar & Canadian Solar panels</li>
                        <li>Tesla Powerwall 3 backup systems</li>
                        <li>Sigenstor & Sunsynk inverters</li>
                        <li>Grid-tie and hybrid solutions</li>
                    </ul>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <h3>Commercial Solar</h3>
                    <p>Large-scale commercial installations using premium Tier 1 panels and industrial-grade inverters for maximum efficiency and ROI.</p>
                    <ul class="service-features">
                        <li>Industrial solar farms</li>
                        <li>Commercial rooftop systems</li>
                        <li>High-capacity inverters</li>
                        <li>Business backup solutions</li>
                    </ul>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-tools"></i>
                    </div>
                    <h3>Maintenance & Support</h3>
                    <p>Professional maintenance services to ensure your solar system operates at peak efficiency for decades.</p>
                    <ul class="service-features">
                        <li>Regular system inspections</li>
                        <li>Panel cleaning services</li>
                        <li>Performance monitoring</li>
                        <li>24/7 technical support</li>
                    </ul>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Energy Consulting</h3>
                    <p>Expert energy audits and consulting to optimize your power consumption and maximize solar investment returns.</p>
                    <ul class="service-features">
                        <li>Energy consumption analysis</li>
                        <li>System sizing optimization</li>
                        <li>Financial modeling</li>
                        <li>Government incentive guidance</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Solar System Builder Section -->
    <section id="calculator" class="calculator">
        <div class="container">
            <div class="section-header">
                <h2>
                    <i class="fas fa-solar-panel"></i>
                    <i class="fas fa-cogs"></i>
                    Solar System Builder
                </h2>
                <p>
                    <i class="fas fa-home"></i>
                    Choose the perfect solar system for your home or business
                </p>
            </div>
            
            <div class="system-builder-container">
                <!-- System Type Selection -->
                <div class="system-type-selection">
                    <h3>
                        <i class="fas fa-list-ul"></i>
                        Select System Type
                    </h3>
                    <p class="system-type-description">
                        <i class="fas fa-check-circle"></i>
                        Choose from our available solar systems
                    </p>
                    
                    <div class="system-type-dropdown">
                        <select id="system-type-select" onchange="selectSystemType()">
                            <option value="">Select System Type</option>
                            <!-- Will be populated by admin portal data -->
                        </select>
                    </div>
                </div>
                
                <!-- Phase Selection -->
                <div class="phase-selection" id="phase-selection" style="display: none;">
                    <h3>
                        <i class="fas fa-bolt"></i>
                        Select Your Power Type
                    </h3>
                    <p class="phase-description">
                        <i class="fas fa-info-circle"></i>
                        Please select the type of power you have. If you are not sure, please select Single Phase.
                    </p>
                    
                    <div class="phase-options" id="phase-options">
                        <!-- Will be populated by admin portal data -->
                    </div>
                </div>
                
                <!-- System Selection -->
                <div class="system-selection" id="system-selection" style="display: none;">
                    <h3>Choose Your System</h3>
                    <div class="systems-grid" id="systems-grid">
                        <!-- Systems will be populated by admin portal data -->
                    </div>
                </div>
                
                <!-- Customization Section -->
                <div class="customization-section" id="customization-section" style="display: none;">
                    <h3>Customize Your System</h3>
                    <div class="customization-grid">
                        <div class="customization-item">
                            <h5>Solar Panels</h5>
                            <div class="selection-controls">
                                <select id="panel-selection" onchange="selectPanel()" class="component-select">
                                    <option value="">Select Panel Type</option>
                                    <!-- Will be populated by admin portal data -->
                                </select>
                            </div>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="adjustPanels(-1)">-</button>
                                <span class="quantity-display" id="panels-quantity">6</span>
                                <button class="quantity-btn" onclick="adjustPanels(1)">+</button>
                            </div>
                            <div class="quantity-limits">
                                <small>Range: 0 - <span id="panels-max">50</span> panels (0 = no panels, <span id="panels-min">6</span>+ recommended)</small>
                            </div>
                            
                            <!-- No Solar Panels Option -->
                            <div class="no-panels-option">
                                <label class="no-panels-checkbox">
                                    <input type="checkbox" id="no-panels-checkbox" onchange="toggleNoPanels(this)">
                                    <span class="checkmark"></span>
                                    <span class="checkbox-label">No solar panels required</span>
                                </label>
                            </div>
                            
                            <!-- Roof Type Selection -->
                            <div class="roof-type-selection">
                                <h6>Roof Type</h6>
                                <div class="roof-options" id="roof-options">
                                    <!-- Will be populated by admin portal data -->
                                </div>
                            </div>
                            
                            <p class="customization-price" id="panels-price">R0</p>
                        </div>
                        
                        <div class="customization-item">
                            <h5>Batteries</h5>
                            <div class="selection-controls">
                                <select id="battery-selection" onchange="selectBattery()" class="component-select">
                                    <option value="">Select Battery Type</option>
                                    <!-- Will be populated by admin portal data -->
                                </select>
                            </div>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="adjustBatteries(-1)">-</button>
                                <span class="quantity-display" id="batteries-quantity">1</span>
                                <button class="quantity-btn" onclick="adjustBatteries(1)">+</button>
                            </div>
                            <div class="quantity-limits">
                                <small>Range: <span id="batteries-min">1</span> - <span id="batteries-max">10</span> batteries (required)</small>
                            </div>
                            <p class="customization-price" id="batteries-price">R0</p>
                        </div>
                    </div>
                    
                    <div class="pricing-summary">
                        <h4>System Pricing</h4>
                        <div class="pricing-item">
                            <span id="inverter-label">Inverter</span>
                            <span id="inverter-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span id="battery-label">Batteries</span>
                            <span id="battery-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span id="panel-label">Solar Panels</span>
                            <span id="panel-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span id="roof-mounting-label">Solar Panel Mounting Kit</span>
                            <span id="roof-mounting-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span id="accessories-label">Accessories</span>
                            <span id="accessories-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span id="installation-label">Installation</span>
                            <span id="installation-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span><strong>Total System Price (inc. VAT)</strong></span>
                            <span><strong id="total-price">R0</strong></span>
                        </div>
                    </div>
                    
                    <div class="quote-request-section">
                        <button id="request-quote-btn" class="btn btn-primary" onclick="showQuoteModal()">
                            <i class="fas fa-paper-plane"></i> Request Quote
                        </button>
                        <p class="quote-note">Get an immediate quote sent directly to your email</p>
                        <div class="disclaimer">
                            <p><strong>Please note:</strong> All estimates are preliminary and subject to change based on final site assessment. Maximum cable lengths included: 10m AC cable and 30m PV cable per string. All systems include sub-distribution boards, circuit breakers, isolators, and standard installation components. Final pricing will be confirmed after site visit and detailed assessment.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Reviews Section -->
    <section id="reviews" class="reviews">
        <div class="container">
            <div class="section-header">
                <h2>What Our Customers Say</h2>
                <p>Real reviews from satisfied STP Solar customers</p>
            </div>
            
            <div class="reviews-container">
                <div class="reviews-slider" id="reviews-slider">
                    <!-- Review 1 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Diksha S.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Extremely high quality service, wouldn't hire anyone else. Very trustworthy with quality panels and inverters. Saved over R5k a month on electricity bill and no load shedding issues."</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                    
                    <!-- Review 2 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Denise G.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Hassle free, efficient, professional and friendly service. This dynamic father and son team work seamlessly together and had our solar power solution installed and working in record time! Thank you!"</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                    
                    <!-- Review 3 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Salmon M.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Excellent service, very professional and attention to detail. Competitive pricing with an experienced team. I would highly recommend them. Thanks Sean, Indres and team."</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                </div>
                
                <div class="reviews-controls">
                    <button class="review-btn prev-btn" id="prev-review">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="review-btn next-btn" id="next-review">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <div class="reviews-stats">
                    <div class="stat-item">
                        <div class="stat-number">5.0</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100+</div>
                        <div class="stat-label">Happy Customers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">Satisfaction Rate</div>
                    </div>
                </div>
                
                <div class="reviews-cta">
                    <a href="https://www.google.com/search?q=stp+solar&oq=stp+solar+&gs_lcrp=EgZjaHJvbWUqDAgAECMYJxiABBiKBTIMCAAQIxgnGIAEGIoFMg0IARAuGK8BGMcBGIAEMgcIAhAAGIAEMgcIAxAAGIAEMgcIBBAAGIAEMgYIBRBFGDwyBggGEEUYPDIGCAcQRRg80gEIMjQ2N2owajeoAgCwAgA&sourceid=chrome&ie=UTF-8#mpd=~2277063622321751607/customers/reviews" target="_blank" class="btn btn-outline">
                        <i class="fab fa-google"></i>
                        Read More Reviews on Google
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery" class="gallery">
        <div class="container">
            <div class="section-header">
                <h2>Our Work Gallery</h2>
                <p>Professional solar installations across South Africa - showcasing our expertise with Sunsynk, Tesla Powerwall, and premium solar solutions</p>
            </div>
            
            <div class="gallery-filters">
                <button class="filter-btn active" data-filter="all">All Projects</button>
                <button class="filter-btn" data-filter="residential">Residential</button>
                <button class="filter-btn" data-filter="commercial">Commercial</button>
                <button class="filter-btn" data-filter="sunsynk">Sunsynk Systems</button>
                <button class="filter-btn" data-filter="tesla">Tesla Powerwall</button>
                <button class="filter-btn" data-filter="sigenergy">Sigenergy Systems</button>
                <button class="filter-btn" data-filter="general">General Systems</button>
            </div>
            
            <div class="gallery-grid" id="gallery-grid">
                <!-- Gallery items will be dynamically generated from JSON data -->
            </div>
            
            <div class="gallery-cta">
                <a href="#contact" class="btn btn-primary">
                    <i class="fas fa-camera"></i>
                    Get Your Project Featured
                </a>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about">
        <div class="container">
            <div class="about-content">
                <div class="about-text">
                    <h2>Why Choose STP Solar?</h2>
                    <p class="about-intro">
                        With over 10 years of experience in the South African solar industry, STP Solar has established itself as a trusted leader in renewable energy solutions.
                    </p>
                    
                    <div class="about-features">
                        <div class="feature">
                            <i class="fas fa-award"></i>
                            <div>
                                <h4>Certified Excellence</h4>
                                <p>Certified Electrical and Solar installers with industry-leading training and certifications.</p>
                            </div>
                        </div>
                        
                        <div class="feature">
                            <i class="fas fa-shield-alt"></i>
                            <div>
                                <h4>Standard Industry Warranty</h4>
                                <p>10 years on inverters and batteries, 12 years on solar panels. Comprehensive warranty coverage on all installations and components.</p>
                            </div>
                        </div>
                        
                        <div class="feature">
                            <i class="fas fa-leaf"></i>
                            <div>
                                <h4>Eco-Friendly</h4>
                                <p>Reduce your carbon footprint while saving money on energy costs.</p>
                            </div>
                        </div>
                        
                        <div class="feature">
                            <i class="fas fa-headset"></i>
                            <div>
                                <h4>24/7 Support</h4>
                                <p>Round-the-clock technical support and maintenance services.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="about-image">
                    <div class="image-placeholder">
                        <i class="fas fa-solar-panel"></i>
                        <p>Professional Installation Team</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="portfolio">
        <div class="container">
            <div class="section-header">
                <h2>Our Recent Projects</h2>
                <p>See the quality of our solar installations</p>
            </div>
            
            <div class="portfolio-grid">
                <div class="portfolio-item">
                    <div class="portfolio-image">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="portfolio-content">
                        <h3>Residential Installation</h3>
                        <p>5kW system with battery backup</p>
                        <span class="portfolio-location">Fourways, Gauteng</span>
                    </div>
                </div>
                
                <div class="portfolio-item">
                    <div class="portfolio-image">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="portfolio-content">
                        <h3>Commercial Project</h3>
                        <p>50kW industrial solar farm</p>
                        <span class="portfolio-location">Krammerville, Johannesburg</span>
                    </div>
                </div>
                
                <div class="portfolio-item">
                    <div class="portfolio-image">
                        <i class="fas fa-industry"></i>
                    </div>
                    <div class="portfolio-content">
                        <h3>Factory Installation</h3>
                        <p>100kW manufacturing facility</p>
                        <span class="portfolio-location">Centurion, Gauteng</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="contact">
        <div class="container">
            <div class="section-header">
                <h2>Get Your Free Solar Quote</h2>
                <p>Ready to start saving on your electricity bills?</p>
            </div>
            
            <div class="contact-content">
                <div class="contact-form">
                    <form id="quote-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="name">Full Name *</label>
                                <input type="text" id="name" name="name" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address *</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="phone">Phone Number *</label>
                                <input type="tel" id="phone" name="phone" required>
                            </div>
                            <div class="form-group">
                                <label for="location">City</label>
                                <input type="text" id="location" name="location" placeholder="e.g., Cape Town">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="monthly-bill">Monthly Electricity Bill (R)</label>
                            <input type="number" id="monthly-bill" name="monthly-bill" placeholder="2500">
                        </div>
                        
                        <div class="form-group">
                            <label for="message">Additional Information</label>
                            <textarea id="message" name="message" rows="4" placeholder="Tell us about your energy needs, roof type, or any specific requirements..."></textarea>
                        </div>
                        
                        <!-- Hidden field for system configuration -->
                        <input type="hidden" id="system-config" name="system-config" value="">
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            Request Free Quote
                        </button>
                    </form>
                </div>
                
                <div class="contact-info">
                    <h3>Contact Information</h3>
                    
                    <div class="contact-item">
                        <i class="fas fa-mobile-alt"></i>
                        <div>
                            <h4>Mobile</h4>
                            <p><a href="tel:0817480779">081 748 0779</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <div>
                            <h4>Landline</h4>
                            <p><a href="tel:0105007999">010 500 7999</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <h4>Email</h4>
                            <p><a href="mailto:info@stpsolar.co.za">info@stpsolar.co.za</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <h4>Address</h4>
                            <p>Savanna Hills Estate<br>Midrand, Gauteng, 1682</p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fab fa-whatsapp"></i>
                        <div>
                            <h4>WhatsApp</h4>
                            <p><a href="https://wa.me/27817480779" target="_blank">Chat with us on WhatsApp</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <h4>Business Hours</h4>
                            <p>Monday - Friday: 8:00 AM - 6:00 PM<br>Saturday: 9:00 AM - 2:00 PM<br>Sunday: Closed</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Floating WhatsApp Button -->
    <div class="whatsapp-float">
        <a href="https://wa.me/27817480779" target="_blank" class="whatsapp-btn">
            <i class="fab fa-whatsapp"></i>
        </a>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-solar-panel"></i>
                        <span>STP Solar</span>
                    </div>
                    <p>Leading South Africa's transition to clean, renewable solar energy. Professional installation and maintenance services you can trust.</p>
                    <div class="social-links">
                        <a href="https://www.facebook.com/www.stpsolar.co.za" target="_blank" class="social-link"><i class="fab fa-facebook"></i></a>
                        <a href="https://www.instagram.com/stp_solar/" target="_blank" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.linkedin.com/company/92800961" target="_blank" class="social-link"><i class="fab fa-linkedin"></i></a>
                        <a href="https://www.youtube.com/@stpsolar" target="_blank" class="social-link"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Services</h4>
                    <ul>
                        <li><a href="#services">Residential Solar</a></li>
                        <li><a href="#services">Commercial Solar</a></li>
                        <li><a href="#services">Maintenance</a></li>
                        <li><a href="#services">Energy Consulting</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="#about">About Us</a></li>
                        <li><a href="#portfolio">Portfolio</a></li>
                        <li><a href="#contact">Contact</a></li>
                        <li><a href="#">Careers</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#calculator">Solar Calculator</a></li>
                        <li><a href="#">Solar Guide</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Blog</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="terms-conditions.html">Terms & Conditions</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="#">Warranty Information</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 STP Solar. All rights reserved. | <a href="privacy-policy.html">Privacy Policy</a> | <a href="terms-conditions.html">Terms & Conditions</a></p>
            </div>
            
            <div class="footer-credit">
                <p>Website designed and hosted by STP Networks Pty Ltd</p>
            </div>
        </div>
    </footer>

    <!-- Quote Request Modal -->
    <div id="quoteModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-paper-plane"></i> Request Your Solar Quote</h3>
                <span class="close" onclick="closeQuoteModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="modal-quote-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="quote-name">Full Name *</label>
                            <input type="text" id="quote-name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="quote-email">Email Address *</label>
                            <input type="email" id="quote-email" name="email" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="quote-phone">Phone Number *</label>
                        <input type="tel" id="quote-phone" name="phone" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="quote-message">Additional Information</label>
                        <textarea id="quote-message" name="message" rows="4" placeholder="Tell us about your energy needs, roof type, or any specific requirements..."></textarea>
                    </div>
                    
                    <div class="system-summary">
                        <h4>Selected System</h4>
                        <div id="modal-system-details">
                            <!-- System details will be populated here -->
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeQuoteModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Send Quote Request
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Solar Admin Portal V2 Data Bridge -->
    <script src="solar-config-v2.js?v=1.0"></script>
    
    <!-- V2 System Builder Script -->
    <script>
        // V2 System Builder - Integrated with Admin Portal
        console.log('V2 System Builder initializing...');

        // Global variables for current selection
        let currentSystemType = null;
        let currentSystemId = null;
        let currentPhaseId = null;
        let currentPanelId = null;
        let currentBatteryId = null;
        let currentRoofTypeId = null;
        let currentQuantities = {
            panels: 6,
            batteries: 1
        };

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM loaded, initializing V2 System Builder...');
            
            // Wait for data bridge to initialize
            await SolarConfigV2.initializeDataBridge();
            
            // Initialize system builder
            initializeSystemBuilder();
            initializeNavigation();
            initializeQuoteForm();
        });

        // Initialize System Builder
        function initializeSystemBuilder() {
            console.log('Initializing system builder...');
            console.log('Checking if data is loaded via getSystemTypes()...');
            
            const systemTypes = SolarConfigV2.getSystemTypes();
            console.log('getSystemTypes() returned:', systemTypes);
            
            // Populate system type dropdown
            populateSystemTypeDropdown();
            
            // Initialize quantities
            updateQuantityDisplay();
        }

        // Populate System Type Dropdown
        function populateSystemTypeDropdown() {
            const select = document.getElementById('system-type-select');
            const systemTypes = SolarConfigV2.getSystemTypes();
            
            console.log('Available system types:', systemTypes);
            
            // Clear existing options (keep first empty option)
            select.innerHTML = '<option value="">Select System Type</option>';
            
            if (systemTypes.length === 0) {
                console.error('No system types available!');
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No systems available - please refresh';
                option.disabled = true;
                select.appendChild(option);
                return;
            }
            
            // Add system types from admin portal
            systemTypes.forEach(system => {
                const option = document.createElement('option');
                option.value = system.id;
                option.textContent = system.name;
                select.appendChild(option);
                console.log('Added system option:', system.name);
            });
        }

        // System Type Selection
        function selectSystemType() {
            const select = document.getElementById('system-type-select');
            currentSystemType = select.value;
            currentSystemId = select.value;
            
            console.log('System type selected:', currentSystemType);
            
            if (currentSystemType) {
                // Show phase selection
                showPhaseSelection();
            } else {
                hideAllSections();
            }
        }

        // Show Phase Selection
        function showPhaseSelection() {
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) return;
            
            const phase = SolarConfigV2.getPhaseInfo(system.phase);
            if (!phase) return;
            
            const phaseOptions = document.getElementById('phase-options');
            phaseOptions.innerHTML = `
                <div class="phase-option" data-phase="${phase.id}" onclick="selectPhase('${phase.id}')">
                    <div class="phase-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <h4>${phase.name}</h4>
                    <p>${phase.name === 'Single Phase' ? 'Most residential homes' : 'Large homes and businesses'}</p>
                </div>
            `;
            
            document.getElementById('phase-selection').style.display = 'block';
            currentPhaseId = phase.id;
            
            // Auto-select the phase and show system selection
            setTimeout(() => {
                selectPhase(phase.id);
            }, 100);
        }

        // Phase Selection
        function selectPhase(phaseId) {
            currentPhaseId = phaseId;
            console.log('Phase selected:', phaseId);
            
            // Show system selection
            showSystemSelection();
        }

        // Show System Selection
        function showSystemSelection() {
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) return;
            
            const systemsGrid = document.getElementById('systems-grid');
            
            // Create system card
            const systemCard = document.createElement('div');
            systemCard.className = 'system-card';
            systemCard.innerHTML = `
                <div class="system-card-header">
                    <h4 class="system-title">${system.name}</h4>
                </div>
                <div class="system-card-content">
                    <div class="system-features">
                        <div class="feature">
                            <i class="fas fa-bolt"></i>
                            <span>Inverter Included</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-battery-full"></i>
                            <span>Battery Backup</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-solar-panel"></i>
                            <span>Solar Panels</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-home"></i>
                            <span>Installation Included</span>
                        </div>
                    </div>
                    <div class="system-price">
                        <span class="price-label">Starting from</span>
                        <span class="price-amount" id="system-starting-price">R0</span>
                    </div>
                    <button class="btn btn-primary" onclick="selectSystem('${system.id}')">
                        Select This System
                    </button>
                </div>
            `;
            
            systemsGrid.innerHTML = '';
            systemsGrid.appendChild(systemCard);
            
            // Calculate and show starting price
            updateStartingPrice();
            
            document.getElementById('system-selection').style.display = 'block';
        }

        // Select System
        function selectSystem(systemId) {
            currentSystemId = systemId;
            console.log('System selected:', systemId);
            
            // Show customization section
            showCustomizationSection();
        }

        // Show Customization Section
        function showCustomizationSection() {
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) return;
            
            // Update quantity limits
            const limits = SolarConfigV2.getSystemLimits(currentSystemId);
            if (limits) {
                console.log('System limits:', limits);
                document.getElementById('panels-min').textContent = limits.panelMin;
                document.getElementById('panels-max').textContent = limits.panelMax;
                document.getElementById('batteries-min').textContent = limits.batteryMin;
                document.getElementById('batteries-max').textContent = limits.batteryMax;
                
                // Reset quantities to system minimums
                currentQuantities.panels = limits.panelMin;
                currentQuantities.batteries = limits.batteryMin;
                updateQuantityDisplay();
            }
            
            // Populate panels dropdown
            populatePanelsDropdown();
            
            // Populate batteries dropdown
            populateBatteriesDropdown();
            
            // Populate roof types
            populateRoofTypes();
            
            // Auto-select default roof type if available
            const defaultRoofType = SolarConfigV2.getSystemDefaultRoofType(currentSystemId);
            if (defaultRoofType) {
                // Set the default roof type selection
                const roofTypeRadio = document.querySelector(`input[name="roof-type"][value="${defaultRoofType}"]`);
                if (roofTypeRadio) {
                    roofTypeRadio.checked = true;
                    currentRoofTypeId = defaultRoofType;
                    console.log('Auto-selected default roof type:', defaultRoofType);
                }
            }
            
            // Show section
            document.getElementById('customization-section').style.display = 'block';
            
            // Initialize pricing
            updateAllPricing();
        }

        // Populate Panels Dropdown
        function populatePanelsDropdown() {
            const select = document.getElementById('panel-selection');
            const panels = SolarConfigV2.getSystemPanels(currentSystemId);
            
            select.innerHTML = '<option value="">Select Panel Type</option>';
            
            panels.forEach(panel => {
                const option = document.createElement('option');
                option.value = panel.id;
                option.textContent = `${panel.name} - R${parseFloat(panel.price).toLocaleString('en-ZA')}`;
                select.appendChild(option);
            });
        }

        // Populate Batteries Dropdown
        function populateBatteriesDropdown() {
            const select = document.getElementById('battery-selection');
            const batteries = SolarConfigV2.getSystemBatteries(currentSystemId);
            
            select.innerHTML = '<option value="">Select Battery Type</option>';
            
            batteries.forEach(battery => {
                const option = document.createElement('option');
                option.value = battery.id;
                option.textContent = `${battery.name} - R${parseFloat(battery.price).toLocaleString('en-ZA')}`;
                select.appendChild(option);
            });
        }

        // Populate Roof Types
        function populateRoofTypes() {
            const container = document.getElementById('roof-options');
            const roofTypes = SolarConfigV2.getSystemRoofTypes(currentSystemId);
            
            container.innerHTML = '';
            
            roofTypes.forEach(roofType => {
                const label = document.createElement('label');
                label.className = 'roof-option';
                label.innerHTML = `
                    <input type="radio" name="roof-type" value="${roofType.id}" onchange="updateRoofType('${roofType.id}')">
                    <span class="roof-label">${roofType.name} - R${parseFloat(roofType.price).toLocaleString('en-ZA')} per panel</span>
                `;
                container.appendChild(label);
            });
        }

        // Panel Selection
        function selectPanel() {
            const select = document.getElementById('panel-selection');
            currentPanelId = select.value;
            console.log('Panel selected:', currentPanelId);
            updateAllPricing();
        }

        // Battery Selection
        function selectBattery() {
            const select = document.getElementById('battery-selection');
            currentBatteryId = select.value;
            console.log('Battery selected:', currentBatteryId);
            updateAllPricing();
        }

        // Roof Type Selection
        function updateRoofType(roofTypeId) {
            currentRoofTypeId = roofTypeId;
            console.log('Roof type selected:', roofTypeId);
            updateAllPricing();
        }

        // Adjust Panels
        function adjustPanels(delta) {
            const limits = SolarConfigV2.getSystemLimits(currentSystemId);
            if (!limits) {
                console.log('No limits found, allowing any quantity');
                const newQuantity = currentQuantities.panels + delta;
                if (newQuantity >= 0) {
                    currentQuantities.panels = newQuantity;
                    updateQuantityDisplay();
                    updateAllPricing();
                }
                return;
            }
            
            let newQuantity = currentQuantities.panels + delta;
            
            // Special case: if going up from 0, jump directly to minimum
            if (currentQuantities.panels === 0 && delta > 0) {
                newQuantity = limits.panelMin;
                console.log('Jumping from 0 to minimum:', newQuantity);
            }
            
            console.log('Panel adjustment:', {
                current: currentQuantities.panels,
                delta: delta,
                newQuantity: newQuantity,
                limits: limits
            });
            
            // Allow 0 panels (customer choice), or within the defined range
            if (newQuantity === 0 || 
                (newQuantity >= limits.panelMin && newQuantity <= limits.panelMax)) {
                currentQuantities.panels = newQuantity;
                console.log('Panel quantity updated to:', currentQuantities.panels);
                updateQuantityDisplay();
                updateAllPricing();
                
                // Sync checkbox state
                const checkbox = document.getElementById('no-panels-checkbox');
                if (checkbox) {
                    checkbox.checked = (newQuantity === 0);
                }
            } else {
                console.log('Panel quantity change blocked:', {
                    newQuantity: newQuantity,
                    panelMin: limits.panelMin,
                    panelMax: limits.panelMax,
                    current: currentQuantities.panels
                });
            }
        }

        // Toggle No Panels Checkbox
        function toggleNoPanels(checkbox) {
            console.log('No panels checkbox toggled:', checkbox.checked);
            
            if (checkbox.checked) {
                // Set panels to 0
                currentQuantities.panels = 0;
                updateQuantityDisplay();
                updateAllPricing();
                console.log('Panels set to 0 via checkbox');
            } else {
                // Set panels to minimum
                const limits = SolarConfigV2.getSystemLimits(currentSystemId);
                if (limits) {
                    currentQuantities.panels = limits.panelMin;
                    updateQuantityDisplay();
                    updateAllPricing();
                    console.log('Panels set to minimum:', limits.panelMin);
                }
            }
        }

        // Set Panels to Zero (for testing)
        function setPanelsToZero() {
            console.log('Setting panels to zero...');
            currentQuantities.panels = 0;
            updateQuantityDisplay();
            updateAllPricing();
            console.log('Panels set to:', currentQuantities.panels);
        }

        // Adjust Batteries
        function adjustBatteries(delta) {
            const limits = SolarConfigV2.getSystemLimits(currentSystemId);
            if (!limits) return;
            
            const newQuantity = currentQuantities.batteries + delta;
            
            if (newQuantity >= limits.batteryMin && newQuantity <= limits.batteryMax) {
                currentQuantities.batteries = newQuantity;
                updateQuantityDisplay();
                updateAllPricing();
            }
        }

        // Update Quantity Display
        function updateQuantityDisplay() {
            document.getElementById('panels-quantity').textContent = currentQuantities.panels;
            document.getElementById('batteries-quantity').textContent = currentQuantities.batteries;
        }

        // Update All Pricing
        function updateAllPricing() {
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) return;
            
            // Calculate individual component prices
            updateComponentPricing(system);
            
            // Calculate total price
            const totalPrice = calculateTotalPrice(system);
            
            // Update display
            document.getElementById('total-price').textContent = `R${totalPrice.toLocaleString('en-ZA')}`;
            
            // Update starting price in system selection
            updateStartingPrice();
        }

        // Update Component Pricing
        function updateComponentPricing(system) {
            // Inverter price
            const inverter = SolarConfigV2.getComponent(system.inverter, 'inverters');
            const inverterPrice = inverter ? parseFloat(inverter.price) : 0;
            document.getElementById('inverter-price').textContent = `R${inverterPrice.toLocaleString('en-ZA')}`;
            document.getElementById('inverter-label').textContent = inverter ? inverter.name : 'Inverter';
            
            // Battery price
            let batteryPrice = 0;
            let batteryLabel = 'Batteries';
            if (currentBatteryId) {
                const battery = SolarConfigV2.getComponent(currentBatteryId, 'batteries');
                if (battery) {
                    batteryPrice = parseFloat(battery.price) * currentQuantities.batteries;
                    batteryLabel = `${battery.name} (${currentQuantities.batteries}x)`;
                }
            }
            document.getElementById('battery-price').textContent = `R${batteryPrice.toLocaleString('en-ZA')}`;
            document.getElementById('battery-label').textContent = batteryLabel;
            
            // Panel price
            let panelPrice = 0;
            let panelLabel = 'Solar Panels';
            if (currentPanelId && currentQuantities.panels > 0) {
                const panel = SolarConfigV2.getComponent(currentPanelId, 'panels');
                if (panel) {
                    panelPrice = parseFloat(panel.price) * currentQuantities.panels;
                    panelLabel = `${panel.name} (${currentQuantities.panels}x)`;
                }
            } else if (currentQuantities.panels === 0) {
                panelLabel = 'Solar Panels (0x - No panels selected)';
            }
            document.getElementById('panel-price').textContent = `R${panelPrice.toLocaleString('en-ZA')}`;
            document.getElementById('panel-label').textContent = panelLabel;
            
            // Roof mounting kit price
            let roofMountingPrice = 0;
            if (currentRoofTypeId && currentQuantities.panels > 0) {
                const roofType = SolarConfigV2.getComponent(currentRoofTypeId, 'rooftypes');
                if (roofType) {
                    roofMountingPrice = parseFloat(roofType.price) * currentQuantities.panels;
                }
            }
            document.getElementById('roof-mounting-price').textContent = `R${roofMountingPrice.toLocaleString('en-ZA')}`;
            
            // Accessories price
            const accessories = SolarConfigV2.getComponent(system.accessories, 'accessories');
            const accessoriesPrice = accessories ? parseFloat(accessories.price) : 0;
            document.getElementById('accessories-price').textContent = `R${accessoriesPrice.toLocaleString('en-ZA')}`;
            
            // Installation price
            const installation = SolarConfigV2.getComponent(system.installation, 'installation');
            const installationPrice = installation ? parseFloat(installation.price) : 0;
            document.getElementById('installation-price').textContent = `R${installationPrice.toLocaleString('en-ZA')}`;
        }

        // Calculate Total Price
        function calculateTotalPrice(system) {
            const quantities = {
                panelCount: currentQuantities.panels,
                batteryCount: currentQuantities.batteries,
                roofType: currentRoofTypeId,
                panelId: currentPanelId,
                batteryId: currentBatteryId
            };
            
            return SolarConfigV2.calculateDynamicSystemPrice(system, quantities);
        }

        // Update Starting Price
        function updateStartingPrice() {
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) return;
            
            // Calculate starting price with minimum quantities
            const limits = SolarConfigV2.getSystemLimits(currentSystemId);
            if (limits) {
                const startingQuantities = {
                    panelCount: limits.panelMin,
                    batteryCount: limits.batteryMin,
                    roofType: null // No roof type selected initially
                };
                
                const startingPrice = SolarConfigV2.calculateDynamicSystemPrice(system, startingQuantities);
                document.getElementById('system-starting-price').textContent = `R${startingPrice.toLocaleString('en-ZA')}`;
            }
        }

        // Hide All Sections
        function hideAllSections() {
            document.getElementById('phase-selection').style.display = 'none';
            document.getElementById('system-selection').style.display = 'none';
            document.getElementById('customization-section').style.display = 'none';
        }

        // Navigation Functions (simplified)
        function initializeNavigation() {
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.getElementById('nav-menu');
            
            if (navToggle && navMenu) {
                navToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                    navToggle.classList.toggle('active');
                });
            }
        }

        // Quote Form Functions
        function initializeQuoteForm() {
            const form = document.getElementById('quote-form');
            if (form) {
                form.addEventListener('submit', handleQuoteSubmission);
            }
        }

        // Handle Quote Submission
        function handleQuoteSubmission(event) {
            event.preventDefault();
            
            // Prepare system configuration data
            const systemConfig = prepareSystemConfig();
            
            // Set hidden field
            document.getElementById('system-config').value = JSON.stringify(systemConfig);
            
            // Submit form (this will trigger the webhook)
            console.log('Submitting quote with system config:', systemConfig);
            
            // For testing, show the data that would be sent
            alert('Quote request prepared! System config: ' + JSON.stringify(systemConfig, null, 2));
        }

        // Prepare System Configuration
        function prepareSystemConfig() {
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) return null;
            
            return {
                systemId: currentSystemId,
                systemName: system.name,
                phase: currentPhaseId,
                inverter: system.inverter,
                batteries: currentBatteryId ? [currentBatteryId] : [],
                batteryQuantity: currentQuantities.batteries,
                panels: currentPanelId ? [currentPanelId] : [],
                panelQuantity: currentQuantities.panels,
                roofType: currentRoofTypeId,
                accessories: system.accessories,
                installation: system.installation,
                totalPrice: calculateTotalPrice(system)
            };
        }

        // Quote Modal Functions
        function showQuoteModal() {
            console.log('showQuoteModal called');
            const modal = document.getElementById('quoteModal');
            const systemDetails = document.getElementById('modal-system-details');
            
            console.log('Modal element:', modal);
            console.log('System details element:', systemDetails);
            console.log('Current system ID:', currentSystemId);
            
            if (!modal) {
                console.error('Modal element not found!');
                alert('Modal not found - check console for details');
                return;
            }
            
            // Populate system details
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            console.log('System config:', system);
            
            if (system) {
                const totalPrice = calculateTotalPrice(system);
                console.log('Total price:', totalPrice);
                
                if (systemDetails) {
                    systemDetails.innerHTML = `
                        <div class="system-detail">
                            <strong>System:</strong> ${system.name}
                        </div>
                        <div class="system-detail">
                            <strong>Total Price:</strong> R${totalPrice.toLocaleString('en-ZA')}
                        </div>
                        <div class="system-detail">
                            <strong>Panels:</strong> ${currentQuantities.panels} panels
                        </div>
                        <div class="system-detail">
                            <strong>Batteries:</strong> ${currentQuantities.batteries} batteries
                        </div>
                    `;
                }
            } else {
                console.warn('No system configuration found');
                if (systemDetails) {
                    systemDetails.innerHTML = '<div class="system-detail">No system selected</div>';
                }
            }
            
            console.log('Setting modal display to block');
            modal.style.display = 'flex';
            modal.classList.add('show');
            console.log('Modal display style after setting:', modal.style.display);
            console.log('Modal classes:', modal.className);
        }

        function closeQuoteModal() {
            const modal = document.getElementById('quoteModal');
            modal.style.display = 'none';
            modal.classList.remove('show');
        }

        // Modal Quote Form
        document.addEventListener('DOMContentLoaded', function() {
            const modalForm = document.getElementById('modal-quote-form');
            if (modalForm) {
                modalForm.addEventListener('submit', async function(event) {
                    event.preventDefault();
                    
                    // Get form data
                    const formData = new FormData(modalForm);
                    const customerName = formData.get('name');
                    const customerEmail = formData.get('email');
                    const customerPhone = formData.get('phone');
                    const customerLocation = 'South Africa'; // Default location
                    const customerMessage = formData.get('message') || '';
                    
                    // Validate email
                    if (!isValidEmail(customerEmail)) {
                        alert('Please enter a valid email address');
                        return;
                    }
                    
                    // Close modal
                    closeQuoteModal();
                    
                    // Send quote request
                    await sendQuoteRequest(customerName, customerEmail, customerPhone, customerLocation, customerMessage);
                });
            }
        });

        // Email validation function
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Send quote request function
        async function sendQuoteRequest(customerName, customerEmail, customerPhone, customerLocation, customerMessage) {
            if (!currentSystemId) {
                alert('Please select a system first!');
                return;
            }
            
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) {
                alert('System configuration not found!');
                return;
            }
            
            // Get current quantities from the UI
            const panelQty = currentQuantities.panels;
            const batteryQty = currentQuantities.batteries;
            
            // Get selected components
            const inverter = SolarConfigV2.getComponent(system.inverter, 'inverters');
            const battery = SolarConfigV2.getComponent(currentBatteryId, 'batteries');
            const panel = SolarConfigV2.getComponent(currentPanelId, 'panels');
            const roofType = SolarConfigV2.getComponent(currentRoofTypeId, 'rooftypes');
            const accessories = SolarConfigV2.getComponent(system.accessories, 'accessories');
            const installation = SolarConfigV2.getComponent(system.installation, 'installation');
            
            // Calculate total price
            const totalPrice = calculateTotalPrice(system);
            
            // Calculate VAT-exclusive amounts (divide by 1.15)
            // Since our prices include VAT, we need to send exclusive amounts to QuickBooks
            const vatRate = 1.15;
            const inverterAmountExclVAT = inverter ? Math.round(parseFloat(inverter.price) / vatRate) : 0;
            const batteryAmountExclVAT = battery ? Math.round((parseFloat(battery.price) * batteryQty) / vatRate) : 0;
            const panelAmountExclVAT = panel ? Math.round((parseFloat(panel.price) * panelQty) / vatRate) : 0;
            const roofAmountExclVAT = roofType && panelQty > 0 ? Math.round((parseFloat(roofType.price) * panelQty) / vatRate) : 0;
            const accessoriesAmountExclVAT = accessories ? Math.round(parseFloat(accessories.price) / vatRate) : 0;
            const installationAmountExclVAT = installation ? Math.round(parseFloat(installation.price) / vatRate) : 0;
            
            // Build the webhook payload (compatible with n8n workflow and QuickBooks API)
            // Using proper QuickBooks API Line array structure with VAT-exclusive amounts
            const quoteData = {
                // Customer Info
                customer_name: customerName,
                customer_email: customerEmail,
                customer_phone: customerPhone,
                customer_location: customerLocation,
                customer_message: customerMessage,
                
                // System Info
                system_name: system.name,
                phase: currentPhaseId,
                
                // Line 1: Inverter (using "Solar Product" as item name)
                line1_item_name: 'Solar Product',
                line1_description: inverter ? `${inverter.name} - 1x Inverter` : 'Inverter - Not selected',
                line1_amount: inverterAmountExclVAT,
                line1_quantity: 1,
                
                // Line 2: Battery (using "Solar Product" as item name)
                line2_item_name: 'Solar Product',
                line2_description: battery ? `${battery.name} - ${batteryQty}x Battery${batteryQty > 1 ? 's' : ''}` : 'Battery - Not selected',
                line2_amount: batteryAmountExclVAT,
                line2_quantity: 1,
                
                // Line 3: Panels (using "Solar Product" as item name)
                line3_item_name: 'Solar Product',
                line3_description: panel && panelQty > 0 ? `${panel.name} - ${panelQty}x Solar Panel${panelQty > 1 ? 's' : ''}` : 'Solar Panels - Not selected',
                line3_amount: panelAmountExclVAT,
                line3_quantity: 1,
                
                // Line 4: Roof Mounting Kit (using "Solar Product" as item name)
                line4_item_name: 'Solar Product',
                line4_description: roofType && panelQty > 0 ? `${roofType.name} Mounting Kit - ${panelQty}x Panel Mounting Kit` : 'Panel Mounting Kit - Not required',
                line4_amount: roofAmountExclVAT,
                line4_quantity: 1,
                
                // Line 5: Accessories (using "Solar Product" as item name)
                line5_item_name: 'Solar Product',
                line5_description: accessories ? `${accessories.name} - Installation Accessories & Hardware` : 'Accessories - Installation hardware',
                line5_amount: accessoriesAmountExclVAT,
                line5_quantity: 1,
                
                // Line 6: Installation (using "Solar Product" as item name)
                line6_item_name: 'Solar Product',
                line6_description: installation ? `${installation.name} - Professional Installation & Commissioning` : 'Installation - Professional setup',
                line6_amount: installationAmountExclVAT,
                line6_quantity: 1,
                
                // Total
                total_price: totalPrice
            };
            
            // Show loading state
            const btn = document.getElementById('request-quote-btn');
            if (!btn) {
                console.error('Request Quote button not found!');
                return;
            }
            
            const originalText = btn.innerHTML;
            btn.disabled = true;
            
            // Funky loading messages
            const loadingMessages = [
                '⚡ Charging up the solar magic...',
                '🌞 Calculating your energy savings...',
                '🔋 Crunching numbers like a solar calculator...',
                '⚡ Standby for your system quote...',
                '🌱 Working out the eco-friendly math...',
                '💡 Please wait while we work out magic...',
                '🔌 Plugging into the solar matrix...',
                '⚡ Generating your personalized quote...',
                '🌟 Almost there, solar superstar!'
            ];
            
            let messageIndex = 0;
            const messageInterval = setInterval(() => {
                btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${loadingMessages[messageIndex]}`;
                messageIndex = (messageIndex + 1) % loadingMessages.length;
            }, 1500);
            
            // Show the first message immediately
            btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${loadingMessages[0]}`;
            
            try {
                console.log('Sending quote to n8n:', quoteData);
                
                // Send to n8n webhook
                const response = await fetch('https://n8n01.stpsolar.co.za/webhook/solar-quote', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(quoteData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    // Clear the interval and show success message
                    clearInterval(messageInterval);
                    btn.innerHTML = '<i class="fas fa-check-circle"></i> Quote Sent! 🎉';
                    
                    // Show success alert after a brief delay
                    setTimeout(() => {
                        alert(`✅ Quote successfully sent to ${customerEmail}!\n\nYour solar system estimate has been generated and will be sent to your email shortly. We'll contact you within 24 hours to discuss your requirements.`);
                        console.log('n8n response:', result);
                        
                        // Restore button state
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }, 1000);
                } else {
                    throw new Error('Failed to send quote request');
                }
            } catch (error) {
                console.error('Error sending quote request:', error);
                clearInterval(messageInterval);
                btn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Oops! Try Again';
                
                // Show error alert after a brief delay
                setTimeout(() => {
                    alert('❌ Failed to send quote request. Please try again or contact us directly.');
                    
                    // Restore button state
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 1000);
            }
        }

        console.log('V2 System Builder initialized successfully');
    </script>
    
    <script src="cache-buster.js?v=5.6"></script>
</body>
</html>
