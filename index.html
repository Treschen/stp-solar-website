<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>STP Solar - Premium Solar Solutions in South Africa</title>
    <meta name="description" content="STP Solar provides premium solar panel installation, maintenance, and energy solutions for homes and businesses across South Africa. Save money and go green with our expert solar services.">
    <meta name="keywords" content="solar panels, solar installation, renewable energy, South Africa, solar power, energy savings, solar quotes, solar systems, green energy, sustainable energy, solar inverters, solar batteries, load shedding solutions">
    <meta name="author" content="STP Solar">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <link rel="canonical" href="https://stpsolar.co.za/">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="STP Solar - Premium Solar Solutions">
    <meta property="og:description" content="Transform your energy costs with STP Solar's premium solar solutions. Expert installation and maintenance across South Africa.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://stpsolar.co.za/">
    <meta property="og:image" content="https://stpsolar.co.za/images/stp-solar-logo.png">
    <meta property="og:site_name" content="STP Solar">
    <meta property="og:locale" content="en_ZA">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="STP Solar - Premium Solar Solutions">
    <meta name="twitter:description" content="Transform your energy costs with STP Solar's premium solar solutions. Expert installation and maintenance across South Africa.">
    <meta name="twitter:image" content="https://stpsolar.co.za/images/stp-solar-logo.png">
    
    <!-- Structured Data for Local Business -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "STP Solar",
        "description": "Premium solar panel installation, maintenance, and energy solutions for homes and businesses across South Africa",
        "url": "https://stpsolar.co.za",
        "logo": "https://stpsolar.co.za/images/stp-solar-logo.png",
        "image": "https://stpsolar.co.za/images/stp-solar-logo.png",
        "telephone": "+27-XX-XXX-XXXX",
        "email": "info@stpnetworks.co.za",
        "address": {
            "@type": "PostalAddress",
            "addressCountry": "ZA",
            "addressRegion": "South Africa"
        },
        "serviceArea": {
            "@type": "Country",
            "name": "South Africa"
        },
        "hasOfferCatalog": {
            "@type": "OfferCatalog",
            "name": "Solar Services",
            "itemListElement": [
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Solar Panel Installation",
                        "description": "Professional solar panel installation for residential and commercial properties"
                    }
                },
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Solar System Maintenance",
                        "description": "Regular maintenance and servicing of solar systems"
                    }
                },
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Solar System Design",
                        "description": "Custom solar system design and consultation"
                    }
                }
            ]
        },
        "sameAs": [
            "https://www.facebook.com/stpsolar",
            "https://www.instagram.com/stpsolar",
            "https://www.linkedin.com/company/stpsolar"
        ]
    }
    </script>
    
    <!-- Cache Control Meta Tags -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="version" content="4.0">
    <meta http-equiv="Expires" content="0">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico?v=1.0">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Styles with cache busting -->
    <link rel="stylesheet" href="styles.css?v=3.5">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-solar-panel"></i>
                <span>STP Solar</span>
            </div>
            
            <div class="nav-menu" id="nav-menu">
                <a href="#home" class="nav-link">Home</a>
                <a href="#services" class="nav-link">Services</a>
                <a href="#gallery" class="nav-link">Gallery</a>
                <a href="#reviews" class="nav-link">Reviews</a>
                <a href="#about" class="nav-link">About</a>
                <a href="#calculator" class="nav-link">System Builder</a>
                <a href="#contact" class="nav-link">Contact</a>
            </div>
            
            <div class="nav-toggle" id="nav-toggle">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="hero-container">
            <div class="hero-content">
                <h1 class="hero-title">
                    Power Your Future with 
                    <span class="highlight">Premium Solar Solutions</span>
                </h1>
                <p class="hero-subtitle">
                    STP Solar specializes in residential and commercial solar installations using Tier 1 panels from JA Solar and Canadian Solar, with premium inverters from Sigenstor, Sunsynk, and Tesla Powerwall 3 systems.
                </p>
                <div class="hero-buttons">
                    <a href="#calculator" class="btn btn-primary">
                        <i class="fas fa-cogs"></i>
                        Build Your System
                    </a>
                    <a href="#contact" class="btn btn-secondary">
                        <i class="fas fa-phone"></i>
                        Get Free Quote
                    </a>
                    <a href="https://wa.me/27817480779" target="_blank" class="btn btn-whatsapp">
                        <i class="fab fa-whatsapp"></i>
                        WhatsApp Us
                    </a>
                </div>
                <div class="hero-stats">
                    <div class="stat">
                        <span class="stat-number">100+</span>
                        <span class="stat-label">Happy Customers</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">5MW+</span>
                        <span class="stat-label">Solar Installed</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">90%</span>
                        <span class="stat-label">Average Savings</span>
                    </div>
                </div>
            </div>
            <div class="hero-image">
                <div class="solar-panel-illustration">
                    <i class="fas fa-solar-panel solar-icon"></i>
                    <div class="energy-lines">
                        <div class="energy-line"></div>
                        <div class="energy-line"></div>
                        <div class="energy-line"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="services">
        <div class="container">
            <div class="section-header">
                <h2>Our Solar Services</h2>
                <p>Comprehensive solar solutions tailored to your energy needs</p>
            </div>
            
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <h3>Residential Solar</h3>
                    <p>Complete home solar systems featuring JA Solar and Canadian Solar panels with Sigenstor, Sunsynk inverters, and Tesla Powerwall 3 backup solutions.</p>
                    <ul class="service-features">
                        <li>JA Solar & Canadian Solar panels</li>
                        <li>Tesla Powerwall 3 backup systems</li>
                        <li>Sigenstor & Sunsynk inverters</li>
                        <li>Grid-tie and hybrid solutions</li>
                    </ul>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <h3>Commercial Solar</h3>
                    <p>Large-scale commercial installations using premium Tier 1 panels and industrial-grade inverters for maximum efficiency and ROI.</p>
                    <ul class="service-features">
                        <li>Industrial solar farms</li>
                        <li>Commercial rooftop systems</li>
                        <li>High-capacity inverters</li>
                        <li>Business backup solutions</li>
                    </ul>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-tools"></i>
                    </div>
                    <h3>Maintenance & Support</h3>
                    <p>Professional maintenance services to ensure your solar system operates at peak efficiency for decades.</p>
                    <ul class="service-features">
                        <li>Regular system inspections</li>
                        <li>Panel cleaning services</li>
                        <li>Performance monitoring</li>
                        <li>24/7 technical support</li>
                    </ul>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Energy Consulting</h3>
                    <p>Expert energy audits and consulting to optimize your power consumption and maximize solar investment returns.</p>
                    <ul class="service-features">
                        <li>Energy consumption analysis</li>
                        <li>System sizing optimization</li>
                        <li>Financial modeling</li>
                        <li>Government incentive guidance</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Solar System Builder Section -->
    <section id="calculator" class="calculator">
        <div class="container">
            <div class="section-header">
                <h2>
                    <i class="fas fa-solar-panel"></i>
                    <i class="fas fa-cogs"></i>
                    Solar System Builder
                </h2>
                <p>
                    <i class="fas fa-home"></i>
                    Choose the perfect solar system for your home or business
                </p>
            </div>
            
            <div class="system-builder-container">
                <!-- Phase Selection -->
                <div class="phase-selection" id="phase-selection">
                    <h3>
                        <i class="fas fa-bolt"></i>
                        Select Your Power Type
                    </h3>
                    <p class="phase-description">
                        <i class="fas fa-info-circle"></i>
                        Please select the type of power you have. If you are not sure, please select Single Phase.
                    </p>
                    
                    <div class="phase-options" id="phase-options">
                        <!-- Will be populated by admin portal data -->
                    </div>
                </div>
                
                <!-- System Type Selection -->
                <div class="system-type-selection" id="system-type-selection" style="display: none;">
                    <h3>
                        <i class="fas fa-list-ul"></i>
                        Select System Type
                    </h3>
                    <p class="system-type-description">
                        <i class="fas fa-check-circle"></i>
                        Choose from our available solar systems
                    </p>
                    
                    <div class="system-type-dropdown">
                        <select id="system-type-select" onchange="selectSystemType()">
                            <option value="">Select System Type</option>
                            <!-- Will be populated by admin portal data -->
                        </select>
                    </div>
                </div>
                
                <!-- System Selection -->
                <div class="system-selection" id="system-selection" style="display: none;">
                    <h3>Choose Your System</h3>
                    <div class="systems-grid" id="systems-grid">
                        <!-- Systems will be populated by admin portal data -->
                    </div>
                </div>
                
                <!-- Customization Section -->
                <div class="customization-section" id="customization-section" style="display: none;">
                    <h3>Customize Your System</h3>
                    <div class="customization-grid">
                        <div class="customization-item">
                            <h5>Solar Panels</h5>
                            <div class="selection-controls">
                                <select id="panel-selection" onchange="selectPanel()" class="component-select">
                                    <option value="">Select Panel Type</option>
                                    <!-- Will be populated by admin portal data -->
                                </select>
                            </div>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="adjustPanels(-1)">-</button>
                                <span class="quantity-display" id="panels-quantity">6</span>
                                <button class="quantity-btn" onclick="adjustPanels(1)">+</button>
                            </div>
                            <div class="quantity-limits">
                                <small>Range: 0 - <span id="panels-max">50</span> panels (0 = no panels, <span id="panels-min">6</span>+ recommended)</small>
                            </div>
                            
                            <!-- No Solar Panels Option -->
                            <div class="no-panels-option">
                                <label class="no-panels-checkbox">
                                    <input type="checkbox" id="no-panels-checkbox" onchange="toggleNoPanels(this)">
                                    <span class="checkmark"></span>
                                    <span class="checkbox-label">No solar panels required</span>
                                </label>
                            </div>
                            
                            <!-- Roof Type Selection -->
                            <div class="roof-type-selection">
                                <h6>Roof Type</h6>
                                <div class="roof-options" id="roof-options">
                                    <!-- Will be populated by admin portal data -->
                                </div>
                            </div>
                            
                            <p class="customization-price" id="panels-price">R0</p>
                        </div>
                        
                        <div class="customization-item">
                            <h5>Batteries</h5>
                            <div class="selection-controls">
                                <select id="battery-selection" onchange="selectBattery()" class="component-select">
                                    <option value="">Select Battery Type</option>
                                    <!-- Will be populated by admin portal data -->
                                </select>
                            </div>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="adjustBatteries(-1)">-</button>
                                <span class="quantity-display" id="batteries-quantity">1</span>
                                <button class="quantity-btn" onclick="adjustBatteries(1)">+</button>
                            </div>
                            <div class="quantity-limits">
                                <small>Range: <span id="batteries-min">1</span> - <span id="batteries-max">10</span> batteries</small>
                            </div>
                            <p class="customization-price" id="batteries-price">R0</p>
                        </div>
                    </div>
                    
                    <div class="pricing-summary">
                        <h4>System Pricing</h4>
                        <div class="pricing-item">
                            <span id="inverter-label">Inverter</span>
                            <span id="inverter-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span id="battery-label">Batteries</span>
                            <span id="battery-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span id="panel-label">Solar Panels</span>
                            <span id="panel-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span id="roof-mounting-label">Solar Panel Mounting Kit</span>
                            <span id="roof-mounting-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span id="accessories-label">Accessories</span>
                            <span id="accessories-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span id="installation-label">Installation</span>
                            <span id="installation-price">R0</span>
                        </div>
                        <div class="pricing-item">
                            <span><strong id="total-price-label">Total System Price (inc. VAT)</strong></span>
                            <span><strong id="total-price">R0</strong></span>
                        </div>
                    </div>
                    
                    <div class="quote-request-section">
                        <button id="request-quote-btn" class="btn btn-primary" onclick="showQuoteModal()">
                            <i class="fas fa-paper-plane"></i> Request Quote
                        </button>
                        <p class="quote-note">Get an immediate quote sent directly to your email</p>
                        <div class="disclaimer">
                            <p><strong>Please note:</strong> All estimates are preliminary and subject to change based on final site assessment. Maximum cable lengths included: 10m AC cable and 30m PV cable per string. All systems include sub-distribution boards, circuit breakers, isolators, and standard installation components. Final pricing will be confirmed after site visit and detailed assessment.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Reviews Section -->
    <section id="reviews" class="reviews">
        <div class="container">
            <div class="section-header">
                <h2>What Our Customers Say</h2>
                <p>Real reviews from satisfied STP Solar customers</p>
            </div>
            
            <div class="reviews-container">
                <div class="reviews-slider" id="reviews-slider">
                    <!-- Review 1 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Diksha S.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Extremely high quality service, wouldn't hire anyone else. Very trustworthy with quality panels and inverters. Saved over R5k a month on electricity bill and no load shedding issues."</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                    
                    <!-- Review 2 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Denise G.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Hassle free, efficient, professional and friendly service. This dynamic father and son team work seamlessly together and had our solar power solution installed and working in record time! Thank you!"</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                    
                    <!-- Review 3 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Salmon M.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Excellent service, very professional and attention to detail. Competitive pricing with an experienced team. I would highly recommend them. Thanks Sean, Indres and team."</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                </div>
                
                <div class="reviews-controls">
                    <button class="review-btn prev-btn" id="prev-review">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="review-btn next-btn" id="next-review">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <div class="reviews-stats">
                    <div class="stat-item">
                        <div class="stat-number">5.0</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100+</div>
                        <div class="stat-label">Happy Customers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">Satisfaction Rate</div>
                    </div>
                </div>
                
                <div class="reviews-cta">
                    <a href="https://www.google.com/search?q=stp+solar&oq=stp+solar+&gs_lcrp=EgZjaHJvbWUqDAgAECMYJxiABBiKBTIMCAAQIxgnGIAEGIoFMg0IARAuGK8BGMcBGIAEMgcIAhAAGIAEMgcIAxAAGIAEMgcIBBAAGIAEMgYIBRBFGDwyBggGEEUYPDIGCAcQRRg80gEIMjQ2N2owajeoAgCwAgA&sourceid=chrome&ie=UTF-8#mpd=~2277063622321751607/customers/reviews" target="_blank" class="btn btn-outline">
                        <i class="fab fa-google"></i>
                        Read More Reviews on Google
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery" class="gallery">
        <div class="container">
            <div class="section-header">
                <h2>Our Work Gallery</h2>
                <p>Professional solar installations across South Africa - showcasing our expertise with Sunsynk, Tesla Powerwall, and premium solar solutions</p>
            </div>
            
            <div class="gallery-filters">
                <button class="filter-btn active" data-filter="all">All Projects</button>
                <button class="filter-btn" data-filter="residential">Residential</button>
                <button class="filter-btn" data-filter="commercial">Commercial</button>
                <button class="filter-btn" data-filter="sunsynk">Sunsynk Systems</button>
                <button class="filter-btn" data-filter="tesla">Tesla Powerwall</button>
                <button class="filter-btn" data-filter="sigenergy">Sigenergy Systems</button>
                <button class="filter-btn" data-filter="general">General Systems</button>
            </div>
            
            <div class="gallery-grid" id="gallery-grid">
                <!-- Gallery items will be dynamically generated from JSON data -->
            </div>
            
            <div class="gallery-cta">
                <a href="#contact" class="btn btn-primary">
                    <i class="fas fa-camera"></i>
                    Get Your Project Featured
                </a>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about">
        <div class="container">
            <div class="about-content">
                <div class="about-text">
                    <h2>Why Choose STP Solar?</h2>
                    <p class="about-intro">
                        With over 10 years of experience in the South African solar industry, STP Solar has established itself as a trusted leader in renewable energy solutions.
                    </p>
                    
                    <div class="about-features">
                        <div class="feature">
                            <i class="fas fa-award"></i>
                            <div>
                                <h4>Certified Excellence</h4>
                                <p>Certified Electrical and Solar installers with industry-leading training and certifications.</p>
                            </div>
                        </div>
                        
                        <div class="feature">
                            <i class="fas fa-shield-alt"></i>
                            <div>
                                <h4>Standard Industry Warranty</h4>
                                <p>10 years on inverters and batteries, 12 years on solar panels. Comprehensive warranty coverage on all installations and components.</p>
                            </div>
                        </div>
                        
                        <div class="feature">
                            <i class="fas fa-leaf"></i>
                            <div>
                                <h4>Eco-Friendly</h4>
                                <p>Reduce your carbon footprint while saving money on energy costs.</p>
                            </div>
                        </div>
                        
                        <div class="feature">
                            <i class="fas fa-headset"></i>
                            <div>
                                <h4>24/7 Support</h4>
                                <p>Round-the-clock technical support and maintenance services.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="about-image">
                    <div class="image-placeholder">
                        <i class="fas fa-solar-panel"></i>
                        <p>Professional Installation Team</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="portfolio">
        <div class="container">
            <div class="section-header">
                <h2>Our Recent Projects</h2>
                <p>See the quality of our solar installations</p>
            </div>
            
            <div class="portfolio-grid">
                <div class="portfolio-item">
                    <div class="portfolio-image">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="portfolio-content">
                        <h3>Residential Installation</h3>
                        <p>5kW system with battery backup</p>
                        <span class="portfolio-location">Fourways, Gauteng</span>
                    </div>
                </div>
                
                <div class="portfolio-item">
                    <div class="portfolio-image">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="portfolio-content">
                        <h3>Commercial Project</h3>
                        <p>50kW industrial solar farm</p>
                        <span class="portfolio-location">Krammerville, Johannesburg</span>
                    </div>
                </div>
                
                <div class="portfolio-item">
                    <div class="portfolio-image">
                        <i class="fas fa-industry"></i>
                    </div>
                    <div class="portfolio-content">
                        <h3>Factory Installation</h3>
                        <p>100kW manufacturing facility</p>
                        <span class="portfolio-location">Centurion, Gauteng</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="contact">
        <div class="container">
            <div class="section-header">
                <h2>Contact Us Today</h2>
                <p>Ready to start saving on your electricity bills?</p>
            </div>
            
            <div class="contact-content">
                <div class="contact-form">
                    <form id="quote-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="name">Full Name *</label>
                                <input type="text" id="name" name="name" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address *</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="phone">Phone Number *</label>
                                <input type="tel" id="phone" name="phone" required>
                            </div>
                            <div class="form-group">
                                <label for="location">City</label>
                                <input type="text" id="location" name="location" placeholder="e.g., Cape Town">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="monthly-bill">Monthly Electricity Bill (R)</label>
                            <input type="number" id="monthly-bill" name="monthly-bill" placeholder="2500">
                        </div>
                        
                        <div class="form-group">
                            <label for="message">Additional Information</label>
                            <textarea id="message" name="message" rows="4" placeholder="Tell us about your energy needs, roof type, or any specific requirements..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            Send Message
                        </button>
                    </form>
                </div>
                
                <div class="contact-info">
                    <h3>Contact Information</h3>
                    
                    <div class="contact-item">
                        <i class="fas fa-mobile-alt"></i>
                        <div>
                            <h4>Mobile</h4>
                            <p><a href="tel:0817480779">081 748 0779</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <div>
                            <h4>Landline</h4>
                            <p><a href="tel:0105007999">010 500 7999</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <h4>Email</h4>
                            <p><a href="mailto:info@stpsolar.co.za">info@stpsolar.co.za</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <h4>Address</h4>
                            <p>Savanna Hills Estate<br>Midrand, Gauteng, 1682</p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fab fa-whatsapp"></i>
                        <div>
                            <h4>WhatsApp</h4>
                            <p><a href="https://wa.me/27817480779" target="_blank">Chat with us on WhatsApp</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <h4>Business Hours</h4>
                            <p>Monday - Friday: 8:00 AM - 6:00 PM<br>Saturday: 9:00 AM - 2:00 PM<br>Sunday: Closed</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Floating WhatsApp Button -->
    <div class="whatsapp-float">
        <a href="https://wa.me/27817480779" target="_blank" class="whatsapp-btn">
            <i class="fab fa-whatsapp"></i>
        </a>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-solar-panel"></i>
                        <span>STP Solar</span>
                    </div>
                    <p>Leading South Africa's transition to clean, renewable solar energy. Professional installation and maintenance services you can trust.</p>
                    <div class="social-links">
                        <a href="https://www.facebook.com/www.stpsolar.co.za" target="_blank" class="social-link"><i class="fab fa-facebook"></i></a>
                        <a href="https://www.instagram.com/stp_solar/" target="_blank" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.linkedin.com/company/92800961" target="_blank" class="social-link"><i class="fab fa-linkedin"></i></a>
                        <a href="https://www.youtube.com/@stpsolar" target="_blank" class="social-link"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Services</h4>
                    <ul>
                        <li><a href="#services">Residential Solar</a></li>
                        <li><a href="#services">Commercial Solar</a></li>
                        <li><a href="#services">Maintenance</a></li>
                        <li><a href="#services">Energy Consulting</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="#about">About Us</a></li>
                        <li><a href="#portfolio">Portfolio</a></li>
                        <li><a href="#contact">Contact</a></li>
                        <li><a href="#">Careers</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#calculator">Solar Calculator</a></li>
                        <li><a href="referrals.html">Referral Program</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Blog</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="terms-conditions.html">Terms & Conditions</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="#">Warranty Information</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 STP Solar. All rights reserved. | <a href="privacy-policy.html">Privacy Policy</a> | <a href="terms-conditions.html">Terms & Conditions</a></p>
            </div>
            
            <div class="footer-credit">
                <p>Website designed and hosted by STP Networks Pty Ltd</p>
            </div>
        </div>
    </footer>

    <!-- Quote Request Modal -->
    <div id="quoteModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-paper-plane"></i> Request Your Solar Quote</h3>
                <span class="close" onclick="closeQuoteModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="modal-quote-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="quote-name">Full Name *</label>
                            <input type="text" id="quote-name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="quote-email">Email Address *</label>
                            <input type="email" id="quote-email" name="email" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="quote-phone">Phone Number *</label>
                        <input type="tel" id="quote-phone" name="phone" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="quote-message">Additional Information</label>
                        <textarea id="quote-message" name="message" rows="4" placeholder="Tell us about your energy needs, roof type, or any specific requirements..."></textarea>
                    </div>
                    
                    <div class="system-summary">
                        <h4>Selected System</h4>
                        <div id="modal-system-details">
                            <!-- System details will be populated here -->
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeQuoteModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Send Quote Request
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Solar Admin Portal V2 Data Bridge -->
    <script src="solar-config-v2.js?v=1.2"></script>
    
    <!-- V2 System Builder Script -->
    <script>
        // V2 System Builder - Integrated with Admin Portal
        console.log('V2 System Builder initializing...');

        // Global variables for current selection
        let currentSystemType = null;
        let currentSystemId = null;
        let currentPhaseId = null;
        let currentPanelId = null;
        let currentBatteryId = null;
        let currentRoofTypeId = null;
        let currentQuantities = {
            panels: 6,
            batteries: 1
        };

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM loaded, initializing V2 System Builder...');
            
            // Wait for data bridge to initialize
            await SolarConfigV2.initializeDataBridge();
            
            // Initialize system builder
                initializeSystemBuilder();
                initializeNavigation();
                initializeQuoteForm();
        });

        // Initialize System Builder
        function initializeSystemBuilder() {
            console.log('Initializing system builder...');
            console.log('Checking if data is loaded via getSystemTypes()...');
            
            const systemTypes = SolarConfigV2.getSystemTypes();
            console.log('getSystemTypes() returned:', systemTypes);
            console.log('System types length:', systemTypes ? systemTypes.length : 'undefined');
            
            // Populate phase options first
            populatePhaseOptions();
            
            // Populate system type dropdown
            populateSystemTypeDropdown();
            
            // Initialize quantities
            updateQuantityDisplay();
        }

        // Populate Phase Options
        function populatePhaseOptions() {
            const phaseOptions = document.getElementById('phase-options');
            const phases = SolarConfigV2.getPhaseTypes();
            
            console.log('Available phases:', phases);
            
            if (!phases || phases.length === 0) {
                console.log('No phases available');
                return;
            }
            
            phaseOptions.innerHTML = phases.map(phase => `
                <div class="phase-option" data-phase="${phase.id}" onclick="selectPhase('${phase.id}')">
                    <input type="radio" name="phase" value="${phase.id}" id="phase-${phase.id}">
                    <label for="phase-${phase.id}">
                        <div class="phase-option-content">
                            <i class="fas fa-bolt"></i>
                            <span>${phase.name}</span>
                        </div>
                    </label>
                </div>
            `).join('');
        }

        // Populate System Type Dropdown
        function populateSystemTypeDropdown() {
            const select = document.getElementById('system-type-select');
            const systemTypes = SolarConfigV2.getSystemTypes();
            
            console.log('Available system types:', systemTypes);
            console.log('Current phase selection:', currentPhaseId);
            
            // Clear existing options (keep first empty option)
            select.innerHTML = '<option value="">Select System Type</option>';
            
            if (systemTypes.length === 0) {
                console.error('No system types available!');
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No systems available - please refresh';
                option.disabled = true;
                select.appendChild(option);
                return;
            }
            
            // Filter systems by selected phase
            const filteredSystems = systemTypes.filter(system => {
                return system.phase === currentPhaseId;
            });
            
            console.log('Filtered systems for phase', currentPhaseId, ':', filteredSystems);
            
            if (filteredSystems.length === 0) {
                console.log('No systems available for selected phase:', currentPhaseId);
                
                // Get the phase name for better error message
                const phases = SolarConfigV2.getPhaseTypes();
                const currentPhase = phases.find(phase => phase.id === currentPhaseId);
                const phaseName = currentPhase ? currentPhase.name : 'Selected Phase';
                
                const option = document.createElement('option');
                option.value = '';
                option.textContent = `No systems available for ${phaseName}`;
                option.disabled = true;
                select.appendChild(option);
                return;
            }
            
            // Add filtered system types from admin portal
            filteredSystems.forEach(system => {
                const option = document.createElement('option');
                option.value = system.id;
                option.textContent = system.name;
                select.appendChild(option);
                console.log('Added system option:', system.name, 'for phase:', system.phase);
            });
        }

        // System Type Selection - Directly load system configuration
        function selectSystemType() {
            const select = document.getElementById('system-type-select');
            currentSystemType = select.value;
            currentSystemId = select.value;
            
            console.log('System type selected:', currentSystemType);
            
            if (currentSystemType) {
                // Directly load the system configuration
                selectSystem(currentSystemId);
                // Hide the system selection cards since we're going directly to customization
                document.getElementById('system-selection').style.display = 'none';
            } else {
                // Hide system selection and customization
                document.getElementById('system-selection').style.display = 'none';
                document.getElementById('customization-section').style.display = 'none';
            }
        }

        // Show System Type Selection
        function showSystemTypeSelection() {
            document.getElementById('system-type-selection').style.display = 'block';
        }

        // Phase Selection
        function selectPhase(phaseId) {
            currentPhaseId = phaseId;
            console.log('Phase selected:', phaseId);
            
            // Update radio button checked state
            document.querySelectorAll('input[name="phase"]').forEach(radio => {
                radio.checked = radio.value === phaseId;
            });
            
            // Update visual selection state
            document.querySelectorAll('.phase-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.phase === phaseId) {
                    option.classList.add('selected');
                }
            });
            
            // Repopulate system type dropdown with filtered systems
            populateSystemTypeDropdown();
            
            // Show system type selection
            showSystemTypeSelection();
        }

        // Show System Selection
        function showSystemSelection() {
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) return;
            
            const systemsGrid = document.getElementById('systems-grid');
            
            // Create system card
            const systemCard = document.createElement('div');
            systemCard.className = 'system-card';
            systemCard.innerHTML = `
                <div class="system-card-header">
                    <h4 class="system-title">${system.name}</h4>
                </div>
                <div class="system-card-content">
                    <div class="system-features">
                        <div class="feature">
                            <i class="fas fa-bolt"></i>
                            <span>Inverter Included</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-battery-full"></i>
                            <span>Battery Backup</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-solar-panel"></i>
                            <span>Solar Panels</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-home"></i>
                            <span>Installation Included</span>
                        </div>
                    </div>
                    <div class="system-price">
                        <span class="price-label">Starting from</span>
                        <span class="price-amount" id="system-starting-price">R0</span>
                    </div>
                </div>
            `;
            
            systemsGrid.innerHTML = '';
            systemsGrid.appendChild(systemCard);
            
            // Calculate and show starting price
            updateStartingPrice();
            
            document.getElementById('system-selection').style.display = 'block';
        }

        // Select System
        function selectSystem(systemId) {
            currentSystemId = systemId;
            console.log('System selected:', systemId);
            
            // Show customization section
            showCustomizationSection();
        }

        // Show Customization Section
        function showCustomizationSection() {
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) return;
            
            // Update quantity limits
            const limits = SolarConfigV2.getSystemLimits(currentSystemId);
            if (limits) {
                console.log('System limits:', limits);
                document.getElementById('panels-min').textContent = limits.panelMin;
                document.getElementById('panels-max').textContent = limits.panelMax;
                document.getElementById('batteries-min').textContent = limits.batteryMin;
                document.getElementById('batteries-max').textContent = limits.batteryMax;
                
                // Reset quantities to system minimums
                currentQuantities.panels = limits.panelMin;
                currentQuantities.batteries = limits.batteryMin;
                updateQuantityDisplay();
            }
            
            // Populate panels dropdown
            populatePanelsDropdown();
            
            // Populate batteries dropdown
            populateBatteriesDropdown();
            
            // Populate roof types
            populateRoofTypes();
            
            // Auto-select default roof type if available
            const defaultRoofType = SolarConfigV2.getSystemDefaultRoofType(currentSystemId);
            if (defaultRoofType) {
                // Set the default roof type selection
                const roofTypeRadio = document.querySelector(`input[name="roof-type"][value="${defaultRoofType}"]`);
                if (roofTypeRadio) {
                    roofTypeRadio.checked = true;
                    currentRoofTypeId = defaultRoofType;
                    console.log('Auto-selected default roof type:', defaultRoofType);
                }
            }
            
            // Show section
            document.getElementById('customization-section').style.display = 'block';
            
            // Initialize pricing
            updateAllPricing();
        }

        // Populate Panels Dropdown
        function populatePanelsDropdown() {
            const select = document.getElementById('panel-selection');
            const panels = SolarConfigV2.getSystemPanels(currentSystemId);
            
            select.innerHTML = '<option value="">Select Panel Type</option>';
            
            panels.forEach(panel => {
                const option = document.createElement('option');
                option.value = panel.id;
                option.textContent = `${panel.name} - R${parseFloat(panel.price).toLocaleString('en-ZA')}`;
                select.appendChild(option);
            });
        }

        // Populate Batteries Dropdown
        function populateBatteriesDropdown() {
            const select = document.getElementById('battery-selection');
            const batteries = SolarConfigV2.getSystemBatteries(currentSystemId);
            
            select.innerHTML = '<option value="">Select Battery Type</option>';
            
            batteries.forEach(battery => {
                const option = document.createElement('option');
                option.value = battery.id;
                option.textContent = `${battery.name} - R${parseFloat(battery.price).toLocaleString('en-ZA')}`;
                select.appendChild(option);
            });
        }

        // Populate Roof Types
        function populateRoofTypes() {
            const container = document.getElementById('roof-options');
            const roofTypes = SolarConfigV2.getSystemRoofTypes(currentSystemId);
            
            container.innerHTML = '';
            
            roofTypes.forEach(roofType => {
                const label = document.createElement('label');
                label.className = 'roof-option';
                label.innerHTML = `
                    <input type="radio" name="roof-type" value="${roofType.id}" onchange="updateRoofType('${roofType.id}')">
                    <span class="roof-label">${roofType.name} - R${parseFloat(roofType.price).toLocaleString('en-ZA')} per panel</span>
                `;
                container.appendChild(label);
            });
        }

        // Panel Selection
        function selectPanel() {
            const select = document.getElementById('panel-selection');
            currentPanelId = select.value;
            console.log('Panel selected:', currentPanelId);
            updateAllPricing();
        }

        // Battery Selection
        function selectBattery() {
            const select = document.getElementById('battery-selection');
            currentBatteryId = select.value;
            console.log('Battery selected:', currentBatteryId);
            updateAllPricing();
        }

        // Roof Type Selection
        function updateRoofType(roofTypeId) {
            currentRoofTypeId = roofTypeId;
            console.log('Roof type selected:', roofTypeId);
            updateAllPricing();
        }

        // Adjust Panels
        function adjustPanels(delta) {
            const limits = SolarConfigV2.getSystemLimits(currentSystemId);
            if (!limits) {
                console.log('No limits found, allowing any quantity');
                const newQuantity = currentQuantities.panels + delta;
                if (newQuantity >= 0) {
                    currentQuantities.panels = newQuantity;
                    updateQuantityDisplay();
                    updateAllPricing();
                }
                return;
            }
            
            let newQuantity = currentQuantities.panels + delta;
            
            // Special case: if going up from 0, jump directly to minimum
            if (currentQuantities.panels === 0 && delta > 0) {
                newQuantity = limits.panelMin;
                console.log('Jumping from 0 to minimum:', newQuantity);
            }
            
            console.log('Panel adjustment:', {
                current: currentQuantities.panels,
                delta: delta,
                newQuantity: newQuantity,
                limits: limits
            });
            
            // Allow 0 panels (customer choice), or within the defined range
            if (newQuantity === 0 || 
                (newQuantity >= limits.panelMin && newQuantity <= limits.panelMax)) {
                currentQuantities.panels = newQuantity;
                console.log('Panel quantity updated to:', currentQuantities.panels);
                updateQuantityDisplay();
                updateAllPricing();
                
                // Sync checkbox state
                const checkbox = document.getElementById('no-panels-checkbox');
                if (checkbox) {
                    checkbox.checked = (newQuantity === 0);
                }
            } else {
                console.log('Panel quantity change blocked:', {
                    newQuantity: newQuantity,
                    panelMin: limits.panelMin,
                    panelMax: limits.panelMax,
                    current: currentQuantities.panels
                });
            }
        }

        // Toggle No Panels Checkbox
        function toggleNoPanels(checkbox) {
            console.log('No panels checkbox toggled:', checkbox.checked);
            
            if (checkbox.checked) {
                // Set panels to 0
                currentQuantities.panels = 0;
                updateQuantityDisplay();
                updateAllPricing();
                console.log('Panels set to 0 via checkbox');
            } else {
                // Set panels to minimum
                const limits = SolarConfigV2.getSystemLimits(currentSystemId);
                if (limits) {
                    currentQuantities.panels = limits.panelMin;
                    updateQuantityDisplay();
                    updateAllPricing();
                    console.log('Panels set to minimum:', limits.panelMin);
                }
            }
        }

        // Set Panels to Zero (for testing)
        function setPanelsToZero() {
            console.log('Setting panels to zero...');
            currentQuantities.panels = 0;
            updateQuantityDisplay();
            updateAllPricing();
            console.log('Panels set to:', currentQuantities.panels);
        }

        // Adjust Batteries
        function adjustBatteries(delta) {
            const limits = SolarConfigV2.getSystemLimits(currentSystemId);
            if (!limits) return;
            
            const newQuantity = currentQuantities.batteries + delta;
            
            if (newQuantity >= limits.batteryMin && newQuantity <= limits.batteryMax) {
                currentQuantities.batteries = newQuantity;
                updateQuantityDisplay();
                updateAllPricing();
            }
        }

        // Update Quantity Display
        function updateQuantityDisplay() {
            document.getElementById('panels-quantity').textContent = currentQuantities.panels;
            document.getElementById('batteries-quantity').textContent = currentQuantities.batteries;
        }

        // Update All Pricing
        function updateAllPricing() {
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) return;
            
            // Calculate individual component prices
            updateComponentPricing(system);
            
            // Calculate total price
            const totalPrice = calculateTotalPrice(system);
            
            // Update display
            document.getElementById('total-price').textContent = `R${totalPrice.toLocaleString('en-ZA')}`;
            
            // Update starting price in system selection
            updateStartingPrice();
        }

        // Update Component Pricing
        function updateComponentPricing(system) {
            // Inverter price
            const inverter = SolarConfigV2.getComponent(system.inverter, 'inverters');
            const inverterPrice = inverter ? parseFloat(inverter.price) : 0;
            document.getElementById('inverter-price').textContent = `R${inverterPrice.toLocaleString('en-ZA')}`;
            document.getElementById('inverter-label').textContent = inverter ? inverter.name : 'Inverter';
            
            // Battery price
            let batteryPrice = 0;
            let batteryLabel = 'Batteries';
            if (currentBatteryId) {
                const battery = SolarConfigV2.getComponent(currentBatteryId, 'batteries');
                if (battery) {
                    batteryPrice = parseFloat(battery.price) * currentQuantities.batteries;
                    batteryLabel = `${battery.name} (${currentQuantities.batteries}x)`;
                }
            }
            document.getElementById('battery-price').textContent = `R${batteryPrice.toLocaleString('en-ZA')}`;
            document.getElementById('battery-label').textContent = batteryLabel;
            
            // Panel price
            let panelPrice = 0;
            let panelLabel = 'Solar Panels';
            if (currentPanelId && currentQuantities.panels > 0) {
                const panel = SolarConfigV2.getComponent(currentPanelId, 'panels');
                if (panel) {
                    panelPrice = parseFloat(panel.price) * currentQuantities.panels;
                    panelLabel = `${panel.name} (${currentQuantities.panels}x)`;
                }
            } else if (currentQuantities.panels === 0) {
                panelLabel = 'Solar Panels (0x - No panels selected)';
            }
            document.getElementById('panel-price').textContent = `R${panelPrice.toLocaleString('en-ZA')}`;
            document.getElementById('panel-label').textContent = panelLabel;
            
            // Roof mounting kit price
            let roofMountingPrice = 0;
            if (currentRoofTypeId && currentQuantities.panels > 0) {
                const roofType = SolarConfigV2.getComponent(currentRoofTypeId, 'rooftypes');
                if (roofType) {
                    roofMountingPrice = parseFloat(roofType.price) * currentQuantities.panels;
                }
            }
            document.getElementById('roof-mounting-price').textContent = `R${roofMountingPrice.toLocaleString('en-ZA')}`;
            
            // Accessories price
            const accessories = SolarConfigV2.getComponent(system.accessories, 'accessories');
            const accessoriesPrice = accessories ? parseFloat(accessories.price) : 0;
            document.getElementById('accessories-price').textContent = `R${accessoriesPrice.toLocaleString('en-ZA')}`;
            
            // Installation price
            const installation = SolarConfigV2.getComponent(system.installation, 'installation');
            const installationPrice = installation ? parseFloat(installation.price) : 0;
            document.getElementById('installation-price').textContent = `R${installationPrice.toLocaleString('en-ZA')}`;
            
            // Update individual component price displays in customization section
            document.getElementById('panels-price').textContent = `R${panelPrice.toLocaleString('en-ZA')}`;
            document.getElementById('batteries-price').textContent = `R${batteryPrice.toLocaleString('en-ZA')}`;
        }

        // Calculate Total Price
        function calculateTotalPrice(system) {
            const quantities = {
                panelCount: currentQuantities.panels,
                batteryCount: currentQuantities.batteries,
                roofType: currentRoofTypeId,
                panelId: currentPanelId,
                batteryId: currentBatteryId
            };
            
            return SolarConfigV2.calculateDynamicSystemPrice(system, quantities);
        }

        // Update Starting Price
        function updateStartingPrice() {
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) return;
            
            // Calculate starting price with minimum quantities
            const limits = SolarConfigV2.getSystemLimits(currentSystemId);
            if (limits) {
                const startingQuantities = {
                    panelCount: limits.panelMin,
                    batteryCount: limits.batteryMin,
                    roofType: null // No roof type selected initially
                };
                
                const startingPrice = SolarConfigV2.calculateDynamicSystemPrice(system, startingQuantities);
                document.getElementById('system-starting-price').textContent = `R${startingPrice.toLocaleString('en-ZA')}`;
            }
        }

        // Hide All Sections
        function hideAllSections() {
            document.getElementById('phase-selection').style.display = 'none';
            document.getElementById('system-selection').style.display = 'none';
            document.getElementById('customization-section').style.display = 'none';
        }

        // Navigation Functions (simplified)
        function initializeNavigation() {
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.getElementById('nav-menu');
            
            if (navToggle && navMenu) {
                navToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                    navToggle.classList.toggle('active');
                });
            }
        }

        // Quote Form Functions
        function initializeQuoteForm() {
            const form = document.getElementById('quote-form');
            if (form) {
                form.addEventListener('submit', handleQuoteSubmission);
            }
        }

        // Handle Contact Form Submission
        function handleQuoteSubmission(event) {
            event.preventDefault();
            
            // Get form data
            const formData = new FormData(event.target);
            const contactData = {
                customer_name: formData.get('name'),
                customer_email: formData.get('email'),
                customer_phone: formData.get('phone'),
                customer_location: formData.get('location'),
                monthly_bill: formData.get('monthly-bill'),
                message: formData.get('message'),
                form_type: 'contact_inquiry'
            };
            
            // Validate required fields
            if (!contactData.customer_name || !contactData.customer_email || !contactData.customer_phone) {
                alert('Please fill in all required fields (Name, Email, and Phone).');
                return;
            }
            
            // Show loading state
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            submitBtn.disabled = true;
            
            // Send to contact webhook
            sendContactRequest(contactData, submitBtn, originalText);
        }

        // Send Contact Request to Slack Webhook
        async function sendContactRequest(contactData, submitBtn, originalText) {
            try {
                console.log('Sending contact request to webhook:', contactData);
                
                // Send to contact webhook
                const response = await fetch('https://n8n01.stpsolar.co.za/webhook/contact-us', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(contactData)
                });
                
                if (response.ok) {
                    // Success
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> Message Sent!';
                    submitBtn.style.background = 'var(--success-color, #28a745)';
                    
                    // Clear form
                    document.getElementById('quote-form').reset();
                    
                    // Show success message
                    alert('Thank you for contacting us! We\'ll get back to you soon.');
                    
                    // Reset button after 3 seconds
                    setTimeout(() => {
                        submitBtn.innerHTML = originalText;
                        submitBtn.style.background = '';
                        submitBtn.disabled = false;
                    }, 3000);
                    
                } else {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
            } catch (error) {
                console.error('Error sending contact request:', error);
                
                // Show error state
                submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
                submitBtn.style.background = 'var(--error-color, #dc3545)';
                
                // Show error message
                alert('Sorry, there was an error sending your message. Please try again or contact us directly.');
                
                // Reset button after 3 seconds
                setTimeout(() => {
                    submitBtn.innerHTML = originalText;
                    submitBtn.style.background = '';
                    submitBtn.disabled = false;
                }, 3000);
            }
        }

        // Prepare System Configuration
        function prepareSystemConfig() {
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) return null;
            
            return {
                systemId: currentSystemId,
                systemName: system.name,
                phase: currentPhaseId,
                inverter: system.inverter,
                batteries: currentBatteryId ? [currentBatteryId] : [],
                batteryQuantity: currentQuantities.batteries,
                panels: currentPanelId ? [currentPanelId] : [],
                panelQuantity: currentQuantities.panels,
                roofType: currentRoofTypeId,
                accessories: system.accessories,
                installation: system.installation,
                totalPrice: calculateTotalPrice(system)
            };
        }

        // Quote Modal Functions
        function showQuoteModal() {
            console.log('showQuoteModal called');
            const modal = document.getElementById('quoteModal');
            const systemDetails = document.getElementById('modal-system-details');
            
            console.log('Modal element:', modal);
            console.log('System details element:', systemDetails);
            console.log('Current system ID:', currentSystemId);
            
            if (!modal) {
                console.error('Modal element not found!');
                alert('Modal not found - check console for details');
                return;
            }
            
            // Populate system details
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            console.log('System config:', system);
            
            if (system) {
                const totalPrice = calculateTotalPrice(system);
                console.log('Total price:', totalPrice);
                
                if (systemDetails) {
                    systemDetails.innerHTML = `
                        <div class="system-detail">
                            <strong>System:</strong> ${system.name}
                        </div>
                        <div class="system-detail">
                            <strong>Total Price:</strong> R${totalPrice.toLocaleString('en-ZA')}
                        </div>
                        <div class="system-detail">
                            <strong>Panels:</strong> ${currentQuantities.panels} panels
                        </div>
                        <div class="system-detail">
                            <strong>Batteries:</strong> ${currentQuantities.batteries} batteries
                        </div>
                    `;
                }
            } else {
                console.warn('No system configuration found');
                if (systemDetails) {
                    systemDetails.innerHTML = '<div class="system-detail">No system selected</div>';
                }
            }
            
            console.log('Setting modal display to block');
            modal.style.display = 'flex';
            modal.classList.add('show');
            console.log('Modal display style after setting:', modal.style.display);
            console.log('Modal classes:', modal.className);
        }

        function closeQuoteModal() {
            const modal = document.getElementById('quoteModal');
            modal.style.display = 'none';
            modal.classList.remove('show');
        }

        // Modal Quote Form
        document.addEventListener('DOMContentLoaded', function() {
            const modalForm = document.getElementById('modal-quote-form');
            if (modalForm) {
                modalForm.addEventListener('submit', async function(event) {
                    event.preventDefault();
                    
                    // Get form data
                    const formData = new FormData(modalForm);
                    const customerName = formData.get('name');
                    const customerEmail = formData.get('email');
                    const customerPhone = formData.get('phone');
                    const customerLocation = 'South Africa'; // Default location
                    const customerMessage = formData.get('message') || '';
                    
                    // Validate email
                    if (!isValidEmail(customerEmail)) {
                        alert('Please enter a valid email address');
                        return;
                    }
                    
                    // Close modal
                    closeQuoteModal();
                    
                    // Send quote request
                    await sendQuoteRequest(customerName, customerEmail, customerPhone, customerLocation, customerMessage);
                });
            }
        });

        // Email validation function
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Send quote request function
        async function sendQuoteRequest(customerName, customerEmail, customerPhone, customerLocation, customerMessage) {
            if (!currentSystemId) {
                alert('Please select a system first!');
                return;
            }
            
            const system = SolarConfigV2.getSystemConfig(currentSystemId);
            if (!system) {
                alert('System configuration not found!');
                return;
            }
            
            // Validation: Always require battery selection
            if (!currentBatteryId) {
                alert('Please select a battery type before requesting a quote!');
                return;
            }
            
            // Validation: Check panel selection based on system requirements and user choice
            const noPanelsCheckbox = document.getElementById('no-panels-checkbox');
            const panelQty = currentQuantities.panels;
            
            // Get system limits to check if 6+ panels are typically required
            const limits = SolarConfigV2.getSystemLimits(currentSystemId);
            
            // Only validate panel selection if:
            // 1. System requires 6+ panels (panelMin >= 6)
            // 2. User has NOT checked "No solar panels required"
            // 3. User has NOT selected a panel type
            if (limits && limits.panelMin >= 6 && !noPanelsCheckbox.checked && !currentPanelId) {
                alert('Please select a solar panel type before requesting a quote!');
                return;
            }
            
            // Get current quantities from the UI
            const batteryQty = currentQuantities.batteries;
            
            // Get selected components
            const inverter = SolarConfigV2.getComponent(system.inverter, 'inverters');
            const battery = SolarConfigV2.getComponent(currentBatteryId, 'batteries');
            const panel = SolarConfigV2.getComponent(currentPanelId, 'panels');
            const roofType = SolarConfigV2.getComponent(currentRoofTypeId, 'rooftypes');
            const accessories = SolarConfigV2.getComponent(system.accessories, 'accessories');
            const installation = SolarConfigV2.getComponent(system.installation, 'installation');
            
            // Calculate total price
            const totalPrice = calculateTotalPrice(system);
            
            // Calculate VAT-exclusive amounts for each line (total amounts, not unit prices)
            const vatRate = 1.15;
            const inverterAmountExclVAT = inverter ? Math.round(parseFloat(inverter.price) / vatRate) : 0;
            const batteryTotalExclVAT = battery ? Math.round((parseFloat(battery.price) * batteryQty) / vatRate) : 0;
            const panelTotalExclVAT = panel ? Math.round((parseFloat(panel.price) * panelQty) / vatRate) : 0;
            const roofTotalExclVAT = roofType && panelQty > 0 ? Math.round((parseFloat(roofType.price) * panelQty) / vatRate) : 0;
            const accessoriesAmountExclVAT = accessories ? Math.round(parseFloat(accessories.price) / vatRate) : 0;
            const installationAmountExclVAT = installation ? Math.round(parseFloat(installation.price) / vatRate) : 0;
            
            // Debug logging
            console.log('=== WEBHOOK CALCULATION DEBUG ===');
            console.log('Battery:', battery?.name, 'Unit Price:', battery?.price, 'Quantity:', batteryQty, 'Total Excl VAT:', batteryTotalExclVAT);
            console.log('Panel:', panel?.name, 'Unit Price:', panel?.price, 'Quantity:', panelQty, 'Total Excl VAT:', panelTotalExclVAT);
            console.log('Roof Type:', roofType?.name, 'Unit Price:', roofType?.price, 'Quantity:', panelQty, 'Total Excl VAT:', roofTotalExclVAT);
            
            // Build the webhook payload (compatible with n8n workflow and QuickBooks API)
            // Using proper QuickBooks API Line array structure with VAT-exclusive amounts
            const quoteData = {
                // Customer Info
                customer_name: customerName,
                customer_email: customerEmail,
                customer_phone: customerPhone,
                customer_location: customerLocation,
                customer_message: customerMessage,
                
                // System Info
                system_name: system.name,
                phase: currentPhaseId,
                
                // Line 1: Inverter (using "Solar Product" as item name)
                line1_item_name: 'Solar Product',
                line1_description: inverter ? inverter.name : 'Inverter - Not selected',
                line1_amount: inverter ? Math.round(parseFloat(inverter.price) / vatRate) : 0,
                line1_quantity: 1,
                
                // Line 2: Battery (using "Solar Product" as item name)
                line2_item_name: 'Solar Product',
                line2_description: battery ? `${battery.name} (${batteryQty}x)` : 'Battery - Not selected',
                line2_amount: batteryTotalExclVAT,
                line2_quantity: batteryQty,
                
                // Line 3: Panels (using "Solar Product" as item name)
                line3_item_name: 'Solar Product',
                line3_description: panel && panelQty > 0 ? `${panel.name} (${panelQty}x)` : 'Solar Panels - Not selected',
                line3_amount: panelTotalExclVAT,
                line3_quantity: panelQty,
                
                // Line 4: Roof Mounting Kit (using "Solar Product" as item name)
                line4_item_name: 'Solar Product',
                line4_description: roofType && panelQty > 0 ? `${roofType.name} Mounting Kit (${panelQty}x)` : 'Panel Mounting Kit - Not required',
                line4_amount: roofTotalExclVAT,
                line4_quantity: panelQty,
                
                // Line 5: Accessories (using "Solar Product" as item name)
                line5_item_name: 'Solar Product',
                line5_description: accessories ? accessories.name : 'Accessories',
                line5_amount: accessoriesAmountExclVAT,
                line5_quantity: 1,
                
                // Line 6: Installation (using "Solar Product" as item name)
                line6_item_name: 'Solar Product',
                line6_description: installation ? installation.name : 'Installation',
                line6_amount: installationAmountExclVAT,
                line6_quantity: 1,
                
                // Total
                total_price: totalPrice
            };
            
            // Show loading state
            const btn = document.getElementById('request-quote-btn');
            if (!btn) {
                console.error('Request Quote button not found!');
                return;
            }
            
            const originalText = btn.innerHTML;
            btn.disabled = true;
            
            // Funky loading messages
            const loadingMessages = [
                ' Charging up the solar magic...',
                ' Calculating your energy savings...',
                ' Crunching numbers like a solar calculator...',
                ' Standby for your system quote...',
                ' Working out the eco-friendly math...',
                ' Please wait while we work out magic...',
                ' Plugging into the solar matrix...',
                ' Generating your personalized quote...',
                ' Almost there, solar superstar!'
            ];
            
            let messageIndex = 0;
            const messageInterval = setInterval(() => {
                btn.innerHTML = `<div class="loading-content"><i class="fas fa-spinner fa-spin"></i><span>${loadingMessages[messageIndex]}</span></div>`;
                messageIndex = (messageIndex + 1) % loadingMessages.length;
            }, 3000);
            
            // Show the first message immediately
            btn.innerHTML = `<div class="loading-content"><i class="fas fa-spinner fa-spin"></i><span>${loadingMessages[0]}</span></div>`;
            
                try {
                    console.log('=== FINAL WEBHOOK PAYLOAD DEBUG ===');
                    console.log('line2_amount (Battery):', quoteData.line2_amount, 'line2_quantity:', quoteData.line2_quantity);
                    console.log('line3_amount (Panel):', quoteData.line3_amount, 'line3_quantity:', quoteData.line3_quantity);
                    console.log('line4_amount (Roof):', quoteData.line4_amount, 'line4_quantity:', quoteData.line4_quantity);
                console.log('Sending quote to n8n:', quoteData);
                
                // Send to n8n webhook
                const response = await fetch('https://n8n01.stpsolar.co.za/webhook/solar-quote', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(quoteData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    // Clear the interval and show success message
                    clearInterval(messageInterval);
                    btn.innerHTML = '<div class="loading-content"><i class="fas fa-check-circle"></i><span>Quote Sent! </span></div>';
                    
                    // Show success alert after a brief delay
                    setTimeout(() => {
                        alert(` Quote successfully sent to ${customerEmail}!\n\nYour solar system estimate has been generated and will be sent to your email shortly. We'll contact you within 24 hours to discuss your requirements.`);
                    console.log('n8n response:', result);
                        
                        // Restore button state
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }, 1000);
                } else {
                    throw new Error('Failed to send quote request');
                }
            } catch (error) {
                console.error('Error sending quote request:', error);
                clearInterval(messageInterval);
                btn.innerHTML = '<div class="loading-content"><i class="fas fa-exclamation-triangle"></i><span>Oops! Try Again</span></div>';
                
                // Show error alert after a brief delay
                setTimeout(() => {
                alert(' Failed to send quote request. Please try again or contact us directly.');
                    
                // Restore button state
                btn.innerHTML = originalText;
                btn.disabled = false;
                }, 1000);
            }
        }

        console.log('V2 System Builder initialized successfully');

        // Gallery Functionality
        let galleryData = [];
        let currentFilter = 'all';

        // Load gallery data
        async function loadGalleryData() {
            try {
                const response = await fetch('gallery-data.json?v=' + Date.now());
                if (response.ok) {
                    const data = await response.json();
                    galleryData = data.galleryItems;
                    console.log('Gallery data loaded:', galleryData.length, 'items');
                    renderGallery();
                } else {
                    console.error('Failed to load gallery data:', response.status);
                    showGalleryError();
                }
            } catch (error) {
                console.error('Error loading gallery data:', error);
                showGalleryError();
            }
        }

        // Render gallery items
        function renderGallery() {
            const galleryGrid = document.getElementById('gallery-grid');
            if (!galleryGrid) {
                console.error('Gallery grid element not found');
                return;
            }

            // Filter items based on current filter
            let filteredItems = galleryData;
            if (currentFilter !== 'all') {
                filteredItems = galleryData.filter(item => 
                    item.categories.includes(currentFilter)
                );
            }

            // Clear existing content
            galleryGrid.innerHTML = '';

            if (filteredItems.length === 0) {
                galleryGrid.innerHTML = '<p class="no-items">No gallery items found for this category.</p>';
                return;
            }

            // Render each gallery item
            filteredItems.forEach(item => {
                const galleryItem = createGalleryItem(item);
                galleryGrid.appendChild(galleryItem);
            });
        }

        // Create gallery item element
        function createGalleryItem(item) {
            const div = document.createElement('div');
            div.className = 'gallery-item';
            div.setAttribute('data-categories', item.categories.join(' '));
            div.onclick = () => openGalleryModal(item);

            div.innerHTML = `
                <div class="gallery-image">
                    <img src="${item.image}" alt="${item.title}" loading="lazy">
                    <div class="gallery-overlay">
                        <div class="gallery-info">
                            <h4>${item.title}</h4>
                            <p>${item.location}  ${item.systemSize}</p>
                            <div class="gallery-tags">
                                ${item.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            return div;
        }

        // Gallery filtering
        function initGalleryFilters() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Update active button
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    // Update current filter
                    currentFilter = btn.getAttribute('data-filter');
                    console.log('Gallery filter changed to:', currentFilter);

                    // Re-render gallery
                    renderGallery();
                });
            });
        }

        // Gallery modal
        function openGalleryModal(item) {
            // Create modal if it doesn't exist
            let modal = document.getElementById('gallery-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'gallery-modal';
                modal.className = 'gallery-modal';
                modal.innerHTML = `
                    <div class="gallery-modal-content">
                        <span class="gallery-modal-close">&times;</span>
                        <div class="gallery-modal-body">
                            <div class="gallery-modal-image">
                                <img id="modal-image" src="" alt="">
                            </div>
                            <div class="gallery-modal-info">
                                <h3 id="modal-title"></h3>
                                <p id="modal-description"></p>
                                <div class="modal-details">
                                    <div class="detail-item">
                                        <strong>Location:</strong>
                                        <span id="modal-location"></span>
                                    </div>
                                    <div class="detail-item">
                                        <strong>System Size:</strong>
                                        <span id="modal-system-size"></span>
                                    </div>
                                    <div class="detail-item">
                                        <strong>Date:</strong>
                                        <span id="modal-date"></span>
                                    </div>
                                </div>
                                <div class="modal-components">
                                    <h4>System Components:</h4>
                                    <ul id="modal-components"></ul>
                                </div>
                                <div class="modal-quote">
                                    <h4>Customer Quote:</h4>
                                    <blockquote id="modal-quote"></blockquote>
                                </div>
                                <div class="modal-tags">
                                    <h4>Tags:</h4>
                                    <div id="modal-tags"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                // Close modal functionality
                const closeBtn = modal.querySelector('.gallery-modal-close');
                closeBtn.addEventListener('click', closeGalleryModal);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeGalleryModal();
                });
            }

            // Populate modal with item data
            document.getElementById('modal-image').src = item.image;
            document.getElementById('modal-image').alt = item.title;
            document.getElementById('modal-title').textContent = item.title;
            document.getElementById('modal-description').textContent = item.description;
            document.getElementById('modal-location').textContent = item.location;
            document.getElementById('modal-system-size').textContent = item.systemSize;
            document.getElementById('modal-date').textContent = new Date(item.date).toLocaleDateString();
            
            const componentsList = document.getElementById('modal-components');
            componentsList.innerHTML = '';
            item.components.forEach(component => {
                const li = document.createElement('li');
                li.textContent = component;
                componentsList.appendChild(li);
            });
            
            document.getElementById('modal-quote').textContent = item.customerQuote;
            
            const tagsContainer = document.getElementById('modal-tags');
            tagsContainer.innerHTML = '';
            item.tags.forEach(tag => {
                const span = document.createElement('span');
                span.className = 'tag';
                span.textContent = tag;
                tagsContainer.appendChild(span);
            });

            // Show modal
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeGalleryModal() {
            const modal = document.getElementById('gallery-modal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // Show error message if gallery fails to load
        function showGalleryError() {
            const galleryGrid = document.getElementById('gallery-grid');
            if (galleryGrid) {
                galleryGrid.innerHTML = `
                    <div class="gallery-error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Gallery Unavailable</h3>
                        <p>We're having trouble loading our gallery. Please refresh the page or contact us directly.</p>
                        <button class="btn btn-primary" onclick="loadGalleryData()">Try Again</button>
                    </div>
                `;
            }
        }

        // Reviews Carousel Functionality
        let currentReviewIndex = 0;
        let reviewsSlider, reviewCards, totalReviews;
        
        function initializeCarouselElements() {
            reviewsSlider = document.getElementById('reviews-slider');
            reviewCards = document.querySelectorAll('.review-card');
            totalReviews = reviewCards.length;
            console.log('Carousel initialized with', totalReviews, 'reviews');
            console.log('Review names:', Array.from(reviewCards).map(card => card.querySelector('h4')?.textContent));
        }
        
        function updateReviewsDisplay() {
            if (!reviewsSlider || !reviewCards || totalReviews === 0) {
                console.log('Carousel elements not found or no reviews');
                return;
            }
            
            console.log('Updating display - current index:', currentReviewIndex);
            
            // Calculate how many reviews to show based on screen width
            const isMobile = window.innerWidth <= 768;
            const reviewsToShow = isMobile ? 1 : 3;
            
            // Simple approach: hide all cards, show only the ones we want
            reviewCards.forEach((card, index) => {
                card.style.display = 'none';
            });
            
            // Show the cards we want to display
            for (let i = 0; i < reviewsToShow; i++) {
                const cardIndex = currentReviewIndex + i;
                if (cardIndex < totalReviews) {
                    reviewCards[cardIndex].style.display = 'block';
                    console.log('Showing card', cardIndex, ':', reviewCards[cardIndex].querySelector('h4')?.textContent);
                }
            }
            
            // Update button states
            const prevBtn = document.getElementById('prev-review');
            const nextBtn = document.getElementById('next-review');
            
            // Calculate maximum index based on visible cards
            const maxIndex = Math.max(0, totalReviews - reviewsToShow);
            
            if (prevBtn) {
                const isAtStart = currentReviewIndex === 0;
                prevBtn.disabled = isAtStart;
                prevBtn.style.opacity = isAtStart ? '0.5' : '1';
                prevBtn.style.cursor = isAtStart ? 'not-allowed' : 'pointer';
                console.log('Prev button - disabled:', isAtStart);
            }
            
            if (nextBtn) {
                const isAtEnd = currentReviewIndex >= maxIndex;
                nextBtn.disabled = isAtEnd;
                nextBtn.style.opacity = isAtEnd ? '0.5' : '1';
                nextBtn.style.cursor = isAtEnd ? 'not-allowed' : 'pointer';
                console.log('Next button - disabled:', isAtEnd, 'maxIndex:', maxIndex);
            }
            
            console.log(`Showing reviews ${currentReviewIndex + 1} to ${Math.min(currentReviewIndex + reviewsToShow, totalReviews)} of ${totalReviews}`);
        }
        
        function nextReview() {
            const isMobile = window.innerWidth <= 768;
            const reviewsToShow = isMobile ? 1 : 3;
            const maxIndex = Math.max(0, totalReviews - reviewsToShow);
            
            console.log('Next clicked - current:', currentReviewIndex, 'max:', maxIndex);
            
            if (currentReviewIndex < maxIndex) {
                currentReviewIndex++;
                updateReviewsDisplay();
            } else {
                console.log('Already at max index');
            }
        }
        
        function prevReview() {
            console.log('Prev clicked - current:', currentReviewIndex);
            
            if (currentReviewIndex > 0) {
                currentReviewIndex--;
                updateReviewsDisplay();
            } else {
                console.log('Already at first review');
            }
        }
        
        // Initialize reviews carousel
        function initReviewsCarousel() {
            // Initialize carousel elements
            initializeCarouselElements();
            
            const prevBtn = document.getElementById('prev-review');
            const nextBtn = document.getElementById('next-review');
            
            if (prevBtn) {
                prevBtn.addEventListener('click', prevReview);
                console.log('Prev button event listener added');
            } else {
                console.log('Prev button not found');
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('click', nextReview);
                console.log('Next button event listener added');
            } else {
                console.log('Next button not found');
            }
            
            // Handle window resize
            window.addEventListener('resize', () => {
                console.log('Window resized, reinitializing carousel');
                initializeCarouselElements();
                currentReviewIndex = 0; // Reset to first review on resize
                updateReviewsDisplay();
            });
            
            // Initialize display after a short delay to ensure DOM is ready
            setTimeout(() => {
                console.log('Initializing carousel display...');
                initializeCarouselElements(); // Re-initialize to ensure elements are found
                updateReviewsDisplay();
            }, 200);
            
            console.log('Reviews carousel initialized');
        }

        // Initialize gallery when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Load gallery data
            loadGalleryData();
            
            // Initialize gallery filters
            initGalleryFilters();
            
            // Initialize reviews carousel
            initReviewsCarousel();
            
            console.log('Gallery functionality initialized');
        });
    </script>
    
    <script src="cache-buster.js?v=5.8"></script>
    
    <!-- Mobile Cache Buster -->
    <script>
        // Force cache refresh for mobile browsers
        if (window.innerWidth <= 768) {
            console.log('Mobile detected - forcing cache refresh');
            
            // Add timestamp to all stylesheets
            const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
            stylesheets.forEach(link => {
                const href = link.href;
                if (href.includes('styles.css')) {
                    link.href = href.split('?')[0] + '?v=' + Date.now() + '&mobile=1';
                    console.log('Updated stylesheet:', link.href);
                }
            });
            
            // Force reload if this is a cached version or if no changes detected
            if (performance.navigation.type === 2 || localStorage.getItem('lastMobileVersion') !== '3.1') {
                console.log('Cache detected or version mismatch - reloading');
                localStorage.setItem('lastMobileVersion', '3.1');
                window.location.reload(true);
            }
            
            // Additional mobile-specific cache busting
            setTimeout(() => {
                const allLinks = document.querySelectorAll('link[rel="stylesheet"], script[src]');
                allLinks.forEach(link => {
                    const url = link.href || link.src;
                    if (url && !url.includes('?v=')) {
                        link.href = url + '?v=' + Date.now();
                    }
                });
            }, 100);
        }
    </script>
</body>
</html>
