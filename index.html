<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STP Solar - Premium Solar Solutions in South Africa</title>
    <meta name="description" content="STP Solar provides premium solar panel installation, maintenance, and energy solutions for homes and businesses across South Africa. Save money and go green with our expert solar services.">
    <meta name="keywords" content="solar panels, solar installation, renewable energy, South Africa, solar power, energy savings">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="STP Solar - Premium Solar Solutions">
    <meta property="og:description" content="Transform your energy costs with STP Solar's premium solar solutions. Expert installation and maintenance across South Africa.">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-solar-panel"></i>
                <span>STP Solar</span>
            </div>
            
            <div class="nav-menu" id="nav-menu">
                <a href="#home" class="nav-link">Home</a>
                <a href="#services" class="nav-link">Services</a>
                <a href="#gallery" class="nav-link">Gallery</a>
                <a href="#reviews" class="nav-link">Reviews</a>
                <a href="#about" class="nav-link">About</a>
                <a href="#calculator" class="nav-link">System Builder</a>
                <a href="#contact" class="nav-link">Contact</a>
            </div>
            
            <div class="nav-toggle" id="nav-toggle">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="hero-container">
            <div class="hero-content">
                <h1 class="hero-title">
                    Power Your Future with 
                    <span class="highlight">Premium Solar Solutions</span>
                </h1>
                <p class="hero-subtitle">
                    STP Solar specializes in residential and commercial solar installations using Tier 1 panels from JA Solar and Canadian Solar, with premium inverters from Sigenstor, Sunsynk, and Tesla Powerwall 3 systems.
                </p>
                <div class="hero-buttons">
                    <a href="#calculator" class="btn btn-primary">
                        <i class="fas fa-cogs"></i>
                        Build Your System
                    </a>
                    <a href="#contact" class="btn btn-secondary">
                        <i class="fas fa-phone"></i>
                        Get Free Quote
                    </a>
                    <a href="https://wa.me/27817480779" target="_blank" class="btn btn-whatsapp">
                        <i class="fab fa-whatsapp"></i>
                        WhatsApp Us
                    </a>
                </div>
                <div class="hero-stats">
                    <div class="stat">
                        <span class="stat-number">100+</span>
                        <span class="stat-label">Happy Customers</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">5MW+</span>
                        <span class="stat-label">Solar Installed</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">90%</span>
                        <span class="stat-label">Average Savings</span>
                    </div>
                </div>
            </div>
            <div class="hero-image">
                <div class="solar-panel-illustration">
                    <i class="fas fa-solar-panel solar-icon"></i>
                    <div class="energy-lines">
                        <div class="energy-line"></div>
                        <div class="energy-line"></div>
                        <div class="energy-line"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="services">
        <div class="container">
            <div class="section-header">
                <h2>Our Solar Services</h2>
                <p>Comprehensive solar solutions tailored to your energy needs</p>
            </div>
            
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <h3>Residential Solar</h3>
                    <p>Complete home solar systems featuring JA Solar and Canadian Solar panels with Sigenstor, Sunsynk inverters, and Tesla Powerwall 3 backup solutions.</p>
                    <ul class="service-features">
                        <li>JA Solar & Canadian Solar panels</li>
                        <li>Tesla Powerwall 3 backup systems</li>
                        <li>Sigenstor & Sunsynk inverters</li>
                        <li>Grid-tie and hybrid solutions</li>
                    </ul>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <h3>Commercial Solar</h3>
                    <p>Large-scale commercial installations using premium Tier 1 panels and industrial-grade inverters for maximum efficiency and ROI.</p>
                    <ul class="service-features">
                        <li>Industrial solar farms</li>
                        <li>Commercial rooftop systems</li>
                        <li>High-capacity inverters</li>
                        <li>Business backup solutions</li>
                    </ul>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-tools"></i>
                    </div>
                    <h3>Maintenance & Support</h3>
                    <p>Professional maintenance services to ensure your solar system operates at peak efficiency for decades.</p>
                    <ul class="service-features">
                        <li>Regular system inspections</li>
                        <li>Panel cleaning services</li>
                        <li>Performance monitoring</li>
                        <li>24/7 technical support</li>
                    </ul>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Energy Consulting</h3>
                    <p>Expert energy audits and consulting to optimize your power consumption and maximize solar investment returns.</p>
                    <ul class="service-features">
                        <li>Energy consumption analysis</li>
                        <li>System sizing optimization</li>
                        <li>Financial modeling</li>
                        <li>Government incentive guidance</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Solar System Builder Section -->
    <section id="calculator" class="calculator">
        <div class="container">
            <div class="section-header">
                <h2>Solar System Builder</h2>
                <p>Choose the perfect solar system for your home or business</p>
            </div>
            
            <div class="system-builder-container">
                <!-- System Type Selection -->
                <div class="system-type-selection">
                    <h3>Select System Type</h3>
                    <p class="system-type-description">Choose between traditional Sunsynk systems or Tesla Powerwall solutions</p>
                    
                    <div class="system-type-dropdown">
                        <select id="system-type-select" onchange="selectSystemType()">
                            <option value="">Select System Type</option>
                        </select>
                    </div>
                </div>
                
                <!-- Sunsynk Phase Selection -->
                <div class="phase-selection" id="phase-selection" style="display: none;">
                    <h3>Select Your Power Type</h3>
                    <p class="phase-description">Please select the type of power you have. If you are not sure, please select Single Phase.</p>
                    
                    <div class="phase-options">
                        <div class="phase-option" data-phase="single">
                            <div class="phase-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <h4>Single Phase</h4>
                            <p>Most residential homes</p>
                        </div>
                        
                        <div class="phase-option" data-phase="three">
                            <div class="phase-icon">
                                <i class="fas fa-bolt"></i>
                                <i class="fas fa-bolt"></i>
                                <i class="fas fa-bolt"></i>
                            </div>
                            <h4>Three Phase</h4>
                            <p>Large homes and businesses</p>
                        </div>
                    </div>
                </div>
                
                <!-- Tesla Configuration -->
                <div class="tesla-configuration" id="tesla-configuration" style="display: none;">
                    <h3>Configure Your Tesla Powerwall 3 System</h3>
                    <div class="tesla-options">
                        <div class="tesla-unit-selection">
                            <h4>Number of Tesla Units</h4>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="adjustTeslaUnits(-1)">-</button>
                                <span class="quantity-display" id="tesla-units-quantity">1</span>
                                <button class="quantity-btn" onclick="adjustTeslaUnits(1)">+</button>
                            </div>
                            <p class="tesla-description">Each unit provides 13.5kWh capacity. Add up to 4 units for maximum capacity.</p>
                        </div>
                        
                        <div class="tesla-panels-option">
                            <h4>Solar Panels (Optional)</h4>
                            <div class="panel-selection">
                                <label>
                                    <input type="checkbox" id="include-panels" onchange="toggleTeslaPanels()">
                                    Include Solar Panels
                                </label>
                                <div class="panel-quantity" id="tesla-panel-quantity" style="display: none;">
                                    <div class="quantity-controls">
                                        <button class="quantity-btn" onclick="adjustTeslaPanels(-1)">-</button>
                                        <span class="quantity-display" id="tesla-panels-count">6</span>
                                        <button class="quantity-btn" onclick="adjustTeslaPanels(1)">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- System Selection -->
                <div class="system-selection" id="system-selection" style="display: none;">
                    <h3>Choose Your System</h3>
                    <div class="systems-grid" id="systems-grid">
                        <!-- Systems will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Customization Section -->
                <div class="customization-section" id="customization-section" style="display: none;">
                    <h3>Customize Your System</h3>
                    <div class="customization-grid">
                        <div class="customization-item">
                            <h5>Solar Panels</h5>
                            <div class="selection-controls">
                                <select id="panel-selection" onchange="selectPanel()" class="component-select">
                                    <option value="">Select Panel Type</option>
                                </select>
                            </div>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="adjustPanels(-1)">-</button>
                                <span class="quantity-display" id="panels-quantity">6</span>
                                <button class="quantity-btn" onclick="adjustPanels(1)">+</button>
                            </div>
                            <div class="quantity-limits">
                                <small>Range: <span id="panels-min">6</span> - <span id="panels-max">50</span> panels (0 = no panels)</small>
                            </div>
                            
                            <!-- Roof Type Selection -->
                            <div class="roof-type-selection">
                                <h6>Roof Type</h6>
                                <div class="roof-options">
                                    <label class="roof-option">
                                        <input type="checkbox" id="roof-ibr-tile" checked onchange="updateRoofType(this)">
                                        <span class="roof-label">IBR/Tile Roof</span>
                                    </label>
                                    <label class="roof-option">
                                        <input type="checkbox" id="roof-concrete" onchange="updateRoofType(this)">
                                        <span class="roof-label">Concrete Roof</span>
                                    </label>
                                </div>
                            </div>
                            
                            <p class="customization-price" id="panels-price">R15,000</p>
                        </div>
                        
                        <div class="customization-item">
                            <h5>Batteries</h5>
                            <div class="selection-controls">
                                <select id="battery-selection" onchange="selectBattery()" class="component-select">
                                    <option value="">Select Battery Type</option>
                                </select>
                            </div>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="adjustBatteries(-1)">-</button>
                                <span class="quantity-display" id="batteries-quantity">1</span>
                                <button class="quantity-btn" onclick="adjustBatteries(1)">+</button>
                            </div>
                            <div class="quantity-limits">
                                <small>Range: <span id="batteries-min">1</span> - <span id="batteries-max">10</span> batteries (required)</small>
                            </div>
                            <p class="customization-price" id="batteries-price">R45,000</p>
                        </div>
                    </div>
                    
                    <div class="pricing-summary">
                        <h4>System Pricing</h4>
                        <div class="pricing-item">
                            <span>Inverter</span>
                            <span id="inverter-price">R25,000</span>
                        </div>
                        <div class="pricing-item">
                            <span>Batteries</span>
                            <span id="battery-price">R45,000</span>
                        </div>
                        <div class="pricing-item">
                            <span>Solar Panels</span>
                            <span id="panel-price">R15,000</span>
                        </div>
                        <div class="pricing-item">
                            <span>Installation</span>
                            <span id="installation-price">R8,500</span>
                        </div>
                        <div class="pricing-item">
                            <span>Accessories</span>
                            <span id="accessories-price">R15,000</span>
                        </div>
                        <div class="pricing-item">
                            <span><strong>Total System Price</strong></span>
                            <span><strong id="total-price">R180,000</strong></span>
                        </div>
                    </div>
                    
                    <div class="system-cta">
                        <button onclick="getQuoteForSystem()" class="btn btn-success">Get Quote for This System</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Reviews Section -->
    <section id="reviews" class="reviews">
        <div class="container">
            <div class="section-header">
                <h2>What Our Customers Say</h2>
                <p>Real reviews from satisfied STP Solar customers</p>
            </div>
            
            <div class="reviews-container">
                <div class="reviews-slider" id="reviews-slider">
                    <!-- Review 1 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Diksha S.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Extremely high quality service, wouldn't hire anyone else. Very trustworthy with quality panels and inverters. Saved over R5k a month on electricity bill and no load shedding issues."</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                    
                    <!-- Review 2 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Denise G.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Hassle free, efficient, professional and friendly service. This dynamic father and son team work seamlessly together and had our solar power solution installed and working in record time! Thank you!"</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                    
                    <!-- Review 3 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Salmon M.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Excellent service, very professional and attention to detail. Competitive pricing with an experienced team. I would highly recommend them. Thanks Sean, Indres and team."</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                    
                    <!-- Review 4 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Naeem K.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"The team is extremely knowledgeable, efficient and willing to go the extra mile. I had a great experience from designing my solar solution to implementation and sign-off."</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                    
                    <!-- Review 5 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Percy M.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Excellent Service! Professional, Neat and Timely! Would highly recommend STP Solar for any electrical work!"</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                    
                    <!-- Review 6 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Devan G.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Excellent service and highly professional. My go to for all things solar and home automation."</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                    
                    <!-- Review 7 -->
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="reviewer-details">
                                    <h4>Mahesh D.</h4>
                                </div>
                            </div>
                            <div class="review-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-text">5.0</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>"Sean and Indres are very helpful. They have installed a backup inverter setup at my house. The workmanship is very neat and professional."</p>
                        </div>
                        <div class="review-source">
                            <i class="fab fa-google"></i>
                            <span>Google Review</span>
                        </div>
                    </div>
                </div>
                
                <div class="reviews-controls">
                    <button class="review-btn prev-btn" id="prev-review">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="review-btn next-btn" id="next-review">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <div class="reviews-stats">
                    <div class="stat-item">
                        <div class="stat-number">5.0</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100+</div>
                        <div class="stat-label">Happy Customers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">Satisfaction Rate</div>
                    </div>
                </div>
                
                <div class="reviews-cta">
                    <a href="https://www.google.com/search?q=stp+solar&oq=stp+solar+&gs_lcrp=EgZjaHJvbWUqDAgAECMYJxiABBiKBTIMCAAQIxgnGIAEGIoFMg0IARAuGK8BGMcBGIAEMgcIAhAAGIAEMgcIAxAAGIAEMgcIBBAAGIAEMgYIBRBFGDwyBggGEEUYPDIGCAcQRRg80gEIMjQ2N2owajeoAgCwAgA&sourceid=chrome&ie=UTF-8#mpd=~2277063622321751607/customers/reviews" target="_blank" class="btn btn-outline">
                        <i class="fab fa-google"></i>
                        Read More Reviews on Google
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery" class="gallery">
        <div class="container">
            <div class="section-header">
                <h2>Our Work Gallery</h2>
                <p>Professional solar installations across South Africa - showcasing our expertise with Sunsynk, Tesla Powerwall, and premium solar solutions</p>
            </div>
            
            <div class="gallery-filters">
                <button class="filter-btn active" data-filter="all">All Projects</button>
                <button class="filter-btn" data-filter="residential">Residential</button>
                <button class="filter-btn" data-filter="commercial">Commercial</button>
                <button class="filter-btn" data-filter="sunsynk">Sunsynk Systems</button>
                <button class="filter-btn" data-filter="tesla">Tesla Powerwall</button>
            </div>
            
            <div class="gallery-grid" id="gallery-grid">
                <!-- Gallery Item 1 - Sunsynk Installation -->
                <div class="gallery-item" data-category="residential sunsynk">
                    <div class="gallery-image">
                        <img src="https://via.placeholder.com/400x300/2c3e50/ffffff?text=Sunsynk+Installation" alt="Professional Sunsynk inverter and battery installation">
                        <div class="gallery-overlay">
                            <div class="gallery-content">
                                <h4>Sunsynk Hybrid System</h4>
                                <p>8kW Sunsynk inverter with dual 5.12kWh batteries</p>
                                <div class="gallery-tags">
                                    <span class="tag">Residential</span>
                                    <span class="tag">Sunsynk</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gallery Item 2 - Tesla Powerwall -->
                <div class="gallery-item" data-category="residential tesla">
                    <div class="gallery-image">
                        <img src="https://via.placeholder.com/400x300/34495e/ffffff?text=Tesla+Powerwall" alt="Tesla Powerwall installation">
                        <div class="gallery-overlay">
                            <div class="gallery-content">
                                <h4>Tesla Powerwall 3</h4>
                                <p>Premium home energy storage solution</p>
                                <div class="gallery-tags">
                                    <span class="tag">Residential</span>
                                    <span class="tag">Tesla</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gallery Item 3 - Solar Panels -->
                <div class="gallery-item" data-category="residential">
                    <div class="gallery-image">
                        <img src="https://via.placeholder.com/400x300/27ae60/ffffff?text=Solar+Panels" alt="JA Solar panels installation on residential roof">
                        <div class="gallery-overlay">
                            <div class="gallery-content">
                                <h4>JA Solar Panel Array</h4>
                                <p>20x 565W JA Solar panels on residential roof</p>
                                <div class="gallery-tags">
                                    <span class="tag">Residential</span>
                                    <span class="tag">JA Solar</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gallery Item 4 - Commercial Installation -->
                <div class="gallery-item" data-category="commercial sunsynk">
                    <div class="gallery-image">
                        <img src="https://via.placeholder.com/400x300/e74c3c/ffffff?text=Commercial+System" alt="Large commercial solar installation">
                        <div class="gallery-overlay">
                            <div class="gallery-content">
                                <h4>Commercial Solar System</h4>
                                <p>50kW commercial installation with Sunsynk inverters</p>
                                <div class="gallery-tags">
                                    <span class="tag">Commercial</span>
                                    <span class="tag">Sunsynk</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gallery Item 5 - Complete System -->
                <div class="gallery-item" data-category="residential sunsynk">
                    <div class="gallery-image">
                        <img src="https://via.placeholder.com/400x300/8e44ad/ffffff?text=Complete+System" alt="Complete solar system with inverter and batteries">
                        <div class="gallery-overlay">
                            <div class="gallery-content">
                                <h4>Complete Home System</h4>
                                <p>16kW system with backup batteries and monitoring</p>
                                <div class="gallery-tags">
                                    <span class="tag">Residential</span>
                                    <span class="tag">Complete</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gallery Item 6 - Tesla Integration -->
                <div class="gallery-item" data-category="residential tesla">
                    <div class="gallery-image">
                        <img src="https://via.placeholder.com/400x300/3498db/ffffff?text=Tesla+Integration" alt="Tesla Powerwall with solar panels and EV charging">
                        <div class="gallery-overlay">
                            <div class="gallery-content">
                                <h4>Tesla Energy Ecosystem</h4>
                                <p>Powerwall with solar panels and EV charging</p>
                                <div class="gallery-tags">
                                    <span class="tag">Residential</span>
                                    <span class="tag">Tesla</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gallery Item 7 - Professional Installation -->
                <div class="gallery-item" data-category="residential sunsynk">
                    <div class="gallery-image">
                        <img src="https://via.placeholder.com/400x300/f39c12/ffffff?text=Professional+Install" alt="Professional electrical installation work">
                        <div class="gallery-overlay">
                            <div class="gallery-content">
                                <h4>Professional Installation</h4>
                                <p>Clean, organized electrical work and cable management</p>
                                <div class="gallery-tags">
                                    <span class="tag">Residential</span>
                                    <span class="tag">Professional</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gallery Item 8 - Large Commercial -->
                <div class="gallery-item" data-category="commercial">
                    <div class="gallery-image">
                        <img src="https://via.placeholder.com/400x300/1abc9c/ffffff?text=Large+Commercial" alt="Large commercial solar panel array">
                        <div class="gallery-overlay">
                            <div class="gallery-content">
                                <h4>Large Commercial Array</h4>
                                <p>100kW+ commercial solar installation</p>
                                <div class="gallery-tags">
                                    <span class="tag">Commercial</span>
                                    <span class="tag">Large Scale</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="gallery-cta">
                <a href="#contact" class="btn btn-primary">
                    <i class="fas fa-camera"></i>
                    Get Your Project Featured
                </a>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about">
        <div class="container">
            <div class="about-content">
                <div class="about-text">
                    <h2>Why Choose STP Solar?</h2>
                    <p class="about-intro">
                        With over 10 years of experience in the South African solar industry, STP Solar has established itself as a trusted leader in renewable energy solutions.
                    </p>
                    
                    <div class="about-features">
                        <div class="feature">
                            <i class="fas fa-award"></i>
                            <div>
                                <h4>Certified Excellence</h4>
                                <p>Certified Electrical and Solar installers with industry-leading training and certifications.</p>
                            </div>
                        </div>
                        
                        <div class="feature">
                            <i class="fas fa-shield-alt"></i>
                            <div>
                                <h4>Standard Industry Warranty</h4>
                                <p>10 years on inverters and batteries, 12 years on solar panels. Comprehensive warranty coverage on all installations and components.</p>
                            </div>
                        </div>
                        
                        <div class="feature">
                            <i class="fas fa-leaf"></i>
                            <div>
                                <h4>Eco-Friendly</h4>
                                <p>Reduce your carbon footprint while saving money on energy costs.</p>
                            </div>
                        </div>
                        
                        <div class="feature">
                            <i class="fas fa-headset"></i>
                            <div>
                                <h4>24/7 Support</h4>
                                <p>Round-the-clock technical support and maintenance services.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="about-image">
                    <div class="image-placeholder">
                        <i class="fas fa-solar-panel"></i>
                        <p>Professional Installation Team</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="portfolio">
        <div class="container">
            <div class="section-header">
                <h2>Our Recent Projects</h2>
                <p>See the quality of our solar installations</p>
            </div>
            
            <div class="portfolio-grid">
                <div class="portfolio-item">
                    <div class="portfolio-image">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="portfolio-content">
                        <h3>Residential Installation</h3>
                        <p>5kW system with battery backup</p>
                        <span class="portfolio-location">Fourways, Gauteng</span>
                    </div>
                </div>
                
                <div class="portfolio-item">
                    <div class="portfolio-image">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="portfolio-content">
                        <h3>Commercial Project</h3>
                        <p>50kW industrial solar farm</p>
                        <span class="portfolio-location">Krammerville, Johannesburg</span>
                    </div>
                </div>
                
                <div class="portfolio-item">
                    <div class="portfolio-image">
                        <i class="fas fa-industry"></i>
                    </div>
                    <div class="portfolio-content">
                        <h3>Factory Installation</h3>
                        <p>100kW manufacturing facility</p>
                        <span class="portfolio-location">Centurion, Gauteng</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="contact">
        <div class="container">
            <div class="section-header">
                <h2>Get Your Free Solar Quote</h2>
                <p>Ready to start saving on your electricity bills?</p>
            </div>
            
            <div class="contact-content">
                <div class="contact-form">
                    <form id="quote-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="name">Full Name *</label>
                                <input type="text" id="name" name="name" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address *</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="phone">Phone Number *</label>
                                <input type="tel" id="phone" name="phone" required>
                            </div>
                            <div class="form-group">
                                <label for="location">City</label>
                                <input type="text" id="location" name="location" placeholder="e.g., Cape Town">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="monthly-bill">Monthly Electricity Bill (R)</label>
                            <input type="number" id="monthly-bill" name="monthly-bill" placeholder="2500">
                        </div>
                        
                        <div class="form-group">
                            <label for="message">Additional Information</label>
                            <textarea id="message" name="message" rows="4" placeholder="Tell us about your energy needs, roof type, or any specific requirements..."></textarea>
                        </div>
                        
                        <!-- Hidden field for system configuration -->
                        <input type="hidden" id="system-config" name="system-config" value="">
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            Request Free Quote
                        </button>
                    </form>
                </div>
                
                <div class="contact-info">
                    <h3>Contact Information</h3>
                    
                    <div class="contact-item">
                        <i class="fas fa-mobile-alt"></i>
                        <div>
                            <h4>Mobile</h4>
                            <p><a href="tel:0817480779">081 748 0779</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <div>
                            <h4>Landline</h4>
                            <p><a href="tel:0105007999">010 500 7999</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <h4>Email</h4>
                            <p><a href="mailto:info@stpsolar.co.za">info@stpsolar.co.za</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <h4>Address</h4>
                            <p>Savanna Hills Estate<br>Midrand, Gauteng, 1682</p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fab fa-whatsapp"></i>
                        <div>
                            <h4>WhatsApp</h4>
                            <p><a href="https://wa.me/27817480779" target="_blank">Chat with us on WhatsApp</a></p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <h4>Business Hours</h4>
                            <p>Monday - Friday: 8:00 AM - 6:00 PM<br>Saturday: 9:00 AM - 2:00 PM<br>Sunday: Closed</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Floating WhatsApp Button -->
    <div class="whatsapp-float">
        <a href="https://wa.me/27817480779" target="_blank" class="whatsapp-btn">
            <i class="fab fa-whatsapp"></i>
        </a>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-solar-panel"></i>
                        <span>STP Solar</span>
                    </div>
                    <p>Leading South Africa's transition to clean, renewable solar energy. Professional installation and maintenance services you can trust.</p>
                    <div class="social-links">
                        <a href="https://www.facebook.com/www.stpsolar.co.za" target="_blank" class="social-link"><i class="fab fa-facebook"></i></a>
                        <a href="https://www.instagram.com/stp_solar/" target="_blank" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.linkedin.com/company/92800961" target="_blank" class="social-link"><i class="fab fa-linkedin"></i></a>
                        <a href="https://www.youtube.com/@stpsolar" target="_blank" class="social-link"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Services</h4>
                    <ul>
                        <li><a href="#services">Residential Solar</a></li>
                        <li><a href="#services">Commercial Solar</a></li>
                        <li><a href="#services">Maintenance</a></li>
                        <li><a href="#services">Energy Consulting</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="#about">About Us</a></li>
                        <li><a href="#portfolio">Portfolio</a></li>
                        <li><a href="#contact">Contact</a></li>
                        <li><a href="#">Careers</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#calculator">Solar Calculator</a></li>
                        <li><a href="#">Solar Guide</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Blog</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="terms-conditions.html">Terms & Conditions</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="#">Warranty Information</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 STP Solar. All rights reserved. | <a href="privacy-policy.html">Privacy Policy</a> | <a href="terms-conditions.html">Terms & Conditions</a></p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="pricing-config.js"></script>
    <script>
        // System Builder JavaScript (working version)
        console.log('System Builder script loaded');
        
        // Load pricing from localStorage or use default from pricing-config.js
        function loadPricing() {
            const savedPricing = localStorage.getItem('stp-solar-pricing');
            if (savedPricing) {
                console.log('Loading pricing from localStorage:', JSON.parse(savedPricing));
                return JSON.parse(savedPricing);
            }
            console.log('Loading pricing from pricing-config.js (default for new clients):', pricingConfig);
            console.log('Available inverters:', Object.keys(pricingConfig.inverters));
            return pricingConfig;
        }
        
        // Get current pricing
        let currentPricing = loadPricing();
        
        // Listen for pricing updates
        window.addEventListener('pricingUpdated', function(event) {
            currentPricing = event.detail;
            console.log('Pricing updated on main page:', currentPricing);
            // Update system configurations with new pricing
            updateSystemConfigurations();
            // Refresh the page to show new prices
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        });
        
        // Function to create system configurations with current pricing
        function createSystemConfigurations() {
            console.log('Creating system configurations...');
            console.log('Current pricing:', currentPricing);
            
            const singlePhaseSystems = [];
            const threePhaseSystems = [];
            
            // Get available components from pricing data
            const inverters = currentPricing.inverters || {};
            const batteries = currentPricing.batteries || {};
            const panels = currentPricing.panels || {};
            const installation = currentPricing.installation || {};
            const markup = currentPricing.markup || {};
            
            console.log('Available inverters:', Object.keys(inverters));
            console.log('Available batteries:', Object.keys(batteries));
            console.log('Available panels:', Object.keys(panels));
            
            // Create systems for each available inverter
            Object.entries(inverters).forEach(([inverterKey, inverterData]) => {
                // Collect brands for dynamic system type dropdown
                if (typeof inverterData === 'object' && inverterData !== null && inverterData.brand) {
                    window.__availableBrands = window.__availableBrands || new Set();
                    window.__availableBrands.add(inverterData.brand);
                } else if (inverterKey.toLowerCase().includes('tesla')) {
                    window.__availableBrands = window.__availableBrands || new Set();
                    window.__availableBrands.add('Tesla');
                }
                // Skip Tesla inverters - they will be handled as special battery systems
                if (inverterKey.toLowerCase().includes('tesla')) {
                    return;
                }
                
        // Handle both old format (price number) and new format (inverter object)
        let inverterPrice, inverterName, inverterType, inverterCapacity;
        
        if (typeof inverterData === 'number') {
            // Old format - just a price
            inverterPrice = inverterData;
            inverterName = inverterKey.replace(/-/g, ' ');
            inverterType = inverterKey.includes('3P') ? 'three' : 'single';
            inverterCapacity = parseFloat(inverterKey.match(/\d+/)?.[0]) || 5;
        } else if (typeof inverterData === 'object' && inverterData !== null) {
            // New format - rich inverter object
            inverterPrice = inverterData.price || 0;
            inverterName = inverterData.name || inverterKey.replace(/-/g, ' ');
            inverterType = inverterData.type || (inverterKey.includes('3P') ? 'three' : 'single');
            inverterCapacity = inverterData.capacity || parseFloat(inverterKey.match(/\d+/)?.[0]) || 5;
        } else {
            // Fallback for any other format
            console.warn('Unknown inverter data format for:', inverterKey, inverterData);
            inverterPrice = 25000; // Default price
            inverterName = inverterKey.replace(/-/g, ' ');
            inverterType = inverterKey.includes('3P') ? 'three' : 'single';
            inverterCapacity = parseFloat(inverterKey.match(/\d+/)?.[0]) || 5;
        }
                
                const isThreePhase = inverterType === 'three';
                const systemType = isThreePhase ? threePhaseSystems : singlePhaseSystems;
                
                // Use the capacity from the inverter data
                const capacity = inverterCapacity;
                
        // Determine appropriate battery and quantity based on capacity and limits
        let batteryKey, batteryQuantity;
        const minBatteries = isThreePhase ? (currentPricing.limits?.['three-batteries-min'] || 2) : (currentPricing.limits?.['single-batteries-min'] || 1);
        const maxBatteries = isThreePhase ? (currentPricing.limits?.['three-batteries-max'] || 20) : (currentPricing.limits?.['single-batteries-max'] || 10);
        
        // Use compatible batteries from inverter definition or fallback to default logic
        if (typeof inverterData === 'object' && inverterData !== null && inverterData.compatibleBatteries && inverterData.compatibleBatteries.length > 0) {
            // Use first compatible battery
            batteryKey = inverterData.compatibleBatteries[0];
            // Determine quantity based on capacity
            if (capacity <= 5) {
                batteryQuantity = Math.min(maxBatteries, Math.max(minBatteries, 1));
            } else if (capacity <= 10) {
                batteryQuantity = Math.min(maxBatteries, Math.max(minBatteries, 2));
            } else {
                batteryQuantity = Math.min(maxBatteries, Math.max(minBatteries, capacity <= 16 ? 2 : 3));
            }
        } else {
            // Fallback to original logic
            if (capacity <= 5) {
                batteryKey = 'Sunsynk-5.12kWh';
                batteryQuantity = Math.min(maxBatteries, Math.max(minBatteries, 1));
            } else if (capacity <= 10) {
                batteryKey = 'Sunsynk-5.12kWh';
                batteryQuantity = Math.min(maxBatteries, Math.max(minBatteries, 2));
            } else {
                batteryKey = 'Sunsynk-10kWh';
                batteryQuantity = Math.min(maxBatteries, Math.max(minBatteries, capacity <= 16 ? 2 : 3));
            }
        }
            
            // Use compatible panels from inverter definition or fallback to available panels
            let panelKey;
            if (typeof inverterData === 'object' && inverterData !== null && inverterData.compatiblePanels && inverterData.compatiblePanels.length > 0) {
                panelKey = inverterData.compatiblePanels[0]; // Use first compatible panel
            } else {
                panelKey = panels['JA-Solar-565W'] ? 'JA-Solar-565W' : Object.keys(panels)[0] || 'JA-Solar-565W';
            }
            
            const minPanels = isThreePhase ? (currentPricing.limits?.['three-panels-min'] || 8) : (currentPricing.limits?.['single-panels-min'] || 6);
            const maxPanels = isThreePhase ? (currentPricing.limits?.['three-panels-max'] || 100) : (currentPricing.limits?.['single-panels-max'] || 50);
            const panelQuantity = Math.min(maxPanels, Math.max(minPanels, Math.ceil(capacity * 1000 / 565))); // Within limits, at least minimum panels, or enough for capacity
                
                const system = {
                    id: `${isThreePhase ? 'three' : 'single'}-${capacity}kw`,
                    name: `${capacity}kW ${inverterName} System`,
                    inverter: { 
                        name: inverterName,
                        key: inverterKey,
                        brand: typeof inverterData === 'object' && inverterData !== null ? inverterData.brand : null,
                        price: (inverterPrice || 25000) * (markup.inverter || 1.2) 
                    },
                    battery: { 
                        name: batteryKey.replace(/-/g, ' '), 
                        price: (batteries[batteryKey] || 45000) * (markup.battery || 1.15), 
                        quantity: batteryQuantity 
                    },
                    panel: { 
                        name: panelKey.replace(/-/g, ' '), 
                        price: (panels[panelKey] || 2500) * (markup.panels || 1.1), 
                        quantity: panelQuantity 
                    },
                    installation: (() => {
                        // Use installation costs from inverter definition or fallback to system-specific costs
                        let baseCost, accessoriesCost;
                        
                        if (typeof inverterData === 'object' && inverterData !== null && inverterData.installation) {
                            // New format - use installation costs from inverter definition
                            baseCost = inverterData.installation.base || 0;
                            accessoriesCost = inverterData.installation.accessories || 0;
                            
                            // If linked to an installation package, use that instead
                            if (inverterData.linkedInstallation && currentPricing.installationDefinitions) {
                                const linkedInstallation = currentPricing.installationDefinitions[inverterData.linkedInstallation];
                                if (linkedInstallation) {
                                    baseCost = linkedInstallation.base || baseCost;
                                    accessoriesCost = linkedInstallation.accessories || accessoriesCost;
                                }
                            }
                        } else {
                            // Old format - use system-specific installation costs
                            const baseKey = isThreePhase ? 'three-base-installation' : 'single-base-installation';
                            const accessoriesKey = isThreePhase ? 'three-accessories' : 'single-accessories';
                            baseCost = installation[baseKey] || (isThreePhase ? 12000 : 8500);
                            accessoriesCost = installation[accessoriesKey] || (isThreePhase ? 20000 : 15000);
                        }
                        
                        const total = (baseCost + accessoriesCost) * (markup.installation || 1);
                        console.log(`Installation calculation for ${inverterKey}: base=${baseCost}, accessories=${accessoriesCost}, total=${total}`);
                        return total;
                    })(),
                    installationBreakdown: (() => {
                        // Store separate installation and accessories costs for display
                        let baseCost, accessoriesCost;
                        
                        if (typeof inverterData === 'object' && inverterData !== null && inverterData.installation) {
                            baseCost = inverterData.installation.base || 0;
                            accessoriesCost = inverterData.installation.accessories || 0;
                            
                            if (inverterData.linkedInstallation && currentPricing.installationDefinitions) {
                                const linkedInstallation = currentPricing.installationDefinitions[inverterData.linkedInstallation];
                                if (linkedInstallation) {
                                    baseCost = linkedInstallation.base || baseCost;
                                    accessoriesCost = linkedInstallation.accessories || accessoriesCost;
                                }
                            }
                        } else {
                            const baseKey = isThreePhase ? 'three-base-installation' : 'single-base-installation';
                            const accessoriesKey = isThreePhase ? 'three-accessories' : 'single-accessories';
                            baseCost = installation[baseKey] || (isThreePhase ? 12000 : 8500);
                            accessoriesCost = installation[accessoriesKey] || (isThreePhase ? 20000 : 15000);
                        }
                        
                        const installationMarkup = markup.installation || 1.25;
                        return {
                            installation: Math.round(baseCost * installationMarkup),
                            accessories: Math.round(accessoriesCost * installationMarkup)
                        };
                    })()
                };
                
                systemType.push(system);
            });
            
            // Create special systems for premium battery solutions (like Tesla Powerwall)
            Object.entries(batteries).forEach(([batteryKey, batteryPrice]) => {
                // Check if this is a premium battery system (Tesla, etc.)
                if (batteryKey.toLowerCase().includes('tesla') || batteryKey.toLowerCase().includes('powerwall')) {
                    // Extract capacity from battery key
                    const capacityMatch = batteryKey.match(/(\d+\.?\d*)/);
                    const capacity = capacityMatch ? parseFloat(capacityMatch[1]) : 13.5; // Default for Tesla Powerwall 3
                    
                    // Tesla Powerwall is standalone - no inverter required
                    const system = {
                        id: `single-${batteryKey.toLowerCase().replace(/[^a-z0-9]/g, '-')}`,
                        name: `${batteryKey.replace(/-/g, ' ')} System`,
                        inverter: null, // Tesla Powerwall doesn't need an inverter
                        battery: { 
                            name: batteryKey.replace(/-/g, ' '), 
                            price: (batteryPrice || 180000) * (markup.battery || 1.15), 
                            quantity: 1 
                        },
                        panel: null, // Solar panels are optional
                        installation: ((installation['tesla-base-installation'] || 10000) + 
                                     (installation['tesla-accessories'] || 18000)) * (markup.installation || 1),
                        installationBreakdown: {
                            installation: Math.round((installation['tesla-base-installation'] || 10000) * (markup.installation || 1.25)),
                            accessories: Math.round((installation['tesla-accessories'] || 18000) * (markup.installation || 1.25))
                        }
                    };
                    
                    singlePhaseSystems.push(system);
                }
            });
            
            
            // Sort systems by capacity
            singlePhaseSystems.sort((a, b) => {
                const aCap = parseInt(a.id.match(/(\d+)/)?.[1]) || 0;
                const bCap = parseInt(b.id.match(/(\d+)/)?.[1]) || 0;
                return aCap - bCap;
            });
            
            threePhaseSystems.sort((a, b) => {
                const aCap = parseInt(a.id.match(/(\d+)/)?.[1]) || 0;
                const bCap = parseInt(b.id.match(/(\d+)/)?.[1]) || 0;
                return aCap - bCap;
            });
            
            const result = {
                single: singlePhaseSystems,
                three: threePhaseSystems
            };
            
            console.log('Created systems:', result);
            console.log('Single phase systems:', singlePhaseSystems.length);
            console.log('Three phase systems:', threePhaseSystems.length);
            
            return result;
        }
        
        // Create systems with current pricing
        let systems = createSystemConfigurations();
        
        // Function to update system configurations
        function updateSystemConfigurations() {
            systems = createSystemConfigurations();
            console.log('System configurations updated:', systems);
        }
        
        let currentSystem = null;
        let currentPhase = null;
        
        function selectPhase(phase) {
            console.log('Phase selected:', phase);
            currentPhase = phase;
            
            // Update phase selection UI
            document.querySelectorAll('.phase-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-phase="${phase}"]`).classList.add('selected');
            
            // Show systems
            displaySystems(phase);
            document.getElementById('system-selection').style.display = 'block';
        }
        
        function displaySystems(phase) {
            console.log('Displaying systems for phase:', phase);
            console.log('Available systems:', systems);
            console.log('Selected brand:', window.selectedBrand);
            
            const grid = document.getElementById('systems-grid');
            grid.innerHTML = '';
            
            if (systems[phase] && systems[phase].length > 0) {
                // Filter systems by selected brand
                const filteredSystems = systems[phase].filter(system => {
                    if (!window.selectedBrand || window.selectedBrand === 'inverters') {
                        return true; // Show all if no brand selected or generic "inverters" selected
                    }
                    
                    // Check if the system's inverter matches the selected brand
                    if (system.inverter && system.inverter.brand) {
                        return system.inverter.brand.toLowerCase() === window.selectedBrand.toLowerCase();
                    }
                    
                    // Fallback: check inverter key for brand
                    if (system.inverter && system.inverter.key) {
                        const inverterKey = system.inverter.key.toLowerCase();
                        const selectedBrand = window.selectedBrand.toLowerCase();
                        return inverterKey.includes(selectedBrand);
                    }
                    
                    return false;
                });
                
                console.log('Filtered systems for brand', window.selectedBrand, ':', filteredSystems.length);
                
                if (filteredSystems.length > 0) {
                    filteredSystems.forEach((system, index) => {
                        console.log('Creating card for system', index, ':', system.name);
                        const systemCard = document.createElement('div');
                        systemCard.className = 'system-card';
                        systemCard.innerHTML = `
                            <h4>${system.name}</h4>
                            ${system.inverter ? `<p><strong>Inverter:</strong> ${system.inverter.name}</p>` : ''}
                            <p><strong>Batteries:</strong> ${system.battery.quantity}x ${system.battery.name}</p>
                            ${system.panel ? `<p><strong>Panels:</strong> ${system.panel.quantity}x ${system.panel.name}</p>` : '<p><strong>Panels:</strong> Optional (add separately)</p>'}
                            <div class="system-price">R${calculateSystemPrice(system).toLocaleString('en-ZA')}</div>
                        `;
                        
                        systemCard.addEventListener('click', () => selectSystem(system, systemCard));
                        grid.appendChild(systemCard);
                    });
                } else {
                    console.warn('No systems found for brand:', window.selectedBrand, 'and phase:', phase);
                    grid.innerHTML = `<p>No ${window.selectedBrand} systems available for this phase.</p>`;
                }
            } else {
                console.warn('No systems found for phase:', phase);
                grid.innerHTML = '<p>No systems available for this phase.</p>';
            }
        }
        
        function selectSystem(system, clickedElement) {
            console.log('System selected:', system.name);
            currentSystem = system;
            
            // Update system selection UI
            document.querySelectorAll('.system-card').forEach(card => {
                card.classList.remove('selected');
            });
            clickedElement.classList.add('selected');
            
            // Initialize customization
            initializeCustomization(system);
            
            // Show customization section
            document.getElementById('customization-section').style.display = 'block';
            
            // Scroll to customization section
            document.getElementById('customization-section').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }
        
        function initializeCustomization(system) {
            // Set initial values
            document.getElementById('panels-quantity').textContent = system.panel.quantity;
            document.getElementById('batteries-quantity').textContent = system.battery.quantity;
            
            // Update quantity limits based on system type
            updateQuantityLimits(system);
            
            // Populate component selection dropdowns based on current system's inverter
            populateComponentSelections(system);
            
            // Update pricing
            updatePricing();
        }
        
        // Function to update quantity limits display
        function updateQuantityLimits(system) {
            const systemType = getCurrentSystemType();
            const limits = getSystemLimits(systemType);
            
            // Update panels limits
            document.getElementById('panels-min').textContent = limits.panelsMin;
            document.getElementById('panels-max').textContent = limits.panelsMax;
            
            // Update batteries limits
            document.getElementById('batteries-min').textContent = limits.batteriesMin;
            document.getElementById('batteries-max').textContent = limits.batteriesMax;
            
            // Special handling for Tesla systems
            if (systemType === 'tesla') {
                document.querySelector('#batteries-min').parentElement.innerHTML = 
                    '<small>Tesla Powerwall includes built-in battery storage</small>';
            } else {
                // Update batteries text to show they are required
                const batteriesLimitsEl = document.querySelector('#batteries-min').parentElement;
                batteriesLimitsEl.innerHTML = 
                    `<small>Range: <span id="batteries-min">${limits.batteriesMin}</span> - <span id="batteries-max">${limits.batteriesMax}</span> batteries (required)</small>`;
            }
        }
        
        function populateComponentSelections(system) {
            // Get the current inverter's compatible components
            const inverterKey = getInverterKeyFromSystem(system);
            const inverterData = currentPricing.inverters[inverterKey];
            
            console.log('Populating component selections for system:', system.name);
            console.log('Inverter key:', inverterKey);
            console.log('Inverter data:', inverterData);
            
            if (inverterData && typeof inverterData === 'object') {
                console.log('Compatible panels:', inverterData.compatiblePanels);
                console.log('Compatible batteries:', inverterData.compatibleBatteries);
                
                // Populate panel selection
                populatePanelSelection(inverterData.compatiblePanels || []);
                
                // Populate battery selection
                populateBatterySelection(inverterData.compatibleBatteries || []);
            } else {
                console.log('Using fallback - all available components');
                // Fallback to all available components
                populatePanelSelection(Object.keys(currentPricing.panels || {}));
                populateBatterySelection(Object.keys(currentPricing.batteries || {}));
            }
        }
        
        function getInverterKeyFromSystem(system) {
            // Extract inverter key from system name or use a mapping
            if (system.inverter && system.inverter.name) {
                const name = system.inverter.name.toLowerCase();
                if (name.includes('sunsynk')) {
                    if (name.includes('5kw') || name.includes('5k')) return 'Sunsynk-5K';
                    if (name.includes('8kw') || name.includes('8k')) return 'Sunsynk-8K';
                    if (name.includes('16kw') || name.includes('16k')) return 'Sunsynk-16K';
                    if (name.includes('12kw') || name.includes('12k')) return 'Sunsynk 12Kw';
                    if (name.includes('10kw') || name.includes('10k')) {
                        return name.includes('3p') ? 'Sunsynk-10K-3P' : 'Sunsynk-10Kw';
                    }
                    if (name.includes('20kw') || name.includes('20k')) return 'Sunsynk-20K-3P';
                    if (name.includes('30kw') || name.includes('30k')) return 'Sunsynk-30K-3P';
                }
            }
            return 'Sunsynk-5K'; // Default fallback
        }
        
        function populatePanelSelection(compatiblePanels) {
            const panelSelect = document.getElementById('panel-selection');
            panelSelect.innerHTML = '<option value="">Select Panel Type</option>';
            
            // Add compatible panels
            compatiblePanels.forEach(panelKey => {
                const panelName = panelKey.replace(/-/g, ' ');
                const option = document.createElement('option');
                option.value = panelKey;
                option.textContent = panelName;
                panelSelect.appendChild(option);
            });
            
            // Set default selection to first compatible panel
            if (compatiblePanels.length > 0) {
                panelSelect.value = compatiblePanels[0];
                currentSystem.selectedPanel = compatiblePanels[0];
            }
        }
        
        function populateBatterySelection(compatibleBatteries) {
            const batterySelect = document.getElementById('battery-selection');
            batterySelect.innerHTML = '<option value="">Select Battery Type</option>';
            
            // Add compatible batteries
            compatibleBatteries.forEach(batteryKey => {
                const batteryName = batteryKey.replace(/-/g, ' ');
                const option = document.createElement('option');
                option.value = batteryKey;
                option.textContent = batteryName;
                batterySelect.appendChild(option);
            });
            
            // Set default selection to first compatible battery
            if (compatibleBatteries.length > 0) {
                batterySelect.value = compatibleBatteries[0];
                currentSystem.selectedBattery = compatibleBatteries[0];
            }
        }
        
        function selectPanel() {
            const panelSelect = document.getElementById('panel-selection');
            const selectedPanelKey = panelSelect.value;
            
            if (selectedPanelKey && currentSystem) {
                currentSystem.selectedPanel = selectedPanelKey;
                updatePricing();
            }
        }
        
        function selectBattery() {
            const batterySelect = document.getElementById('battery-selection');
            const selectedBatteryKey = batterySelect.value;
            
            if (selectedBatteryKey && currentSystem) {
                currentSystem.selectedBattery = selectedBatteryKey;
                updatePricing();
            }
        }
        
        function adjustPanels(change) {
            const quantityEl = document.getElementById('panels-quantity');
            let currentQuantity = parseInt(quantityEl.textContent);
            let newQuantity = currentQuantity + change;
            
            // Get current system type and limits
            const systemType = getCurrentSystemType();
            const limits = getSystemLimits(systemType);
            
            // Special case: if at 0 and trying to increase, go to minimum
            if (currentQuantity === 0 && change > 0) {
                newQuantity = limits.panelsMin;
            }
            // If trying to go below minimum (but not to 0), jump to 0
            else if (newQuantity < limits.panelsMin && newQuantity > 0) {
                newQuantity = 0;
            }
            // If trying to go above maximum, stay at maximum
            else if (newQuantity > limits.panelsMax) {
                newQuantity = limits.panelsMax;
            }
            // If trying to go below 0, stay at 0
            else if (newQuantity < 0) {
                newQuantity = 0;
            }
            quantityEl.textContent = newQuantity;
            updatePricing();
        }
        
        function adjustBatteries(change) {
            const quantityEl = document.getElementById('batteries-quantity');
            let currentQuantity = parseInt(quantityEl.textContent);
            let newQuantity = currentQuantity + change;
            
            // Get current system type and limits
            const systemType = getCurrentSystemType();
            const limits = getSystemLimits(systemType);
            
            // Batteries cannot go below minimum (systems need batteries to work)
            if (newQuantity < limits.batteriesMin) {
                newQuantity = limits.batteriesMin;
            }
            // If trying to go above maximum, stay at maximum
            else if (newQuantity > limits.batteriesMax) {
                newQuantity = limits.batteriesMax;
            }
            
            quantityEl.textContent = newQuantity;
            updatePricing();
        }
        
        // Helper function to get current system type
        function getCurrentSystemType() {
            if (!currentSystem) return 'single';
            
            // Check if it's a Tesla system
            if (currentSystem.inverter && currentSystem.inverter.name && currentSystem.inverter.name.includes('Tesla')) {
                return 'tesla';
            }
            
            // Check if it's three phase
            if (currentSystem.inverter && currentSystem.inverter.type === 'three') {
                return 'three';
            }
            
            // Default to single phase
            return 'single';
        }
        
        // Helper function to get system limits
        function getSystemLimits(systemType) {
            const limits = currentPricing.limits || {};
            
            switch (systemType) {
                case 'three':
                    return {
                        panelsMin: limits['three-panels-min'] || 8,
                        panelsMax: limits['three-panels-max'] || 100,
                        batteriesMin: limits['three-batteries-min'] || 2,
                        batteriesMax: limits['three-batteries-max'] || 20
                    };
                case 'tesla':
                    return {
                        panelsMin: limits['tesla-panels-min'] || 0,
                        panelsMax: limits['tesla-panels-max'] || 40,
                        batteriesMin: 0, // Tesla has built-in batteries
                        batteriesMax: limits['tesla-units-max'] || 4
                    };
                default: // single
                    return {
                        panelsMin: limits['single-panels-min'] || 6,
                        panelsMax: limits['single-panels-max'] || 50,
                        batteriesMin: limits['single-batteries-min'] || 1,
                        batteriesMax: limits['single-batteries-max'] || 10
                    };
            }
        }
        
        // Function to update roof type selection
        function updateRoofType(clickedCheckbox) {
            const ibrTileCheckbox = document.getElementById('roof-ibr-tile');
            const concreteCheckbox = document.getElementById('roof-concrete');
            
            // If IBR/Tile was clicked and is now checked, uncheck Concrete
            if (clickedCheckbox === ibrTileCheckbox && ibrTileCheckbox.checked) {
                concreteCheckbox.checked = false;
            }
            // If Concrete was clicked and is now checked, uncheck IBR/Tile
            else if (clickedCheckbox === concreteCheckbox && concreteCheckbox.checked) {
                ibrTileCheckbox.checked = false;
            }
            // If the clicked checkbox was unchecked, check the other one
            else if (!clickedCheckbox.checked) {
                if (clickedCheckbox === ibrTileCheckbox) {
                    concreteCheckbox.checked = true;
                } else {
                    ibrTileCheckbox.checked = true;
                }
            }
            
            // Update pricing when roof type changes
            updatePricing();
        }
        
        function updatePricing() {
            if (!currentSystem) return;
            
            const panelQuantity = parseInt(document.getElementById('panels-quantity').textContent);
            const batteryQuantity = parseInt(document.getElementById('batteries-quantity').textContent);
            
            // Get selected component types or use defaults
            const selectedPanelKey = currentSystem.selectedPanel || 'JA-Solar-565W';
            const selectedBatteryKey = currentSystem.selectedBattery || 'Sunsynk-5.12kWh';
            
            // Calculate prices using selected components
            const inverterPrice = currentSystem.inverter ? currentSystem.inverter.price : 0;
            
            // Get battery price from pricing data
            const batteryBasePrice = currentPricing.batteries[selectedBatteryKey] || 45000;
            const batteryMarkup = currentPricing.markup?.battery || 1.15;
            const batteryPrice = (batteryBasePrice * batteryMarkup) * batteryQuantity;
            
            // Get panel price from pricing data
            const panelBasePrice = currentPricing.panels[selectedPanelKey] || 2500;
            const panelMarkup = currentPricing.markup?.panels || 1.1;
            const panelPrice = (panelBasePrice * panelMarkup) * panelQuantity;
            
            // Calculate separate installation and accessories costs
            const { installationCost, accessoriesCost } = calculateInstallationCosts(currentSystem);
            
            const totalPrice = inverterPrice + batteryPrice + panelPrice + installationCost + accessoriesCost;
            
            // Update displays
            document.getElementById('inverter-price').textContent = 'R' + inverterPrice.toLocaleString('en-ZA');
            document.getElementById('battery-price').textContent = 'R' + batteryPrice.toLocaleString('en-ZA');
            document.getElementById('panel-price').textContent = 'R' + panelPrice.toLocaleString('en-ZA');
            document.getElementById('installation-price').textContent = 'R' + installationCost.toLocaleString('en-ZA');
            document.getElementById('accessories-price').textContent = 'R' + accessoriesCost.toLocaleString('en-ZA');
            document.getElementById('total-price').textContent = 'R' + totalPrice.toLocaleString('en-ZA');
            
            // Update customization prices
            document.getElementById('panels-price').textContent = 'R' + panelPrice.toLocaleString('en-ZA');
            document.getElementById('batteries-price').textContent = 'R' + batteryPrice.toLocaleString('en-ZA');
        }
        
        function calculateInstallationCosts(system) {
            // Get the current inverter's installation costs
            const inverterKey = getInverterKeyFromSystem(system);
            const inverterData = currentPricing.inverters[inverterKey];
            const markup = currentPricing.markup?.installation || 1.25;
            
            let baseInstallationCost = 0;
            let accessoriesCost = 0;
            
            if (inverterData && typeof inverterData === 'object' && inverterData.installation) {
                // Use installation costs from inverter definition
                baseInstallationCost = inverterData.installation.base || 0;
                accessoriesCost = inverterData.installation.accessories || 0;
                
                // If linked to an installation package, use that instead
                if (inverterData.linkedInstallation && currentPricing.installationDefinitions) {
                    const linkedInstallation = currentPricing.installationDefinitions[inverterData.linkedInstallation];
                    if (linkedInstallation) {
                        baseInstallationCost = linkedInstallation.base || baseInstallationCost;
                        accessoriesCost = linkedInstallation.accessories || accessoriesCost;
                    }
                }
            } else {
                // Fallback to system-specific installation costs
                const isThreePhase = system.name.toLowerCase().includes('three') || system.name.toLowerCase().includes('3p');
                const baseKey = isThreePhase ? 'three-base-installation' : 'single-base-installation';
                const accessoriesKey = isThreePhase ? 'three-accessories' : 'single-accessories';
                
                baseInstallationCost = currentPricing.installation[baseKey] || (isThreePhase ? 12000 : 8500);
                accessoriesCost = currentPricing.installation[accessoriesKey] || (isThreePhase ? 20000 : 15000);
            }
            
            // Add panel installation costs based on panel quantity (per panel)
            const panelQuantity = parseInt(document.getElementById('panels-quantity').textContent) || 0;
            const perPanelInstallationCost = currentPricing.installation?.['panel-installation-per-panel'] || 850;
            let panelInstallationCost = panelQuantity * perPanelInstallationCost;
            
            // Apply roof type multiplier if concrete roof is selected
            const concreteRoofCheckbox = document.getElementById('roof-concrete');
            if (concreteRoofCheckbox && concreteRoofCheckbox.checked) {
                const concreteMultiplier = currentPricing.installation?.['concrete-roof-multiplier'] || 1.5;
                panelInstallationCost *= concreteMultiplier;
            }
            
            // Apply markup to all costs
            baseInstallationCost *= markup;
            accessoriesCost *= markup;
            panelInstallationCost *= markup;
            
            // Add panel installation cost to base installation
            const totalInstallationCost = baseInstallationCost + panelInstallationCost;
            
            return {
                installationCost: Math.round(totalInstallationCost),
                accessoriesCost: Math.round(accessoriesCost)
            };
        }
        
        function calculateSystemPrice(system) {
            let total = 0;
            if (system.inverter) total += system.inverter.price;
            if (system.battery) total += (system.battery.price * system.battery.quantity);
            if (system.panel) total += (system.panel.price * system.panel.quantity);
            if (system.installation) total += system.installation;
            return total;
        }
        
        // Reviews Slider Functionality
        function initializeReviewsSlider() {
            const slider = document.getElementById('reviews-slider');
            const prevBtn = document.getElementById('prev-review');
            const nextBtn = document.getElementById('next-review');
            
            if (!slider || !prevBtn || !nextBtn) return;
            
            let currentIndex = 0;
            const cards = slider.querySelectorAll('.review-card');
            
            function getCardWidth() {
                // Get actual card width including gap
                if (window.innerWidth <= 768) {
                    return 320 + 16; // mobile card width + gap
                }
                return 350 + 16; // desktop card width + gap
            }
            
            function getVisibleCards() {
                return window.innerWidth > 768 ? 2 : 1;
            }
            
            function updateSlider() {
                const cardWidth = getCardWidth();
                const visibleCards = getVisibleCards();
                const maxIndex = Math.max(0, cards.length - visibleCards);
                
                // Calculate how much to move the slider
                const translateX = -currentIndex * cardWidth;
                slider.style.transform = `translateX(${translateX}px)`;
                
                // Update button states
                prevBtn.style.opacity = currentIndex === 0 ? '0.5' : '1';
                nextBtn.style.opacity = currentIndex >= maxIndex ? '0.5' : '1';
            }
            
            prevBtn.addEventListener('click', () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateSlider();
                }
            });
            
            nextBtn.addEventListener('click', () => {
                const visibleCards = getVisibleCards();
                const maxIndex = Math.max(0, cards.length - visibleCards);
                if (currentIndex < maxIndex) {
                    currentIndex++;
                    updateSlider();
                }
            });
            
            // Auto-scroll every 5 seconds
            setInterval(() => {
                const visibleCards = getVisibleCards();
                const maxIndex = Math.max(0, cards.length - visibleCards);
                if (currentIndex < maxIndex) {
                    currentIndex++;
                } else {
                    currentIndex = 0;
                }
                updateSlider();
            }, 5000);
            
            // Initialize
            updateSlider();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                const visibleCards = getVisibleCards();
                const maxIndex = Math.max(0, cards.length - visibleCards);
                if (currentIndex > maxIndex) {
                    currentIndex = maxIndex;
                }
                updateSlider();
            });
        }
        
        // Gallery Filter Functionality
        function initializeGalleryFilters() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            const galleryItems = document.querySelectorAll('.gallery-item');
            
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    filterBtns.forEach(b => b.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    const filter = this.dataset.filter;
                    
                    galleryItems.forEach(item => {
                        if (filter === 'all' || item.dataset.category.includes(filter)) {
                            item.style.display = 'block';
                            item.style.animation = 'fadeIn 0.5s ease-in-out';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });
        }
        
        // New System Builder Functions
        function selectSystemType() {
            const systemType = document.getElementById('system-type-select').value;
            const phaseSelection = document.getElementById('phase-selection');
            const teslaConfiguration = document.getElementById('tesla-configuration');
            const systemSelection = document.getElementById('system-selection');
            const customizationSection = document.getElementById('customization-section');
            
            // Store the selected brand for filtering
            window.selectedBrand = systemType;
            
            // Hide all sections first
            phaseSelection.style.display = 'none';
            teslaConfiguration.style.display = 'none';
            systemSelection.style.display = 'none';
            customizationSection.style.display = 'none';
            
            // For traditional inverter brands (non-Tesla), show phase selection
            if (systemType && systemType.toLowerCase() !== 'tesla') {
                phaseSelection.style.display = 'block';
            } else if (systemType.toLowerCase() === 'tesla') {
                teslaConfiguration.style.display = 'block';
                // Show Tesla system directly
                showTeslaSystem();
            }
        }

        // Populate system type dropdown based on available brands in pricing data
        function populateSystemTypeOptions() {
            const select = document.getElementById('system-type-select');
            if (!select) return;
            // Reset to default option
            select.innerHTML = '<option value="">Select System Type</option>';
            const brands = new Set();
            const inverters = (currentPricing && currentPricing.inverters) || {};
            const inverterKeys = Object.keys(inverters || {});
            console.log('Populating system type options. Inverter keys:', inverterKeys);
            Object.entries(inverters).forEach(([key, data]) => {
                const keyLc = (key || '').toLowerCase();
                if (typeof data === 'object' && data !== null && data.brand && data.brand.trim()) {
                    brands.add(data.brand.trim());
                } else if (keyLc.includes('tesla')) {
                    brands.add('Tesla');
                } else {
                    // Infer brand from the first token before '-' if present
                    const inferred = key.split('-')[0];
                    if (inferred) brands.add(inferred.replace(/\d+/g, ''));
                }
            });

            let added = 0;
            Array.from(brands)
                .filter(Boolean)
                .map(b => String(b))
                .sort((a, b) => a.localeCompare(b))
                .forEach(brand => {
                    const label = brand.toLowerCase() === 'tesla' ? 'Tesla Powerwall 3' : `${brand} Inverters`;
                    const opt = document.createElement('option');
                    opt.value = brand.toLowerCase();
                    opt.textContent = label;
                    select.appendChild(opt);
                    added++;
                });

            // Fallbacks: if we still have nothing but we do have inverters, add a generic option
            if (added === 0 && inverterKeys.length > 0) {
                const hasTesla = inverterKeys.some(k => k.toLowerCase().includes('tesla'));
                const hasNonTesla = inverterKeys.some(k => !k.toLowerCase().includes('tesla'));
                if (hasNonTesla) {
                    const opt = document.createElement('option');
                    opt.value = 'inverters';
                    opt.textContent = 'Inverters';
                    select.appendChild(opt);
                    added++;
                }
                if (hasTesla) {
                    const opt = document.createElement('option');
                    opt.value = 'tesla';
                    opt.textContent = 'Tesla Powerwall 3';
                    select.appendChild(opt);
                    added++;
                }
            }

            if (added === 0) {
                const opt = document.createElement('option');
                opt.value = '';
                opt.disabled = true;
                opt.textContent = 'No systems available';
                select.appendChild(opt);
            }
        }
        
        function showTeslaSystem() {
            const systemSelection = document.getElementById('system-selection');
            const customizationSection = document.getElementById('customization-section');
            
            // Create Tesla system configuration
            const teslaUnits = parseInt(document.getElementById('tesla-units-quantity').textContent);
            const includePanels = document.getElementById('include-panels').checked;
            const panelCount = includePanels ? parseInt(document.getElementById('tesla-panels-count').textContent) : 0;
            
            const teslaSystem = {
                id: 'tesla-powerwall-3',
                name: `Tesla Powerwall 3 System (${teslaUnits}x Units)`,
                inverter: null,
                battery: {
                    name: 'Tesla Powerwall 3',
                    price: (currentPricing.inverters['Tesla-PW31'] || 180000) * (currentPricing.markup?.battery || 1.15),
                    quantity: teslaUnits
                },
                panel: includePanels ? {
                    name: 'JA Solar 565W',
                    price: (currentPricing.panels['JA-Solar-565W'] || 2500) * (currentPricing.markup?.panels || 1.1),
                    quantity: panelCount
                } : null,
                installation: ((currentPricing.installation['tesla-base-installation'] || 10000) + 
                             (currentPricing.installation['tesla-accessories'] || 18000)) * (currentPricing.markup?.installation || 1),
                installationBreakdown: {
                    installation: Math.round((currentPricing.installation['tesla-base-installation'] || 10000) * (currentPricing.markup?.installation || 1.25)),
                    accessories: Math.round((currentPricing.installation['tesla-accessories'] || 18000) * (currentPricing.markup?.installation || 1.25))
                }
            };
            
            // Display the Tesla system
            displayTeslaSystem(teslaSystem);
            systemSelection.style.display = 'block';
            customizationSection.style.display = 'block';
        }
        
        function displayTeslaSystem(system) {
            const systemsGrid = document.getElementById('systems-grid');
            systemsGrid.innerHTML = '';
            
            const systemCard = document.createElement('div');
            systemCard.className = 'system-card selected';
            systemCard.innerHTML = `
                <h4>${system.name}</h4>
                <p><strong>Batteries:</strong> ${system.battery.quantity}x ${system.battery.name}</p>
                ${system.panel ? `<p><strong>Panels:</strong> ${system.panel.quantity}x ${system.panel.name}</p>` : '<p><strong>Panels:</strong> Optional (add separately)</p>'}
                <div class="system-price">R${calculateSystemPrice(system).toLocaleString('en-ZA')}</div>
            `;
            
            systemsGrid.appendChild(systemCard);
            
            // Update customization section
            updateTeslaCustomization(system);
        }
        
        function updateTeslaCustomization(system) {
            // Update pricing summary
            document.getElementById('inverter-price').textContent = 'R0';
            document.getElementById('battery-price').textContent = 'R' + (system.battery.price * system.battery.quantity).toLocaleString('en-ZA');
            document.getElementById('panel-price').textContent = system.panel ? 'R' + (system.panel.price * system.panel.quantity).toLocaleString('en-ZA') : 'R0';
            
            // Display separate installation and accessories costs
            if (system.installationBreakdown) {
                document.getElementById('installation-price').textContent = 'R' + system.installationBreakdown.installation.toLocaleString('en-ZA');
                document.getElementById('accessories-price').textContent = 'R' + system.installationBreakdown.accessories.toLocaleString('en-ZA');
            } else {
                // Fallback to total installation cost split evenly
                const totalInstallation = system.installation || 0;
                document.getElementById('installation-price').textContent = 'R' + Math.round(totalInstallation * 0.4).toLocaleString('en-ZA');
                document.getElementById('accessories-price').textContent = 'R' + Math.round(totalInstallation * 0.6).toLocaleString('en-ZA');
            }
            
            document.getElementById('total-price').textContent = 'R' + calculateSystemPrice(system).toLocaleString('en-ZA');
        }
        
        function adjustTeslaUnits(change) {
            const quantityElement = document.getElementById('tesla-units-quantity');
            let quantity = parseInt(quantityElement.textContent);
            const maxUnits = currentPricing.limits?.['tesla-units-max'] || 4;
            quantity = Math.max(1, Math.min(maxUnits, quantity + change));
            quantityElement.textContent = quantity;
            
            // Update system if Tesla is selected
            if (document.getElementById('system-type-select').value === 'tesla') {
                showTeslaSystem();
            }
        }
        
        function toggleTeslaPanels() {
            const includePanels = document.getElementById('include-panels').checked;
            const panelQuantity = document.getElementById('tesla-panel-quantity');
            
            if (includePanels) {
                panelQuantity.style.display = 'block';
            } else {
                panelQuantity.style.display = 'none';
            }
            
            // Update system if Tesla is selected
            if (document.getElementById('system-type-select').value === 'tesla') {
                showTeslaSystem();
            }
        }
        
        function adjustTeslaPanels(change) {
            const quantityElement = document.getElementById('tesla-panels-count');
            let quantity = parseInt(quantityElement.textContent);
            const minPanels = currentPricing.limits?.['tesla-panels-min'] || 0;
            const maxPanels = currentPricing.limits?.['tesla-panels-max'] || 40;
            quantity = Math.min(maxPanels, Math.max(minPanels, quantity + change));
            quantityElement.textContent = quantity;
            
            // Update system if Tesla is selected
            if (document.getElementById('system-type-select').value === 'tesla') {
                showTeslaSystem();
            }
        }
        
        // Function to get quote for current system
        function getQuoteForSystem() {
            if (!currentSystem) {
                alert('Please select a system first');
                return;
            }
            
            // Get current system details
            const systemDetails = getCurrentSystemDetails();
            
            // Populate the contact form with system information
            populateQuoteForm(systemDetails);
            
            // Scroll to contact form
            document.getElementById('contact').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }
        
        // Function to get current system details
        function getCurrentSystemDetails() {
            const system = currentSystem;
            const totalPrice = document.getElementById('total-price').textContent;
            
            return {
                name: system.name,
                inverter: system.inverter ? system.inverter.name : 'Not specified',
                battery: system.battery ? `${system.battery.quantity}x ${system.battery.name}` : 'Not specified',
                panel: system.panel ? `${system.panel.quantity}x ${system.panel.name}` : 'Not specified',
                totalPrice: totalPrice,
                installation: system.installationBreakdown ? 
                    `Installation: R${system.installationBreakdown.installation.toLocaleString('en-ZA')}, Accessories: R${system.installationBreakdown.accessories.toLocaleString('en-ZA')}` : 
                    'Not specified'
            };
        }
        
        // Function to populate the quote form
        function populateQuoteForm(systemDetails) {
            // Create system summary message
            const systemMessage = `I'm interested in the ${systemDetails.name}:

System Details:
- Inverter: ${systemDetails.inverter}
- Battery: ${systemDetails.battery}
- Solar Panels: ${systemDetails.panel}
- ${systemDetails.installation}
- Total Price: ${systemDetails.totalPrice}

Please provide me with a detailed quote for this system.`;

            // Populate the message field
            document.getElementById('message').value = systemMessage;
            
            // Store system configuration in hidden field
            document.getElementById('system-config').value = JSON.stringify(systemDetails);
            
            // Focus on the name field to guide user
            document.getElementById('name').focus();
        }
        
        // Initialize System Builder when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing System Builder...');
            
            // Populate dynamic system type options based on available brands
            populateSystemTypeOptions();

            // Add event listeners to phase options
            document.querySelectorAll('.phase-option').forEach(option => {
                option.addEventListener('click', function() {
                    const phase = this.dataset.phase;
                    selectPhase(phase);
                });
            });
            
            // Initialize reviews slider
            initializeReviewsSlider();
            
            // Initialize gallery filters
            initializeGalleryFilters();
            
            console.log('System Builder initialized successfully!');
        });
    </script>
    <script src="script.js"></script>
</body>
</html>
